<?php 

/***************************************************************************
*
*	Copyright (C) 2014 Step41 Software
*
*	Program Title: AMPLE Scaffolder Database Utility
*	Program Author: Jeff Todnem
*	Program Source: http://www.amplescaffolder.com
*	Program Date: January 14, 2014
*	Program Version: 2.2.1
*
*	This program is free software: you can redistribute it and/or modify
*	it under the terms of the GNU General Public License as published by
*	the Free Software Foundation, either version 3 of the License, or
*	(at your option) any later version.
*
*	This program is distributed in the hope that it will be useful,
*	but WITHOUT ANY WARRANTY; without even the implied warranty of
*	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*	GNU General Public License for more details.
*
*	You should have received a copy of the GNU General Public License
*	along with this program.  If not, see <http://www.gnu.org/licenses/>.
*
***************************************************************************/

 error_reporting(E_ALL ^ E_NOTICE); if (!isset($_SESSION['amplescaffolder'])) { session_start(); } if (isset($_POST['act']) && $_POST['act'] == 'reset') { $_SESSION = array(); session_destroy(); session_start(); } set_time_limit(0); define('LIB', '/lib'); define('LIB_DIR', preg_replace('/\/php\/amplescaffolder\/2\.0/i','',str_replace('\\','/',getcwd()))); $qdomain = $_SERVER['SERVER_NAME']; $qscript = $_SERVER['SCRIPT_NAME']; $qstring = $_SERVER['QUERY_STRING']; $qpid = ''; $qscaffold = 'scaffold'; $conn = FALSE; $cntRecords = 0; $qact = 'select'; $qwhere = ''; $qfld = ''; $qid = ''; $qupd = FALSE; $qsrow = 1; $qerow = 10; $qpp = 10; $qpg = 1; $qord = ''; $qsrt = ''; $qtab = 'connect'; $qconfig = FALSE; include('amplescaffolder_config.php'); if (defined('ENABLE_OVERRIDES')) { $qconfig = TRUE; if (ENABLE_OVERRIDES) { $arrDefinedConstants = get_defined_constants(TRUE); $arrDefinedConstantsUser = $arrDefinedConstants['user']; foreach ($arrDefinedConstantsUser as $constantKey => $constantVal) { if (defined($constantKey)) { $constTemp = constant($constantKey); $constName = strtolower($constantKey).'_constant'; if (isset($constTemp)) { $$constName = $constTemp; } } } } } $arrFldOpts = explode(',','id,act,where,srow,erow,pg,ord,srt,tab,srv,usr,pwd,luf,db,tbl,flds,pp,upd,mdd,dq,pas,bin,ajl,aje,ajs,ajc,ajb,htm,ssh,wfld,wop,wval,thmbs'); $arrFldFiles = explode(',','fdst,funq,flen,fsiz,fall,ffor'); $arrReqVars = array($_GET,$_POST); foreach ($arrReqVars as $reqKey => $arrVars) { foreach ($arrVars as $key => $val) { $name = 'q'.$key; $val = (is_numeric(array_search($key,$arrFldFiles)) && $val == '') ? FALSE : $val; if (!isset($$name)) { $$name = NULL; } $$name = $val; $_SESSION['amplescaffolder'][$key] = $val; } } if (!($_SESSION['amplescaffolder']) || !count($_SESSION['amplescaffolder']) || $qact == 'reset') { $_SESSION['amplescaffolder']['act'] = 'select'; $_SESSION['amplescaffolder']['where'] = ''; $_SESSION['amplescaffolder']['srow'] = 1; $_SESSION['amplescaffolder']['erow'] = 10; $_SESSION['amplescaffolder']['pg'] = 1; $_SESSION['amplescaffolder']['ord'] = ''; $_SESSION['amplescaffolder']['srt'] = ''; $_SESSION['amplescaffolder']['tab'] = 'connect'; $_SESSION['amplescaffolder']['pp'] = 10; $_SESSION['amplescaffolder']['upd'] = TRUE; $_SESSION['amplescaffolder']['srv'] = FALSE; $_SESSION['amplescaffolder']['usr'] = FALSE; $_SESSION['amplescaffolder']['pwd'] = FALSE; $_SESSION['amplescaffolder']['luf'] = 'amplescaffolder'; $_SESSION['amplescaffolder']['db'] = FALSE; $_SESSION['amplescaffolder']['tbl'] = FALSE; $_SESSION['amplescaffolder']['flds'] = FALSE; $_SESSION['amplescaffolder']['mdd'] = TRUE; $_SESSION['amplescaffolder']['dq'] = FALSE; $_SESSION['amplescaffolder']['pas'] = TRUE; $_SESSION['amplescaffolder']['bin'] = TRUE; $_SESSION['amplescaffolder']['ajl'] = TRUE; $_SESSION['amplescaffolder']['aje'] = TRUE; $_SESSION['amplescaffolder']['ajs'] = TRUE; $_SESSION['amplescaffolder']['ajc'] = TRUE; $_SESSION['amplescaffolder']['ajb'] = TRUE; $_SESSION['amplescaffolder']['htm'] = TRUE; $_SESSION['amplescaffolder']['ssh'] = FALSE; $_SESSION['amplescaffolder']['fdst'] = FALSE; $_SESSION['amplescaffolder']['funq'] = TRUE; $_SESSION['amplescaffolder']['flen'] = FALSE; $_SESSION['amplescaffolder']['fsiz'] = FALSE; $_SESSION['amplescaffolder']['fall'] = FALSE; $_SESSION['amplescaffolder']['ffor'] = TRUE; $_SESSION['amplescaffolder']['wfld'] = array(''); $_SESSION['amplescaffolder']['wop'] = array(''); $_SESSION['amplescaffolder']['wval'] = array(''); $_SESSION['amplescaffolder']['thmbs'] = array(''); } if ($_SESSION['amplescaffolder']['luf'] == '') { $_SESSION['amplescaffolder']['luf'] = 'scaffold'; } if (isset($_POST['id']) && is_numeric($_POST['id'])) { $_SESSION['amplescaffolder']['id'] = $_POST['id']; } $qflds = $_SESSION['amplescaffolder']['flds'] = (isset($_POST['act']) && $_POST['act'] == 'select' && !isset($_POST['flds'])) ? FALSE : $_SESSION['amplescaffolder']['flds']; $postMaxed = (isset($_SESSION['amplescaffolder']['id']) && $_SESSION['amplescaffolder']['id'] != $qid && preg_match('/^(insert|insertplus|update)$/i',$qact)) ? TRUE : FALSE; $post = (preg_match('/(insertplus|copy)/i',$qact)) ? $_POST : FALSE; $arrFlds = array_merge($arrFldOpts,$arrFldFiles); foreach ($arrFlds as $optionVal) { $opt = 'q'.$optionVal; $constName = strtolower($opt).'_constant'; if (isset($$constName)) { $o[$optionVal] = $$opt = $_SESSION['amplescaffolder'][$optionVal] = $$constName; } else if (isset($_SESSION['amplescaffolder'][$optionVal])) { $o[$optionVal] = $$opt = $_SESSION['amplescaffolder'][$optionVal]; } } $arrHelp['Database']['Accessing Foreign Keys with SHOW CREATE TABLE']['link'] = 'scta'; $arrHelp['Database']['Accessing Foreign Keys with SHOW CREATE TABLE']['desc'] = 'In order to determine table relationships automatically behind the scenes, a "SHOW CREATE TABLE yourTableName" query is run to access the necessary foreign key assignments. If you experience an error related to this query, it indicates a lack of permissions to the table you selected. As always, check with your database administrators to ensure you have the necessary access required to run this query.'; $arrHelp['Database']['Creating Rules to Support Advanced Features']['link'] = 'rules'; $arrHelp['Database']['Creating Rules to Support Advanced Features']['desc'] = 'End users now have the ability to add or modify custom rules through the AMPLE Scaffolder Database Utility\'s web interface. Prior releases required a 3rd party tool like PHPMyAdmin to make these modifications but as of version 2.2.0 of the AMPLE Scaffolder Database Utility, 3rd party software is no longer required to add or modify a rule within a table. Simply select a table for viewing and after the records display table has loaded, click the "Rules" button at the bottom of the tabbed UI. This will open the selected table in the Rules Editor where you can add or modify rules to your heart\'s content. Editing these rules is as simple as left-clicking any field on the right-hand side of the edit form, adding or modifying the rules within this area and then once you\'re done, click the "Update" button to save the changes or the "Cancel" button to disregard any recent modifications to the table structure.</p><p>In general, the rules used within the AMPLE Scaffolder Database Utility are really simple to use, consisting of a flag set equal to a value, with two square brackets surrounding the entire string. There are specific examples outlined in other sections of the Help documentation but the general idea is to look like the following example:</p><p>[<em>FLAGTERM</em>=<em>FLAGVALUE</em>]</p><p>One of the most commonly asked questions is how to set up options for viewing data from a secondary <a href="#ajl">lookup table</a>. Another popular request is how to set up a specific table to work with <a href="#file">file uploads</a>. We admit that this one is a bit more complex but thankfully we\'ve already outlined all the required details so you don\'t have to waste time guessing how it\'s done. If you\'re planning on using the AMPLE Scaffolder Database Utility to upload files to a web server, you might find some of the additional Help areas useful such as <a href="#fdst">setting up an upload directory</a>, troubleshooting <a href="#postmax">file size limitations during an upload</a>, and learning how to <a href="#funq">prevent files from being overwritten</a> once they are uploaded. '; $arrHelp['Database']['Database Listing']['link'] = 'db'; $arrHelp['Database']['Database Listing']['desc'] = 'Once you have <a href="#con">successfully connected</a> to the MySQL database server with the necessary credentials, a drop list will auto-populate with a list of all the databases that reside on that server. This not only makes it much simpler to move from one database to another, it also prevents any errors as a result of typos or memory lapses. Selecting an item from this list will cause the form to resubmit so that a <a href="#tbl">list of tables</a> can be generated based on the database selected.'; $arrHelp['Database']['Establishing Connections']['link'] = 'con'; $arrHelp['Database']['Establishing Connections']['desc'] = 'In order to properly manipulate data within a database, a connection must first be established using credentials. This connection is comprised of a database <a href="#srv">server name</a>, <a href="#usr">user name</a> and <a href="#pwd">password</a>. If any of these items is incorrect, the connection will fail. If you receive an error indicating that access was denied, check the values entered in any of the above fields to determine if a mistake was made. If you are using "localhost" for your server name, try replacing this with the fully qualified domain name of your database server. If the connection still fails, check with your database administrators to determine whether the user credentials (username and password) are correct and have the required level of access.'; $arrHelp['Database']['Field Listing']['link'] = 'flds'; $arrHelp['Database']['Field Listing']['desc'] = 'Once a database table is selected, the database fields list is automatically populated with all the fields that correspond to the selected table. By default, all fields are selected and displayed. However, individual fields can be included or excluded by simply selecting one or more fields from the list and clicking the Update button at the bottom of the form. This is especially handy for those tables with an inordinately large amount of fields. To avoid excessive horizontal scrolling on the page simply reduce the total number of fields displayed by selecting one or more specific fields from this list.'; $arrHelp['Database']['Primary Keys and Unique Indexing']['link'] = 'fld'; $arrHelp['Database']['Primary Keys and Unique Indexing']['desc'] = 'Field order within a table makes no difference as long as there is at least one Primary Key field available in the table. If a Primary Key is not available, a Unique index on any field within the table will also work. But either a Primary Key or Unique designator is required for any table you wish to modify using AMPLE Scaffolder Database Utility. Tables without a unique or primary key are still available through the AMPLE Scaffolder Database Utility but they will be displayed in a read-only format. Please note that the current iteration of AMPLE Scaffolder Database Utility does not support composite unique keys. Unique keys must exist on a single field only for AMPLE Scaffolder Database Utility to properly index and edit records within that table.'; $arrHelp['Database']['Schema Access']['link'] = 'sa'; $arrHelp['Database']['Schema Access']['desc'] = 'In order for AMPLE Scaffolder Database Utility to properly function, user permissions are compared against the information schema table to determine if the specified user has proper access. Without the proper level of access, users will be unable to manipulate the data within the database. If an error occurs indicating that the specified user does not have access, contact your database administrators to determine whether or not the user\'s access can be modified appropriately. At a minimum, Scaffolding users must have "USAGE" access within the information_schema.USER_PRIVILEGES table, or individual levels of access for the following commands within the information_schema.SCHEMA_PRIVILEGES table: "SELECT","INSERT","UPDATE","DELETE","CREATE". These are the minimum options required for AMPLE Scaffolder Database Utility to properly access the database and perform its functions.'; $arrHelp['Database']['Server Name']['link'] = 'srv'; $arrHelp['Database']['Server Name']['desc'] = 'A server name is required for AMPLE Scaffolder Database Utility to be able to connect successfully. If you are running this file on the same server as your MySQL database resides, you can normally use "localhost" in the server name field. For remote locations, a fully qualified domain name is typically required. If you experience an error indicating that the host server name or IP address cannot be reached, check the value entered in the respective field under the Connect tab and use a DNS lookup utility to ensure the value specified can be successfully resolved in DNS. Naming resolution problems are often the result of restrictive firewall policies, so check with your local network technicians if this problem persists.'; $arrHelp['Database']['Table Listing']['link'] = 'tbl'; $arrHelp['Database']['Table Listing']['desc'] = 'Like the <a href="#db">database list</a>, the database table list is automatically generated based on user selection. Once a database is selected, all available tables within that database will show up in the database table list. Once a table is selected from this list, the form will once again resubmit, automatically selecting all the records from within that table and displaying them at the top of the form in the records display table. Selecting an option from the database table list will also result in an additional list of <a href="#flds">table fields</a> that correspond to the table selected. These individual fields are available for selection under the Advanced tab, within the SQL Field Select area.'; $arrHelp['Database']['User Access']['link'] = 'da'; $arrHelp['Database']['User Access']['desc'] = 'The username specified within the Database Username field under the Connect tab, must have full access to the selected table to perform the basic AMPLE Scaffolder Database Utility functions. If you receive an error indicating the user does not have the proper database access, you should contact your database administrators to either increase the user\'s level of permission or to select an alternate user who does have the necessary access. Use the <a href="#sa">Schema Access</a> section of the help documentation for further details on what permissions are required within the database.'; $arrHelp['Database']['User Name']['link'] = 'usr'; $arrHelp['Database']['User Name']['desc'] = 'Access to MySQL requires a valid account that has the proper access to connect to the database server. At a minimum, "USAGE" access is required on both the Information Schema database as well as the primary database to which you wish to connect. This permits the user in question to successfully manage and modify data within the database. For more information on configuration details and troubleshooting see the <a href="#da">User Access</a> section and the <a href="#sa">Schema Access</a> section within the help documentation.'; $arrHelp['Database']['User Password']['link'] = 'pwd'; $arrHelp['Database']['User Password']['desc'] = 'Like any other access credentials, a password is also required along with the username, to successfully connect and access the database server. Like the <a href="#da">Database Username</a>, this password is set within the database itself. If you are having trouble connecting to the database with a specific set of credentials, contact your database administrator to verify that the user exists, that the password is correct and that those credentials have the required level of access to the database you\'re attempting to access. '; $arrHelp['Database Fields']['Booleans and Tiny Integers']['link'] = 'ajb'; $arrHelp['Database Fields']['Booleans and Tiny Integers']['desc'] = 'In addition to the auto-joining drop lists for lookup tables and Enum fields, there is also an option to automatically generate drop lists that correspond to Boolean field types. MySQL will typically utilize a TinyInt field with a length of one to similate a bit or boolean field. But since the TinyInt data type can also be used to track smaller numbers, enabling these boolean drop lists is optional. Enabled by default, all Boolean and TinyInt(1) field types are converted to a Yes/No drop list making it that much easier to add and modify records with these field types. If you wish to disable this feature, select "No" from the "Auto-Join Boolean Fields" drop list under the Options tab.'; $arrHelp['Database Fields']['Comma-Separated Values']['link'] = 'ajc'; $arrHelp['Database Fields']['Comma-Separated Values']['desc'] = 'The CSV field type, also known as an Extended Set field type, is one of the handier options available in AMPLE Scaffolder Database Utility. <a href="#aje">Enum Field Types</a> and <a href="#ajs">Set Field Types</a> are typically used when you need to restrict users to a pre-established list of comma-separated values (CSV) without using a separate lookup table. These field types allow users to insert one (Enum) or multiple (Set) values into a field as long as all of the values match items within the pre-established list. The primary drawback to an Enum or Set field type is that the combined length of all the values cannot exceed 255 characters. Enter the CSV field type, a simulated Set field without the 255 character length limitation.</p><p>Requirements for this option are similar to those of a lookup table. A <a href="#ajl">Database Lookup Flag</a> is required in the lookup table that will be used to populate the CSV field drop list. Any field being used as a CSV field must support string values. The two most common options are a Varchar or Text field type. The type selected is normally based on the length (total number of characters)of the values you expect to store in the field. Finally, since the built-in referential integrity rules will obviously fail due to a data-type mismatch, a pseudo-referential rule is established by adding a flag in the Comment area of the table properties. Under the table properties, select the field you wish to designate as a CSV field and add a CSV flag to the Comment area for that field. The format for a CSV flag is <strong>[CSV=<em>myTableName</em>]</strong>, where <strong><em>myTableName</em></strong> is the name of the table you wish to join to that particular field. For data integrity reasons, it is highly recommended that this option remain enabled. However, the default behavior for each individual Auto-Join field type can be easily disabled under the Options tab if necessary.'; $arrHelp['Database Fields']['Data Type Restrictions']['link'] = 'dtype'; $arrHelp['Database Fields']['Data Type Restrictions']['desc'] = 'Due to integrity rules within most databases, it is not possible to insert just any type of data into any field. Fields within databases are "type specific", meaning that each field has parameters to know what it can and cannot accept when it comes to data values. Numeric fields, in particular, are not designed to accept string values and will alert users if they see this occur. If you receive an error related to numeric field values, check the form field in question to ensure that the value specified within it is a valid number. As of version 2.0.1, the following datatypes are supported within AMPLE Scaffolder Database Utility:</p><blockquote><p>bigint &bull; bit &bull; bool &bull; boolean &bull; char &bull; datetime &bull; decimal &bull; double &bull; enum &bull; float &bull; int &bull; longtext &bull; mediumint &bull; numeric &bull; set &bull; smallint &bull; text &bull; timestamp &bull; tinyint &bull; tinytext &bull; varchar</p></blockquote> <p>The latest version of AMPLE Scaffolder Database Utility does not offer support for Blob, Date and Time field types but it\'s possible that support for these data types may be added in future revisions.'; $arrHelp['Database Fields']['Date and Time Field Types']['link'] = 'datetime'; $arrHelp['Database Fields']['Date and Time Field Types']['desc'] = 'Datetime and timestamp field types are now easier than ever to manage using AMPLE Scaffolder Database Utility. All datetime and timestamp form fields are automatically set to read-only to prevent erroneous data from being entered. To assist developers in setting these values, a Javascript calendar / clock has been included with the class that allows end users to select the appropriate date and time through a graphical user interface instead of manually entering values. This makes datetime field modification a snap and eliminates the possibility of any data type or formatting errors.'; $arrHelp['Database Fields']['Enum Field Types']['link'] = 'aje'; $arrHelp['Database Fields']['Enum Field Types']['desc'] = 'The Enum field type is quite handy for those times when you want to limit values in a field to a specific list of options. The main problem with using an Enum or <a href="#ajs">Set Field Type</a> is that these preset values are not available to the end user. Since Enum and Set field types will only accept values that match the pre-established list of options, AMPLE Scaffolder Database Utility makes life easier by automatically providing the end user with a drop list containing all the acceptable options. For data integrity reasons, it is highly recommended that this option remain enabled. However, the default behavior for each individual Auto-Join field type can be easily disabled under the Options tab if necessary.'; $arrHelp['Database Fields']['File Field Types']['link'] = 'file'; $arrHelp['Database Fields']['File Field Types']['desc'] = 'The latest version of AMPLE Scaffolder Database Utility is now capable of supporting file uploads. This feature works by adding flags to the Comment area within a table. There are a number of flag options available, but only the <strong>FILENAME</strong> flag is required for file uploads to function properly. All other file-type flags are optional but can be added to the table Comment area for each respective field if you choose to capture additional file-related data. Although not required, it is recommended that a FILEPATH attribute be assigned to a field as well. This allows original paths to be captured so the files can be successfully removed at a later date. If this value is not captured, a path based on the current uploads directory will be used instead. This may result in files not being properly removed from the file system when file references are deleted within a record.</p><p>The <strong><em>myFileFieldName</em></strong> reference within each flag, corresponds to a single field name within the table that will store the full name of the file being uploaded. The same field name will be assigned to each separate flag so that the respective attributes can be captured and stored for the file being uploaded. The available flag options are as follows: <table class="tableFiles"><tbody> <tr> <td><strong>[FILENAME=</strong><em>myFileFieldName</em><strong>]</strong></td> <td>This flag is assigned to the field that will capture the full file name once it has been uploaded.</td> </tr> <tr> <td><strong>[FILEPATH=</strong><em>myFileFieldName</em><strong>]</strong></td> <td>This flag is assigned to the field that will capture the full file path as specified under the Files options.</td> </tr> <tr> <td><strong>[FILESHORT=</strong><em>myFileFieldName</em><strong>]</strong></td> <td>This flag is assigned to the field that will capture the file name minus the extension.</td> </tr> <tr> <td><strong>[FILETYPE=</strong><em>myFileFieldName</em><strong>]</strong></td> <td>This flag is assigned to the field that will capture the file mime-type.</td> </tr> <tr> <td><strong>[FILESIZE=</strong><em>myFileFieldName</em><strong>]</strong></td> <td>This flag is assigned to the field that will capture the file size in bytes.</td> </tr> <tr> <td><strong>[FILEEXT=</strong><em>myFileFieldName</em><strong>]</strong></td> <td>This flag is assigned to the field that will capture the file extension if present.</td> </tr> </tbody></table><p>'; $arrHelp['Database Fields']['Referential Field Types']['link'] = 'ajl'; $arrHelp['Database Fields']['Referential Field Types']['desc'] = 'The referential or lookup field is not an official field type within MySQL. It\'s simply a field that contains, and is referentially tied to, ids that exist in a secondary table. One of the benefits to using AMPLE Scaffolder Database Utility is that it attempts to automatically join any secondary lookup tables to the primary table based on any pre-established referential integrity rules. This is a great benefit since it not only enforces the integrity rules, but also gives users a user-friendly list of options from which to select. For data integrity reasons, it is highly recommended that this option remain enabled. However, the default behavior for each individual Auto-Join field type can be easily disabled under the Options tab if necessary.</p><p>To get the benefit of this feature, a lookup flag or LUF designator is required to properly join and display data from any lookup tables within the database. In addition to the lookup flag, referential integrity rules must also be utilized within the database. The lookup flag designator must be added to the Comment field within each of the respective lookup tables. To do this, edit the lookup table properties and select the field whose values you wish to display (rather than the lookup id itself). Simply type the lookup flag designator into the Comment area for that particular field, and save the table changes back to the database. The format for a lookup flag is <strong>[LUF=<em>myFlagDesignator</em>]</strong>, where <strong><em>myFlagDesignator</em></strong> is the term you wish to use for the designator itself. The default lookup flag designator is "scaffold", but you can select any term if you wish to override this value. To override the default lookup flag designator, specify a new field value under the Connect tab, next to Database Lookup Flag. '; $arrHelp['Database Fields']['Set Field Types']['link'] = 'ajs'; $arrHelp['Database Fields']['Set Field Types']['desc'] = 'The Set field type is similar to the <a href="#aje">Enum Field Type</a> in that it allows you to limit values in a field to a specific list of options. The difference between the Set and Enum field types is that the Set field type allows a user to select one or more options from a list, while the Enum is limited to a single selection. The main problem with using either an Enum or Set field type is that these preset values are not available to the end user. Since Enum and Set field types will only accept values that match the pre-established list of options, AMPLE Scaffolder Database Utility makes life easier by automatically providing the end user with a drop list containing all the acceptable options. For data integrity reasons, it is highly recommended that this option remain enabled. However, the default behavior for each individual Auto-Join field type can be easily disabled under the Options tab if necessary.'; $arrHelp['Database Fields']['Unique Identifier Field Types']['link'] = 'uid'; $arrHelp['Database Fields']['Unique Identifier Field Types']['desc'] = 'Many systems these days utilize a unique identifier string (UID) of alpha-numeric values to help identify individual records or resources. In previous versions of AMPLE Scaffolder Database Utility, a Javascript implementation of a UID generator was provided. As of 2.0.7 and above, three new PHP-based UID options are available to assist with populating these particular fields. Enabling this feature is done by adding one of three flag options available, to the Comment area within a table\'s properties. The available flag options are UNIQUE, RANDOM and MD5 and can be implemented as follows: <table class="tableUids"><tbody> <tr> <td><strong>[UID=</strong><em>UNIQUE</em><strong>]</strong></td> <td>10-15 character random string.</td> </tr> <tr> <td><strong>[UID=</strong><em>RANDOM</em><strong>]</strong></td> <td>15-20 character random string.</td> </tr> <tr> <td><strong>[UID=</strong><em>MD5</em><strong>]</strong></td> <td>32 character random string.</td> </tr> </tbody></table>'; $arrHelp['Form Fields']['Client-Side and Server-Side Validation']['link'] = 'validation'; $arrHelp['Form Fields']['Client-Side and Server-Side Validation']['desc'] = 'By default, the AMPLE Scaffolder Database Utility supports both client-side and server-side validation. These options do not require any <a href="#rules">additional rules</a> to be established in the database. They are built automatically based on the data types specified in the table structure itself, along with settings for the allowance (or not) of NULL values in a particular field. </p><p>For instance, if a datetime field existed in a table, the AMPLE Scaffolder Database Utility would check to ensure any data positioned to be placed into this field matched the format required for a datetime field. This generally looks like "2013-05-20 13:45:00" so if the value passed doesn\'t match this structure, it would be considered a bad value. If this field was set to allow NULL values than a blank string would be fine. However a numeric value or otherwise ill-formatted date string would not conform and would therefore generate an error as a result. Setting this field to forbid NULL values means that a blank string would no longer suffice and an error would be generated in this case as well. </p><p>These are the types of issues that the AMPLE Scaffolder Database Utility handles with ease, preventing end users from making mistakes whenever possible and presenting useful troubleshooting information to help them determine where things went wrong. And since it works both on the client side as well as the server side, AMPLE Scaffolder Database Utility provides double the protection and peace of mind that data entered will meet or exceed the established database requirements.'; $arrHelp['Form Fields']['HTML Tagging Support']['link'] = 'htm'; $arrHelp['Form Fields']['HTML Tagging Support']['desc'] = 'By default form fields are designed to accept HTML syntax. However, allowing users to enter HTML tags directly into a form field can lead to potential problems if the data is being displayed through a web interface and erroneous code is entered. To prevent this possibility, developers can easily enable or disable HTML tag support within the form fields. By disabling this option, all HTML tags are automatically stripped from any data entered through the AMPLE Scaffolder Database Utility form.'; $arrHelp['Scaffolder Class']['Features']['link'] = 'features'; $arrHelp['Scaffolder Class']['Features']['desc'] = '<table class="tableFeatures"><tbody> <tr> <th>Active Record Highlighting</th> <td>Visually identifies the last record modified by a user</td> <tr> <tr> <th>API Interface</th> <td>Easy class instantiation makes for quick access to all public variables and functions</td> <tr> <tr> <th>Auto-Generated Form Fields</th> <td>Builds complete entry forms based on database specifications and field types</td> <tr> <tr> <th>Auto-Generated Select Lists</th> <td>Converts all reference tables, enums, sets, and boolean field types to user-friendly drop lists</td> <tr> <tr> <th>Auto-Join Disabler</th> <td>Provides users with the ability to enable / disable individual auto-join policies based on field type</td> <tr> <tr> <th>Bulk-Insert Option</th> <td>Allows developers to test database or front-end performance using randomly generated type-consistent values</td> <tr> <tr> <th>Client-Side Validation</th> <td>Enforces data type matching and non-null field types - alerts and highlights any form fields with errors</td> <tr> <tr> <th>Controlled Access</th> <td>Uses built-in MySQL permissions to control access to databases and tables</td> <tr> <tr> <th>CSV Field Type Support</th> <td>Provides users with the ability to automatically join a character field with comma-separated-values to corresponding records within a lookup table</td> <tr> <tr> <th>Data Exporting</th> <td>Capture all records from a table based on specific query criteria and save them to a Microsoft Excel spreadsheet for further analysis.</td> <tr> <tr> <th>Data Type Matching</th> <td>Ensures that values entered are correct based on the field type selected</td> <tr> <tr> <th>Date Time Calendar</th> <td>Eliminates formatting errors during date time field insertion and modification </td> <tr> <tr> <th>Error Reporting</th> <td>Tracks and reports on any internal object errors as well as MySQL errors and warnings</td> <tr> <tr> <th>Extensive Field Types</th> <td>Supports bigint, bit, bool, boolean, char, datetime, decimal, double, enum, float, int, longtext, mediumint, numeric, set, smallint, text, timestamp, tinyint, tinytext, and varchar</td> <tr> <tr> <th>External Configuration Overrides</th> <td>Allows administrators to lock down specific settings in the application based on individual security requirements</td> <tr> <tr> <th>File Upload Support</th> <td>Allows users to upload one or more files within a single database table while capturing all the standard file data such as path, name, type, size, and file extension.</td> <tr> <tr> <th>Flexible and Intuitive</th> <td>Works "auto-magically" out-of-the-box with most standard MySQL configurations.</td> <tr> <tr> <th>Friendly GUI</th> <td>Simple 3-tab interface makes option selection quick and easy</td> <tr> <tr> <th>Full Paging and Sorting</th> <td>Allows users to more easily work within larger tables and find the records they need</td> <tr> <tr> <th>Help Docs</th> <td>Helpful documentation is automatically compiled into the tool to help acclimate new users</td> <tr> <tr> <th>HTML Tag Stripper</th> <td>Allows or denies HTML tag support within field values during record inserts and updates</td> <tr> <tr> <th>Individual Field Selection</th> <td>Gives users the ability to individually select one or more specific fields from a table</td> <tr> <tr> <th>Javascript Independent</th> <td>Minimal Javascript requirements means no dependency on additional Javascript frameworks or libraries</td> <tr> <tr> <th>Location Independent</th> <td>Capable of accessing any local MySQL server with "localhost" or any remote server with a fully qualified domain name</td> <tr> <tr> <th>Minimized Data Option</th> <td>Enforces min/max row height in record display to assist users in accessing individual records and data</td> <tr> <tr> <th>Multi-Referential Lookup Support</th> <td>Allows multiple fields within a primary table to point to the same lookup table </td> <tr> <tr> <th>No AJAX Complications</th> <td>Relies on standard HTML form submissions to reduce complexity and file footprint required</td> <tr> <tr> <th>Query Generator</th> <td>Dynamic SQL queries based on user selections</td> <tr> <tr> <th>Query Viewer</th> <td>Allows users to view the final SQL output</td> <tr> <tr> <th>Record Duplication</th> <td>Duplicate an existing record in mere seconds using this feature.</td> <tr> <tr> <th>Record Row Resizer</th> <td>Allows users to expand or contract records displayed through the web interface to more easily view the data within.</td> <tr> <tr> <th>Records Per Page Option</th> <td>Allows users to select anywhere from 10 to 100 records at a time</td> <tr> <tr> <th>Server-Side Validation</th> <td>Provides a fall-back with default null, blank or numeric values, in the event of client-side validation failure</td> <tr> <tr> <th>Single File Format</th> <td>Releasable version is compiled and minified to reduce file size and make for easy deployment</td> <tr> <tr> <th>Small Footprint</th> <td>Total disk space usage of less than 150 kilobytes</td> <tr> <tr> <th>Software Update Notification</th> <td>Automatically checks for the latest version of the software and notifies developers when a newer version is available</td> <tr> <tr> <th>Syntax Highlighting</th> <td>Color-coded SQL syntax makes it easier to distinguish reserved words within queries and field data</td> <tr> <tr> <th>Table and Field List Generator</th> <td>Automatically provides users with a list of available resources on the server based on database permissions</td> <tr> <tr> <th>User-Friendly Labels</th> <td>Converts upper case, lower case, camel case and underscores to human readable headers and select options</td> <tr> <tr> <th>Where Clause Generator</th> <td>Allows users to specify an unlimited number of SQL query conditions using pre-validated values for all lookup tables, enum, set and datetime field types</td> <tr> </tbody></table>'; $arrHelp['Scaffolder Class']['Purpose']['link'] = 'purpose'; $arrHelp['Scaffolder Class']['Purpose']['desc'] = 'AMPLE Scaffolder Database Utility was designed with "user-friendly" in mind. In traditional scaffolding classes, a standard text input field is provided for editing values pulled from lookup tables, Enum and TinyInt database field types. Since these database fields are both data type-specific but also data-specific, this design approach is relatively useless to the end user unless they happen to know the acceptable values and data types to insert into these areas. The goal of AMPLE Scaffolder Database Utility was to eliminate this problem by automatically and intuitively joining all lookup tables and retrieving all CSV, Enum, Set and Boolean field values, and providing these values to the end user as standard HTML select list.'; $arrHelp['Scaffolder Class']['Requirements']['link'] = 'requirements'; $arrHelp['Scaffolder Class']['Requirements']['desc'] = 'AMPLE Scaffolder Database Utility was originally created and tested using Apache version 2.2.8, PHP version 5.2.6 and MySQL version 5.0.5. While it has not been fully tested with earlier versions of these applications, that is not to say it will not function correctly on legacy platforms. If you run into difficulties or problems with this package, try upgrading your server components to the latest version. For those folks using the latest versions of Apache, PHP and MySQL, we are continuously testing AMPLE Scaffolder Database Utility to ensure its continued and stable operation within these environments.'; $arrHelp['Scaffolder Class']['Software Updates']['link'] = 'upd'; $arrHelp['Scaffolder Class']['Software Updates']['desc'] = 'As of version 2.0.5, AMPLE Scaffolder Database Utility has a built-in software update utility to keep developers informed of new releases. This option is enabled by default and will automatically display a message at the top of the web interface if the current version in use is out of date. This feature can be easily disabled under the Options tab if developers do not wish to be notified of new releases.'; $arrHelp['SQL Queries']['Conditional Clauses']['link'] = 'where'; $arrHelp['SQL Queries']['Conditional Clauses']['desc'] = 'One of the greatest features of AMPLE Scaffolder Database Utility is that it generates all the required SQL statements automatically behind the scenes. This makes it quick and easy for developers to get to records held within the selected table. By default, all records are selected. But if you happen to be looking for a particular record, the advanced where clause generator (under the Advanced tab) can be extremely handy. Selecting a field from the first drop list will automatically update the second (operator) and third (value) options based on the field type selected. This prevents any SQL errors due to data type mismatching. Entering a value is even easier with built-in features like the datetime calendar selector and auto-generated drop lists based on any lookup tables or Enum/Set/Boolean type fields. Plus, there\'s no limit to the number of custom clauses. Just click the add button (the plus button immediately to the right of the clause fields) to generate a new clause and select your next set of options. Keep in mind that by default all searches are exclusive which means each conditional clause that is added will serve to narrow the list of results even further.'; $arrHelp['SQL Queries']['Display Minimized Data']['link'] = 'mdd'; $arrHelp['SQL Queries']['Display Minimized Data']['desc'] = 'When a database table contains a large number of fields or large quantities of data, displaying the data itself can be cumbersome because it requires a great deal of scrolling to view the output from every field. To assist developers in viewing the record output, record data is displayed in a minimized format by default. For those tables plagued with a large number of fields or data, this minimized view can make it much easier to get to individual records for modification. For those developers who wish to view all the fields and data up front, you can simply set this option to "No" under the Options tab.</p><p> A secondary option, and perhaps a more useful one at that, is the record row toggler. This function is built into the main record display table and allows you to expand or contract any row to more easily view the data. To use this option, simply click the toggle button next to the row you wish to resize. If it\'s not already expanded, it will do so, allowing you to view all of the data within each of the fields. Clicking this button again will return the record to its minimized state. To reset any custom row heights (toggled on or off), simply refresh your browser window or click the Update button and all the records will return to the previously saved state (either minimized or maximized).'; $arrHelp['SQL Queries']['Display Records After POST']['link'] = 'pas'; $arrHelp['SQL Queries']['Display Records After POST']['desc'] = '<del>By default the main records list from the selected table is automatically displayed after any major transactions such as inserting a new record or modifying or deleting an existing record. However for remote calls to AMPLE Scaffolder Database Utility, this option may not always be required. Developers can easily disable this option by selecting No and clicking the Update button at the bottom of the form.</del></p><p>This option has been temporarily removed from the package.'; $arrHelp['SQL Queries']['Displaying Queries']['link'] = 'dq'; $arrHelp['SQL Queries']['Displaying Queries']['desc'] = 'All SQL queries are automatically generated behind the scenes based on front-end user selections. But that doesn\'t mean developers have to "fly blind". This particular option assists developers by making all major record transactions visible. Users who are new to SQL (in general) and want to get more familiar with the syntax can display the queries to help them learn. The query display option can be turned on or off (under the Options tab) as needed by selecting "Yes" or "No" and clicking the Update button at the bottom of the form.'; $arrHelp['SQL Queries']['Exporting Data']['link'] = 'exp'; $arrHelp['SQL Queries']['Exporting Data']['desc'] = 'The Export feature allows users to capture all records matching the current query criteria in an excel spreadsheet. This can be quite useful for management, meetings, data distribution or other types of offline metrics analysis. Plus, with the built-in auto-joining features, the data retrieved is user-friendly, making it much easier for management and metrics to sort and make sense of the data provided. If the actual data stored within a table is required, just disable all the auto-join options and resubmit your current query, before clicking the Export button. Lastly, it should be known that exported data is not limited by the <a href="#pp">Records Per Page</a> option (under the Options tab) so use caution if you use the Export feature on tables with a large amount of records. The larger the record count, the more time the export process will require.'; $arrHelp['SQL Queries']['Inserting Bulk Records']['link'] = 'bin'; $arrHelp['SQL Queries']['Inserting Bulk Records']['desc'] = 'Another major benefit to AMPLE Scaffolder Database Utility is that it offers a very cool feature known as Bulk Insert. Oftentimes, developers need to get a feel for how a database performs with large amounts of data or they may just need to visualize the output in a specific fashion. For smaller databases or brand new databases that have yet to be populated with copious amounts of data, this can present a problem. In the past, developers were left with the labor-intensive task of manually inserting hundreds of records in order to have data with which to work. With the Bulk Insert feature, those days are history.</p><p>Developers can now utilize the Bulk Insert feature to automatically and intuitively populate a database with anywhere from 5 to 10,000 records at a time. <a href="#dtype">Strictly enforced data type</a> matching ensures that field types and data are fully compatible. Plus, a randomization algorithm is used to ensure that each record being inserted differs as much as possible from other records that exist.</p><p> Not only is this feature extremely quick and easy to use, it\'s also fully reversible. All records created using this option will be tracked making their removal as quick and easy as their creation. Once records have been added using Bulk Insert, look for a Purge button next to the Update button on the main tabbed interface. Clicking the Purge button and confirming will result in the immediate removal of all Bulk Inserted records.</p><p>To use the Bulk Insert feature, select the table to which you wish to add records. Then click the plus button in the top-left-hand corner of the records display table to add a new record. At the bottom left-hand side of the Edit form there is an option for Bulk Insert with a drop-list that is used to select the total number of records to be inserted.</p><p>As of version 2.0.8 of AMPLE Scaffolder Database Utility, developers now have the option of enabling one or more fields within the form in order to force the Bulk Insert feature to use a value specified or selected instead of a randomly generated value. The default behavior during a Bulk Insert is to disable all fields, resulting in 100 percent randomly-generated, data type-specific values. This means that the form fields themselves do not need to be filled out with data. The Bulk Insert feature does all of this behind the scenes.</p><p>To disable random values for a particular field, simply select the checkbox next to that field and add or select a value for this field. This new value will now be assigned to this field for all records inserted using the Bulk Insert option. De-selecting the same checkbox returns the field back to a state where it will use randomly assigned values instead. Depending on the size of the table and how many records were selected for insert, the Bulk Insert process can range from a few seconds up to a few minutes. Once the Bulk Insert process is complete, you will be returned to the main records display page where the new records should now be displayed. '; $arrHelp['SQL Queries']['Inserting Repetitive Records']['link'] = 'inp'; $arrHelp['SQL Queries']['Inserting Repetitive Records']['desc'] = 'Insert Plus One is another handy little feature built into AMPLE Scaffolder Database Utility. There are times when data must be manually entered on a record by record basis, but the bulk of the data is the same for each record. These minor differences in data are a nuisance because they require the user to enter the same data over and over for different records. The Insert Plus One feature allows all of the previously entered data to repopulate into a newly created form, allowing you to modify only the small portions that differ for each record instead of filling out the entire form all over again.</p><p>To provide an example, picture entering personnel data into a Human Resources database. For a smaller office, the state, city, zip code and business phone remain the same. Only the name of the individual is different for each record. These records can be easily created by clicking the Add Record button located in the top left-hand corner of the records display table, entering all the required data into the form fields, and then clicking the "Insert + 1" button. This action will save your current record back to the database (behind the scenes) and then follow-up immediately by presenting you with a new form that is pre-popluated with all the same data you just entered. You can continue this process for as long as necessary until you reach the last record you need to enter. Once you reach this last record, simply click the "Insert" button instead to complete this process and return to the records display table. Note that the "<a href="#bin">Enable Bulk Insert</a>" feature must be enabled under the Options tab to utilize this feature. '; $arrHelp['SQL Queries']['Records Per Page']['link'] = 'pp'; $arrHelp['SQL Queries']['Records Per Page']['desc'] = 'This one is pretty self-explanatory. Just select a different option from the drop down list under the Options tab to change this value. Clicking the Update button at the bottom left of the form will update this value along with the total number of records displayed each time data is retrieved and displayed from within the database table.'; $arrHelp['SQL Queries']['Referential Lookup Tables']['link'] = 'norec'; $arrHelp['SQL Queries']['Referential Lookup Tables']['desc'] = 'Based on referential integrity rules established within the database, AMPLE Scaffolder Database Utility will attempt to automatically join any lookup tables with the primary table being viewed. There is one caveat to making this work, however. The lookup table must have at least one record within it to ensure that there is something to choose within a drop list. This typically won\'t be a problem in most cases because with integrity rules in place, the lookup table would never be allowed to be empty. If you do see an error related to "no records found for lookup table", it most likely means that a lookup table was recently created or otherwise modified, resulting in a lookup table that is now empty of records. To fix this problem, simply add one or more records to the lookup table in question and then refresh the AMPLE Scaffolder Database Utility web page.'; $arrHelp['SQL Queries']['Syntax Highlighting']['link'] = 'ssh'; $arrHelp['SQL Queries']['Syntax Highlighting']['desc'] = '<del>Reserved words in MySQL are automatically highlighted in the query display. This option gives you the ability to highlight reserved words within the records as well. This is especially useful when viewing the information schema table, making it much easier to determine data types and other SQL options. Syntax highlighting is currently only available on string fields with values less than 255 characters. Because of the overhead required to match terms, strings longer than 255 characters can cause record retrieval to run extremely slowly. If you still notice excessive wait times during record retrieval, try disabling this feature altogether.</del></p><p>This feature has been temporarily disabled due to the performance overhead required for larger data sets. We are currently working on methods to optimize this feature so we can re-enable it in future releases.'; $arrHelp['Uploading Files']['File Previews and Downloads']['link'] = 'fpdl'; $arrHelp['Uploading Files']['File Previews and Downloads']['desc'] = 'As of version 2.1.7, the AMPLE Scaffolder Database Utility now offers file previewing and downloading for any files that were uploaded and saved to a table record. This allows users to verify that the correct file was attached to the record as well as making these files available to other users and developers. For image uploads specifically, a small preview thumbnail is now shown when editing any records with images attached. For more information on uploading and storing files you might want to see the Help sections on <a href="#fdst">Upload Directory</a>, <a href="#file">File Field Types</a>, and <a href="#thmbs">Thumbnail Generation</a>. '; $arrHelp['Uploading Files']['Length Limit']['link'] = 'flen'; $arrHelp['Uploading Files']['Length Limit']['desc'] = 'File names and other common attributes related to <a href="#file">File Field Types</a> are normally saved in a character-type field. Sometimes these fields have string-length limitations where the field only accepts values that are "X" number of characters in length. If this is the case and the maximum length is known ahead of time, the File Limit Length field under the Files tab can be used to specify the maximum allowable length. The Length Limit option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.'; $arrHelp['Uploading Files']['Size Limit']['link'] = 'fsiz'; $arrHelp['Uploading Files']['Size Limit']['desc'] = 'Web servers are typically configured with a default size limit for all files being uploaded. The settings as configured on the web server and within PHP cannot be overridden in terms of maximum size. However, a lesser value can be added to this field to enforce a file size smaller than that of the server configuration. The File Limit Size field accepts straight integer values which are then calculated as Bytes. The field also accepts PHP\'s standard for size parameters in the form of (K)ilobytes, (M)egabytes or (G)igabytes. So, for example, if you wished to limit the upload size to four megabytes, you could simply enter "4M" in this field. The Size Limit option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.'; $arrHelp['Uploading Files']['Thumbnail Generator']['link'] = 'thmbs'; $arrHelp['Uploading Files']['Thumbnail Generator']['desc'] = 'As of version 2.0.7, AMPLE Scaffolder Database Utility comes equipped with the option for on-the-fly thumbnail generation for any JPEG, GIF or PNG image types. The current version offers up to twelve different thumbnail sizes ranging from 75x75 pixel boxes to 1600x1200 proportional images.</p><p>Like file uploads, image files, and their corresponding thumbnail counterparts, are saved to the directory path specified in the Upload Directory field under the Files tab. Note that this tab will only be visible if the required flags have been set in the database. See <a href="#file">File Field Types</a> for more information on these configuration requirements. Thumbnail images maintain the same name as the original file with an added underscore and extension based on the size selected. For example, if the image "myphoto.jpg" was uploaded and "1024" was selected under the thumbnail options list, the new file would be named "myphoto_1024.jpg". If no size options are selected from the thumbnail option list then only the original file will be uploaded and no additional thumbnails will be created. The Thumbnail Generator option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.'; $arrHelp['Uploading Files']['Types Allowed']['link'] = 'fall'; $arrHelp['Uploading Files']['Types Allowed']['desc'] = 'Limits uploaded file types based on a specific list of comma-separated file type extensions. For example, if you wanted only images to be allowed during upload, the value of this field might look as follows: jpg,gif,png,jpeg,bmp,tiff. File types are checked based on both extension and mime-type for additional verification. Note that the Types Allowed rule will override the default or specified value assigned to <a href="#ffor">Types Forbidden</a>. The Types Allowed option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.'; $arrHelp['Uploading Files']['Types Forbidden']['link'] = 'ffor'; $arrHelp['Uploading Files']['Types Forbidden']['desc'] = 'By default a variety of executable, batch, script and other dangerous file types are blacklisted, effectively blocking them from being uploaded. But for some applications it may be necessary to override the default "danger" list so an option was added so that this parameter can be disabled. For security reasons we recommend leaving this option enabled unless you absolutely need to change it. The Types Forbidden option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.The default list of forbidden file types is below.<table class="tableDangers"><tbody> <tr> <th>386</th> <td>Windows i386 File Type </td> <tr> <tr> <th>ade</th> <td>Microsoft Access Project Extension</td> <tr> <tr> <th>adp</th> <td>Microsoft Access project</td> <tr> <tr> <th>app</th> <td>Visual FoxPro Application</td> <tr> <tr> <th>asx</th> <td>Advanced Stream Redirector File</td> <tr> <tr> <th>bas</th> <td>Visual Basic Class Module</td> <tr> <tr> <th>bat</th> <td>Batch File</td> <tr> <tr> <th>chm</th> <td>Compiled HTML Help File</td> <tr> <tr> <th>cmd</th> <td>Windows NT Command Script</td> <tr> <tr> <th>com</th> <td>Executable</td> <tr> <tr> <th>cpl</th> <td>Control Panel Extension</td> <tr> <tr> <th>crt</th> <td>Security Certificate</td> <tr> <tr> <th>dbx</th> <td>FoxPro Table</td> <tr> <tr> <th>dll</th> <td>Windows Dynamic Link Library Extension</td> <tr> <tr> <th>email</th> <td>Outlook Express message</td> <tr> <tr> <th>emf</th> <td>Enhanced Windows Metafile (Graphic format)</td> <tr> <tr> <th>eml</th> <td>Outlook Express message</td> <tr> <tr> <th>emz</th> <td>Compressed EMF</td> <tr> <tr> <th>exe</th> <td>Executable</td> <tr> <tr> <th>hlp</th> <td>Windows Help File</td> <tr> <tr> <th>hta</th> <td>HTML Applications (Microsoft HTML archive?)</td> <tr> <tr> <th>inf</th> <td>Setup Information File</td> <tr> <tr> <th>ins</th> <td>Internet Naming Service</td> <tr> <tr> <th>isp</th> <td>Internet Communication Settings</td> <tr> <tr> <th>js</th> <td>JScript File</td> <tr> <tr> <th>jse</th> <td>JScript Encoded Script File</td> <tr> <tr> <th>lnk</th> <td>Shortcut</td> <tr> <tr> <th>mda</th> <td>Microsoft Access Add-in:Microsoft Access Project</td> <tr> <tr> <th>mdb</th> <td>Microsoft Access Application</td> <tr> <tr> <th>mde</th> <td>Microsoft Access MDE Database</td> <tr> <tr> <th>mdt</th> <td>Microsoft Access workgroup information</td> <tr> <tr> <th>mdw</th> <td>Microsoft Access workgroup information</td> <tr> <tr> <th>mdz</th> <td>Microsoft Access Wizard Template</td> <tr> <tr> <th>mht</th> <td>Web Archive File</td> <tr> <tr> <th>mhtml</th> <td>Possible Eudora meta-refresh attack</td> <tr> <tr> <th>msc</th> <td>Microsoft Common Console Document</td> <tr> <tr> <th>msi</th> <td>Windows Installer Package</td> <tr> <tr> <th>msp</th> <td>Windows Installer Patch</td> <tr> <tr> <th>mst</th> <td>Windows Installer transform / Visual Test Source File</td> <tr> <tr> <th>nch</th> <td>Outlook Express Folder File</td> <tr> <tr> <th>ops</th> <td>Office XP settings</td> <tr> <tr> <th>pcd</th> <td>Microsoft Visual Test compiled script (P-Code compiled test scripts) / Photo CD Image</td> <tr> <tr> <th>pif</th> <td>Shortcut to MS-DOS program</td> <tr> <tr> <th>prf</th> <td>Microsoft Outlook Profile Settings</td> <tr> <tr> <th>reg</th> <td>Registration Entries</td> <tr> <tr> <th>scf</th> <td>Windows Explorer command</td> <tr> <tr> <th>scr</th> <td>Windows screensaver</td> <tr> <tr> <th>sct</th> <td>Windows Script Component</td> <tr> <tr> <th>shb</th> <td>Shell Scrap object (Document shortcut)</td> <tr> <tr> <th>shs</th> <td>Shell Scrap Object</td> <tr> <tr> <th>sys</th> <td>Windows System File Extension</td> <tr> <tr> <th>url</th> <td>Internet Shortcut (Uniform Resource Locator)</td> <tr> <tr> <th>vb</th> <td>VBScript File</td> <tr> <tr> <th>vbe</th> <td>VBScript Encoded Script File</td> <tr> <tr> <th>vbs</th> <td>VBScript Script File</td> <tr> <tr> <th>vxd</th> <td>Virtual Device Driver Extension</td> <tr> <tr> <th>wmf</th> <td>Windows Metafile</td> <tr> <tr> <th>wms</th> <td>Windows Media Skin</td> <tr> <tr> <th>wsc</th> <td>Windows Script Component</td> <tr> <tr> <th>wsf</th> <td>Windows Script File</td> <tr> <tr> <th>wsh</th> <td>Windows Scripting Host Settings File</td> <tr> </tbody></table><p>'; $arrHelp['Uploading Files']['Unique Naming']['link'] = 'funq'; $arrHelp['Uploading Files']['Unique Naming']['desc'] = 'When utilizing a central directory for all uploaded items, users are quite capable of overwriting eachother\'s files if the names match that of an existing file on the server. Enabled by default, the File Names Unique option prevents the overwriting of existing files because each new file is checked against the upload directory prior to being saved. If another file with the same name exists, the newer file will be renamed to a serialized version of the original name. For example, if the old file was named <em>BUDGETACCOUNTING.pdf</em>, then the new file would be named <em>BUDGETACCOUNTING1.pdf</em>. Disabling this option means that files with the same name will be overwritten each time. See the <a href="#fdst">Upload Directory</a> option for more details on how and where to specify a path for saving files during upload. The Unique Naming option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.'; $arrHelp['Uploading Files']['Upload Directory']['link'] = 'fdst'; $arrHelp['Uploading Files']['Upload Directory']['desc'] = 'For those tables with records that expect files or attachments, a file uploading feature is now available within AMPLE Scaffolder Database Utility. In order to properly save the files on the server, an upload directory must be specified ahead of time. The File Upload Directory field under the Files tab is where you specify a relative or absolute path to a directory where all uploads can be saved. The Upload Directory option can be found under the Files tab. If you don\'t currently see a tab labeled Files you will need to first configure the appropriate options within the database to support this option. See the <a href="#file">File Field Types</a> section for more details.'; $arrHelp['Web Interface']['External Configuration Overrides']['link'] = 'config'; $arrHelp['Web Interface']['External Configuration Overrides']['desc'] = 'As of version 2.1.9, the AMPLE Scaffolder Database Utility now offers the ability to override many of the application settings normally available to the end user. It provides web and database server administrators with an option for locking down a subset of options within the application, based on their individual security requirements. There is no requirement to actually apply settings through the file. It is simply provided as a tool to assist administrators. The file provided is currently named "amplescaffolder_config.php" and needs to reside in the same directory as the main "index.php" file included with the software package.</p><p>Any settings you wish to override within the app must be added as override values in the configuration file. In addition, the ENABLE_OVERRIDES constant (near the top of the file) must be set to TRUE to enforce any of the override settings. This makes it quick and easy to enable or disable all of the override settings at once. Please keep in mind that the end users must not have the ability to modify either of these two files. Place them in a directory with a READ/EXECUTE level of permission so they cannot make changes directly to the code used behind the scenes. The configuration file conforms to PHPDocs standards and includes full comments for each item to assist administrators with applying the correct settings.'; $arrHelp['Web Interface']['Record Duplication']['link'] = 'copy'; $arrHelp['Web Interface']['Record Duplication']['desc'] = 'AMPLE Scaffolder Database Utility offers the ability to duplicate an existing record in mere seconds using the built-in Record Copy option. On the left-hand side of the records display table, simply click the Modify icon next to the record you wish to copy. Once the record is open for editing, simply click the "Copy" button at the bottom of the form. This will copy all of the existing data for that record into a brand new form, preserving all of the values from the previous record in the process. This makes it extremely easy to create similar records that only have a few minor differences. For quick duplication of records see the Help section on <a href="#inp">Inserting Repetitive Records</a>.'; $arrHelp['Web Server']['Maximum POST Size']['link'] = 'postmax'; $arrHelp['Web Server']['Maximum POST Size']['desc'] = 'Apache\'s web server and PHP are both configured with default settings that control the total amount of data being sent to the server. Depending on your server\'s configuration, it\'s very possible to exceed these settings when posting large amounts of data or uploading large files. Unlike some of the other options available, the <em>post_max_size</em> and <em>upload_max_filesize</em> directives cannot be overridden during run time because these values are parsed prior to the PHP itself.</p><p>Luckily, AMPLE Scaffolder Database Utility was designed with user-friendly in mind. If your post data happens to exceed to pre-configured maximum of one or both of these settings, a warning will occur indicating which parameter was triggered. One of the most common culprits in these type of violations is one or more excessively large files being uploaded. If you experience an error related to max upload or max post size, try reducing the size of any files attached to your form. If you absolutely must upload larger files you\'ll need to contact your local web server support team and see if they can\'t increase the maximum settings.'; $arrDangers['386'] = 'Windows i386 File Type '; $arrDangers['ade'] = 'Microsoft Access Project Extension'; $arrDangers['adp'] = 'Microsoft Access project'; $arrDangers['app'] = 'Visual FoxPro Application'; $arrDangers['asx'] = 'Advanced Stream Redirector File'; $arrDangers['bas'] = 'Visual Basic Class Module'; $arrDangers['bat'] = 'Batch File'; $arrDangers['chm'] = 'Compiled HTML Help File'; $arrDangers['cmd'] = 'Windows NT Command Script'; $arrDangers['com'] = 'Executable'; $arrDangers['cpl'] = 'Control Panel Extension'; $arrDangers['crt'] = 'Security Certificate'; $arrDangers['dbx'] = 'FoxPro Table'; $arrDangers['dll'] = 'Windows Dynamic Link Library Extension'; $arrDangers['email'] = 'Outlook Express message'; $arrDangers['emf'] = 'Enhanced Windows Metafile (Graphic format)'; $arrDangers['eml'] = 'Outlook Express message'; $arrDangers['emz'] = 'Compressed EMF'; $arrDangers['exe'] = 'Executable'; $arrDangers['hlp'] = 'Windows Help File'; $arrDangers['hta'] = 'HTML Applications (Microsoft HTML archive?)'; $arrDangers['inf'] = 'Setup Information File'; $arrDangers['ins'] = 'Internet Naming Service'; $arrDangers['isp'] = 'Internet Communication Settings'; $arrDangers['js'] = 'JScript File'; $arrDangers['jse'] = 'JScript Encoded Script File'; $arrDangers['lnk'] = 'Shortcut'; $arrDangers['mda'] = 'Microsoft Access Add-in:Microsoft Access Project'; $arrDangers['mdb'] = 'Microsoft Access Application'; $arrDangers['mde'] = 'Microsoft Access MDE Database'; $arrDangers['mdt'] = 'Microsoft Access workgroup information'; $arrDangers['mdw'] = 'Microsoft Access workgroup information'; $arrDangers['mdz'] = 'Microsoft Access Wizard Template'; $arrDangers['mht'] = 'Web Archive File'; $arrDangers['mhtml'] = 'Possible Eudora meta-refresh attack'; $arrDangers['msc'] = 'Microsoft Common Console Document'; $arrDangers['msi'] = 'Windows Installer Package'; $arrDangers['msp'] = 'Windows Installer Patch'; $arrDangers['mst'] = 'Windows Installer transform / Visual Test Source File'; $arrDangers['nch'] = 'Outlook Express Folder File'; $arrDangers['ops'] = 'Office XP settings'; $arrDangers['pcd'] = 'Microsoft Visual Test compiled script (P-Code compiled test scripts) / Photo CD Image'; $arrDangers['pif'] = 'Shortcut to MS-DOS program'; $arrDangers['prf'] = 'Microsoft Outlook Profile Settings'; $arrDangers['reg'] = 'Registration Entries'; $arrDangers['scf'] = 'Windows Explorer command'; $arrDangers['scr'] = 'Windows screensaver'; $arrDangers['sct'] = 'Windows Script Component'; $arrDangers['shb'] = 'Shell Scrap object (Document shortcut)'; $arrDangers['shs'] = 'Shell Scrap Object'; $arrDangers['sys'] = 'Windows System File Extension'; $arrDangers['url'] = 'Internet Shortcut (Uniform Resource Locator)'; $arrDangers['vb'] = 'VBScript File'; $arrDangers['vbe'] = 'VBScript Encoded Script File'; $arrDangers['vbs'] = 'VBScript Script File'; $arrDangers['vxd'] = 'Virtual Device Driver Extension'; $arrDangers['wmf'] = 'Windows Metafile'; $arrDangers['wms'] = 'Windows Media Skin'; $arrDangers['wsc'] = 'Windows Script Component'; $arrDangers['wsf'] = 'Windows Script File'; $arrDangers['wsh'] = 'Windows Scripting Host Settings File';  class ImageThumb { public function imageCreate($fileTemp,$fileType) { $img = $ext = FALSE; switch ($fileType) { case 1: $img = imagecreatefromgif($fileTemp); $ext = 'gif'; break; case 2: $img = imagecreatefromjpeg($fileTemp); $ext = 'jpg'; break; case 3: $img = imagecreatefrompng($fileTemp); $ext = 'png'; break; } return array($img,$ext); } public function imageCreateSet($fileSizes,$fileDst,$fileTemp,$fileName,$fileType,$fileWidth,$fileHeight) { $arrImg = $this->imageCreate($fileTemp,$fileType); $img = $arrImg[0]; $ext = $arrImg[1]; if ($img !== FALSE) { foreach ($fileSizes as $key => $max) { $x = 0; $y = 0; if($fileWidth >= $fileHeight && $fileWidth >= $max) { $w = $max; $h = ceil($w * ($fileHeight / $fileWidth)); } else if ($fileHeight >= $fileWidth && $fileHeight >= $max) { $h = $max; $w = ceil($h * ($fileWidth / $fileHeight)); } else { $h = $fileHeight; $w = $fileWidth; } if (preg_match('/^(75|100|125|150)$/', $max)) { $img2 = imagecreatetruecolor($max, $max); if ($fileWidth >= $fileHeight) { $x = floor(($fileWidth/2)-($fileHeight/2)); $h = $max; $w = ceil($h * ($fileWidth / $fileHeight)); } else if ($fileHeight >= $fileWidth) { $y = floor(($fileHeight/2)-($fileWidth/2)); $w = $max; $h = ceil($w * ($fileHeight / $fileWidth)); } } else { $img2 = imagecreatetruecolor($w, $h); } if ($fileType == 1) { $colorcount = imagecolorstotal($img); imagetruecolortopalette($img2,true,$colorcount); imagepalettecopy($img2,$img); $transparentcolor = imagecolortransparent($img); imagefill($img2,0,0,$transparentcolor); imagecolortransparent($img2,$transparentcolor); } imagealphablending($img2, false); imageinterlace($img2, true); imagecopyresampled($img2, $img, 0, 0, $x, $y, $w, $h, $fileWidth, $fileHeight); $fileNew = $fileDst.'/'.$fileName.'_'.$fileSizes[$key].'.'.$ext; switch ($fileType) { case 1: @imagegif($img2,$fileNew); break; case 2: @imagejpeg($img2,$fileNew,100); break; case 3: imagesavealpha($img2, true); @imagepng($img2,$fileNew,1); break; } imagedestroy($img2); } imagedestroy($img); @rename($fileTemp,$fileDst.'/'.$fileName.'.'.$ext); @chmod($fileDst.'/'.$fileName.'.'.$ext,0777); } } public function imageProcess($fileSizes,$fileDst,$fileTemp,$fileName) { if (is_array(getimagesize($fileTemp))) { $arrImg = array_values(getimagesize($fileTemp)); list($fileWidth, $fileHeight, $fileType) = $arrImg; switch ($fileType) { case 1: $fileExt = 'gif'; break; case 2: $fileExt = 'jpg'; break; case 3: $fileExt = 'png'; break; } $fileRatio = round(($fileWidth / $fileHeight),2); $this->imageCreateSet($fileSizes,$fileDst,$fileTemp,$fileName,$fileType,$fileWidth,$fileHeight); } } } if (!defined('UPLOAD_ERR_OK')) { define('UPLOAD_ERR_OK',0); } if (!defined('UPLOAD_ERR_IN_SIZE')) { define('UPLOAD_ERR_IN_SIZE',1); } if (!defined('UPLOAD_ERR_FORM_SIZE')) { define('UPLOAD_ERR_FORM_SIZE',2); } if (!defined('UPLOAD_ERR_PARTIAL')) { define('UPLOAD_ERR_PARTIAL',3); } if (!defined('UPLOAD_ERR_NO_FILE')) { define('UPLOAD_ERR_NO_FILE',4); } if (!defined('UPLOAD_ERR_NO_TMP_DIR')) { define('UPLOAD_ERR_NO_TMP_DIR',6); } if (!defined('UPLOAD_ERR_CANT_WRITE')) { define('UPLOAD_ERR_CANT_WRITE',7); } if (!defined('FILE_UPLOAD_ERR_PATH')) { define('FILE_UPLOAD_ERR_PATH',10); } if (!defined('FILE_UPLOAD_ERR_SIZE')) { define('FILE_UPLOAD_ERR_SIZE',11); } if (!defined('FILE_UPLOAD_ERR_TYPE')) { define('FILE_UPLOAD_ERR_TYPE',12); } if (!defined('FILE_UPLOAD_ERR_INVALID')) { define('FILE_UPLOAD_ERR_INVALID',13); } if (!defined('POST_ERR_IN_SIZE')) { define('POST_ERR_IN_SIZE',14); } class FileUpload Extends ImageThumb { private $fileSrc = ''; private $fileDst = ''; private $fileUnique = TRUE; private $fileLengthLimit = 250; private $fileSizeLimit = 0; private $filesAllow = array(); private $filesForbid = array(); private $fileData = array(); private $fileCount = 0; private $fileErr; private $fileImage = TRUE; public function getError($fileErr) { switch ($fileErr) { case UPLOAD_ERR_IN_SIZE: return 'File upload failed because file exceeds upload_max_filesize directive in php.ini'; case UPLOAD_ERR_FORM_SIZE: return 'File upload failed because file exceeds the MAX_FILE_SIZE specified in the HTML form'; case UPLOAD_ERR_PARTIAL: return 'File upload failed because the upload was only partially completed'; case UPLOAD_ERR_NO_FILE: return 'File upload failed because the file no longer exists'; case UPLOAD_ERR_NO_TMP_DIR: return 'File upload failed because a temporary directory was not found'; case UPLOAD_ERR_CANT_WRITE: return 'File upload failed because the hard disk is not writable'; case FILE_UPLOAD_ERR_PATH: return 'File upload failed because the upload path is not a valid directory'; case FILE_UPLOAD_ERR_SIZE: return 'File upload failed because file exceeds the maximum file size'; case FILE_UPLOAD_ERR_TYPE: return 'File upload failed because the selected file type is not permitted'; case FILE_UPLOAD_ERR_INVALID: return 'File upload failed because the file source is not from upload'; case FILE_UPLOAD_ERR_INVALID: return 'File upload failed because the file source is not from upload'; case POST_ERR_IN_SIZE: return 'Post failed because total form data exceeds post_max_size directive in php.ini'; } return 'An unknown error occurred. '.$fileErr; } private function getException($fileExc) { try { throw new Exception('<div class="results"><div class="resultsContent error"><strong>ERROR:</strong> '.$fileExc.'</div></div>'); } catch (Exception $e) { echo $e->getMessage(); } return FALSE; } public function getFiles() { $fileSrc = $this->fileSrc; $fileDst = $this->fileDst; $fileSizeLimit = $this->getFileSize($this->fileSizeLimit); $maxPost = $this->getFileSize(ini_get('post_max_size')); $maxUpload = $this->getFileSize(ini_get('upload_max_filesize')); $maxSize = ($fileSizeLimit == 0) ? min(array($maxPost,$maxUpload)) : min(array($fileSizeLimit,$maxPost,$maxUpload)); if ($fileSrc == '') { $this->getException('No file source was provided!'); return FALSE; } if (is_array($_FILES[$fileSrc])) { $fileErr = $_FILES[$fileSrc]['error']; $fileTemp = $_FILES[$fileSrc]['tmp_name']; $fileName = $_FILES[$fileSrc]['name']; $fileName = $this->setFileName($fileName); $fileExt = explode('.',$fileName); $fileExt = end($fileExt); $fileShort = preg_replace('/\.'.$fileExt.'$/i', '', $fileName); $filePath = $fileDst.'/'.$fileName; $fileType = $_FILES[$fileSrc]['type']; $fileSize = $this->getFileSize($_FILES[$fileSrc]['size']); $fileTypeOkay = (!in_array(strtolower($fileExt),$this->filesForbid) && count($this->filesAllow) == 0 || in_array(strtolower($fileExt),$this->filesAllow)) ? TRUE : FALSE; $fileSizeOkay = ($fileSize <= $maxSize); $fileOkay = ($fileErr == 0 && $fileTypeOkay && $fileSizeOkay); if ($fileErr != 0 && is_uploaded_file($fileTemp)) { $fileErr = $this->getError($fileErr)."\n"; } if (!$fileTypeOkay) { $fileErr = $this->getError(12)."\n"; } if (!$fileSizeOkay) { $fileErr = $this->getError(11)."\n"; } if ($fileOkay) { $fileSizes = (is_array($this->thmbs)) ? $this->arrayClean($this->thmbs) : array(); if (count($fileSizes)) { $this->imageProcess($fileSizes,$fileDst,$fileTemp,$fileShort); } if (is_file($fileTemp) && !@move_uploaded_file($fileTemp, $filePath)) { $fileErr = $this->getError(10)."\n"; } } else { if (!@unlink($fileTemp)) { $fileErr = $this->getError(10)."\n"; } } $this->fileData[$fileSrc]['error'] = $fileErr; $this->fileData[$fileSrc]['filename'] = $fileName; $this->fileData[$fileSrc]['fileshort'] = $fileShort; $this->fileData[$fileSrc]['fileext'] = $fileExt; $this->fileData[$fileSrc]['filetype'] = $fileType; $this->fileData[$fileSrc]['filesize'] = $fileSize; $this->fileData[$fileSrc]['filepath'] = $fileDst; $this->fileData[$fileSrc]['filedate'] = strtotime("now"); $this->fileCount++; } return $this->fileData; } public function getFileSrc() { return $this->fileSrc; } public function getFileDst() { return $this->fileDst; } public function getFileImage() { return $this->fileImage; } public function getFileUnique() { return $this->fileUnique; } public function getFileSize($val=FALSE) { if (is_numeric($val)) { $val = ceil($val); } else if (preg_match('/([0-9]+)B$/i',$val,$matchVal)) { $val = ceil($matchVal[1]); } else if (preg_match('/([0-9]+)K$/i',$val,$matchVal)) { $val = ceil($matchVal[1]*1024); } else if (preg_match('/([0-9]+)M$/i',$val,$matchVal)) { $val = ceil($matchVal[1]*1024*1024); } else if (preg_match('/([0-9]+)G$/i',$val,$matchVal)) { $val = ceil($matchVal[1]*1024*1024*1024); } return $val; } public function getfileSizeLimit() { return $this->fileSizeLimit; } public function getFilesAllow() { return $this->filesAllow; } public function getFilesForbid() { return $this->filesForbid; } public function setFileImage($image=FALSE) { $fileImage = ($image) ? TRUE : FALSE; $this->fileImage = $fileImage; } private function setFileName($fileName) { $fileCnt = 1; $fileName = preg_replace('/[^a-z0-9-_\.]/i', '', $fileName); $fileExt = explode('.',$fileName); $fileExt = end($fileExt); $file = preg_replace('/\.'.$fileExt.'$/i', '', $fileName); $fileExt = '.'.$fileExt; $fileExtLen = strlen($fileExt); $file = ($this->fileLengthLimit && $this->fileLengthLimit > $fileExtLen) ? substr($file,0,$this->fileLengthLimit-$fileExtLen) : $file; $fileName = $file.$fileExt; if ($this->fileUnique === TRUE) { while (file_exists($this->fileDst.$fileName)) { $fileName = ($fileExt != '') ? $file.$fileCnt.$fileExt : $file.$fileCnt; $fileCnt++; } } return $fileName; } public function setFileParams($options=array()) { foreach ($options as $optionKey => $optionVal) { $this->$optionKey = $optionVal; } } public function setFileSrc($fileSrc=FALSE) { if ($fileSrc === FALSE) { $this->getException('No file source was specified!'); } $this->fileSrc = $fileSrc; } public function setFileDst($fileDst=FALSE) { if ($fileDst === FALSE) { $this->getException('No file destination was specified!'); } $this->fileDst = $fileDst; } public function setFileUnique($unique=TRUE) { $fileUnique = ($unique) ? TRUE : FALSE; $this->fileUnique = $fileUnique; } public function setFileLength($lengthLimit=FALSE) { if (!is_numeric($lengthLimit)) { $this->getException('Max length value must be a number!'); } $this->fileLengthLimit = $lengthLimit; } public function setFileSize($sizeLimit=0) { $this->fileSizeLimit = $sizeLimit; } public function setFilesAllow($allow='') { $filesAllowTemp = array(); $filesForbid = $this->filesForbid; $filesAllow = (is_array($allow)) ? $allow : (($allow == '') ? array() : explode(',',$allow)); foreach ($filesAllow as $extKey => $extVal) { $extVal = strtolower(preg_replace('/[^a-z0-9]/i', '', $extVal)); if (array_search($extVal,$filesForbid) === FALSE) { array_push($filesAllowTemp,strtolower($extVal)); } } sort($filesAllowTemp); $this->filesAllow = array_unique($filesAllowTemp); return $this->filesAllow; } public function setFilesForbid($forbid=TRUE) { global $arrDangers; $this->filesForbid = ($forbid && is_array($arrDangers)) ? array_keys($arrDangers) : array(); return $this->filesForbid; } } class Amplescaffolder Extends FileUpload { public $aboutSlug = 'amplescaffolder'; public $aboutCompany = 'Step41 Software'; public $aboutLinkCompany = 'http://www.step41.com'; public $aboutAuthor = 'Jeff Todnem'; public $aboutDatabase = 'MySQL 5.0.x or higher'; public $aboutLanguage = 'PHP 5.2.x or higher'; public $aboutLink = 'http://www.amplescaffolder.com'; public $aboutName = 'Step41\'s AMPLE Scaffolder Database Utility'; public $aboutPurpose = 'Step41\'s AMPLE Database Scaffolder was designed to allow database developers to more easily manipulate MySQL table data without the use of magical incantations. Built entirely on PHP (with Javascript for extra flavor), this utility assists developers by generating human-readable and selectable values instead of the traditionally-seen numerical record ids. Using auto-generated drop lists, developers can now select easy-to-read, pre-validated options for any referential tables, as well as any enum, set, boolean or csv field types.'; public $aboutSourceBase = 'http://metabetageek.com'; public $aboutSource = '/lib/php/amplescaffolder/2.0'; public $aboutTitle = 'AMPLE Scaffolder Database Utility'; public $aboutDate = 'January 14, 2014'; public $aboutVersion = '2.2.1'; private $admin = FALSE; private $srv = FALSE; private $usr = FALSE; private $pwd = FALSE; private $sa = FALSE; private $da = FALSE; private $db = FALSE; private $tbl = FALSE; private $con = FALSE; private $fld = FALSE; private $flds = FALSE; private $luf = FALSE; private $mdd = FALSE; private $dq = FALSE; private $pas = TRUE; private $bin = TRUE; private $binCount = 0; private $htm = FALSE; private $ssh = FALSE; private $ajl = TRUE; private $aje = TRUE; private $ajs = TRUE; private $ajc = TRUE; private $ajb = TRUE; private $fsrc = FALSE; private $fdst = FALSE; private $ftyp = FALSE; private $fsiz = FALSE; private $flen = FALSE; private $funq = FALSE; private $wfld = FALSE; private $wop = FALSE; private $wval = FALSE; private $sqlColors; private $sqlWords; private $err = array(); public $arrWarnings = array(); public $results = FALSE; public $linkHelp = '<a href="?pid=help#'; private $listTablesReadOnly = ''; public $matchNumeric = '/((tiny|small|medium|big)*int|decimal|double|float|numeric)/i'; public $matchDecimal = '/(float|decimal|double)/i'; public $matchDateTime = '/(date|datetime|time|timestamp)/i'; public $matchBoolean = '/(bool|boolean|tinyint\(1\))/i'; public $matchString = '/((tiny|medium|long)*text|var*char)/i'; public $matchText = '/((tiny|medium|long)*text)/i'; public $matchEnum = '/((enum|set)\((.*?)\))/i'; public $matchSet = '/(set\((.*?)\))/i'; public $matchUid = '/\[UID=(UNIQUE|RANDOM|MD5)\]/i'; public $matchUidType = '/(UNIQUE|RANDOM|MD5)/i'; public $matchLut = '/\[LUT=(.+?)\]/i'; public $matchCsv = '/\[CSV=(.+?)\]/i'; public $matchFile = '/\[((?:FILE|IMAGE)+(?:PATH|NAME|SHORT|EXT|TYPE|SIZE)+)+=(.+?)\]/i'; public $matchFileName = '/\[(?:FILE|IMAGE)+NAME=(.+?)\]/i'; public $matchHostIp = '/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/'; public $matchModify = '/(insert|insertplus|update)/i'; public $matchAction = '/(.*?)(e|bulk|plus)$/i'; public $matchAdmin = '(CREATE USER|PROCESS|RELOAD|REPLICATION CLIENT|REPLICATION SLAVE|SHOW DATABASES|SHUTDOWN|SUPER|ALL( \[PRIVILEGES\])*)'; public $matchForeign = '/foreign key \(`(.+?)`\) references `(.+?)` \(`(.+?)`\)/i'; public $matchSqlReserved = '/(.*?)(SELECT|INSERT|UPDATE|DELETE|CREATE|DROP|\s+AS|\s+FROM|\s+WHERE|\s+(RIGHT|LEFT)\s*(INNER|OUTER)\s*JOIN|\s+ON|\s+LIMIT|\s+ORDER BY|\s+INTO|\s+SET|\s+VALUES)\s+(.*?)/'; public $matchSqlOps = '/(^|\s+|\(|\[|,|<|>|.+?)(\([0-9]+\)|=[0-9]+|&&|!|\|\||<=>|\(\)|<<|%|!=|\+|>>|\*)($|\s+|\(|\)|\[|\]|,|<|>|=)/'; public $matchSqlActs = '/(^|\s+|\(|\[|,|<|>)(CREATE|DELETE|DROP|INSERT|SELECT|UPDATE)($|\s+|\(|\)|\[|\]|,|<|>|=)/'; public $matchSqlCons = '/(^|\s+|\(|\[|,|<|>|=)(AND|AS|ASC|ASCII|AUTO_INCREMENT|AVG|BETWEEN|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BTREE|CASE|CHAR|CHARSET|CHECKSUM|COALESCE|COLLATION|COMMENT|COMPACT|CONVERT|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|CURRENT_USER|DATABASE|DATE|DATETIME|DAY|DAYOFMONTH|DAYOFWEEK|DAYOFYEAR|DECIMAL|DEFAULT|DELAY_KEY_WRITE|DESC|DISTINCT|DIV|DOUBLE|DYNAMIC|ELSE|ELT|ENGINE|ENUM|FIXED|FLOAT|FOREIGN KEY|FOREIGN|FROM|GET_FORMAT|HOUR|IF|IN|INNER|INT|INTO|IS|INNODB|JOIN|KEY|LAST_INSERT_ID|LEFT|LENGTH|LIKE|LIMIT|LOCALTIME|LOCALTIMESTAMP|LONGBLOB|LONGTEXT|MATCH|MAX_ROWS|MEDIUMBLOB|MEDIUMINT|MEDIUMTEXT|MEMORY|MICROSECOND|MINUTE|MOD|MONTH|MONTHNAME|MYISAM|NOT|NULL|NUMERIC|OFFSET|OLD_PASSWORD|ON|OR|ORDER BY|OUTER|PASSWORD|PRIMARY KEY|PRIMARY|PRIVILEGES|QUARTER|REAL|REFERENCES|REGEXP|REPEAT|REPLACE|RESTRICT|RIGHT|RLIKE|ROW_FORMAT|SCHEMA|SECOND|SET|SMALLINT|TABLE|TEXT|THEN|TIME|TIMESTAMP|TIMESTAMPADD|TIMESTAMPDIFF|TINYBLOB|TINYINT|TINYTEXT|TRUNCATE|TYPE|USER|USING|UTC_DATE|UTC_TIME|UTC_TIMESTAMP|VALUES|VARBINARY|VARCHAR|VIEW|WEEK|WHEN|WHERE|XOR|YEAR)($|\s+|\(|\)|\[|\]|,|<|>|=)/'; public $matchSqlMods = '/(^|\s+|\(|\[|,|<|>)(ABS|ACOS|ADDDATE|ADDTIME|AES_DECRYPT|AES_ENCRYPT|ASIN|ATAN|ATAN2|BIN|BIT_AND|BIT_LENGTH|BIT_OR|BIT_XOR|CAST|CEIL|CEILING|CHARACTER_LENGTH|CHAR_LENGTH|COERCIBILITY|COMPRESS|CONCAT|CONCAT_WS|CONNECTION_ID|CONV|CONVERT_TZ|COS|COT|COUNT|CRC32|CURDATE|CURTIME|DATEDIFF|DATE_ADD|DATE_FORMAT|DATE_SUB|DAYNAME|DECODE|DEGREES|DES_DECRYPT|DES_ENCRYPT|ENCODE|ENCRYPT|EXPORT_SET|EXP\(\)|EXTRACT|FIELD|FIND_IN_SET|FLOOR|FORMAT|FOUND_ROWS|FROM_DAYS|FROM_UNIXTIME|GET_LOCK|GREATEST|GROUP_CONCAT|HEX|IFNULL|INET_ATON|INET_NTOA|INSTR|ISNULL|IS_FREE_LOCK|IS_USED_LOCK|LAST_DAY|LCASE|LEAST|LN|LOAD_FILE|LOCATE|LOG|LOG10|LOG2|LOWER|LPAD|LTRIM|MAKEDATE|MAKETIME|MAKE_SET|MASTER_POS_WAIT|MAX|MD5|MID|MIN|NOW|NULLIF|OCT|OCTET_LENGTH|ORD|PERIOD_ADD|PERIOD_DIFF|PI|POSITION|POW|POWER|QUOTE|RADIANS|RAND|RELEASE_LOCK|REVERSE|ROUND|RPAD|RTRIM|SEC_TO_TIME|SESSION_USER|SHA|SHA1|SIGN|SLEEP|SOUNDEX|SPACE|SQRT|STD|STDDEV|STDDEV_POP|STDDEV_SAMP|STR_TO_DATE|SUBDATE|SUBSTR|SUBSTRING|SUBSTRING_INDEX|SUBTIME|SUM|SYSDATE|SYSTEM_USER|TAN|TIMEDIFF|TIME_FORMAT|TIME_TO_SEC|TO_DAYS|TRIM|UCASE|UNCOMPRESS|UNCOMPRESSED_LENGTH|UNHEX|UNIX_TIMESTAMP|UPPER|UUID|VARIANCE|VAR_POP|VAR_SAMP|VERSION|WEEKDAY|WEEKOFYEAR)($|\s+|\(|\)|\[|\]|,|<|>|=)/'; public function __construct() {} public function _status() { $err = 'The AMPLE Database Scaffolder web service cannot be reached at this time'; $d = strtotime($this->aboutDate.' 12am EST'); $v = str_replace('.','',$this->aboutVersion); $url = $this->aboutSourceBase.$this->aboutSource.'/status/'.$v.'/'.$d.'/'; if (function_exists('curl_init')) { $ch = @curl_init(); if ($ch) { $timeout = 5; @curl_setopt ($ch, CURLOPT_URL, $url); @curl_setopt ($ch, CURLOPT_RETURNTRANSFER, 1); @curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, $timeout); $results = @curl_exec($ch); @curl_close($ch); if ($results) { $results = unserialize($results); $msgExpired = 'UPDATE: <a href="'.$this->aboutLink.'/download/">A newer version of '.$this->aboutTitle.' is now available</a>'; if ($results['error'] == 0) { return ($v < $results['version'] || $d < $results['date']) ? $msgExpired : FALSE; } else { return $results['error']; } } else { return $err; } } else { return $err; } } else { return $err; } } public function about($options=FALSE) { $options = (is_array($options)) ? $options : (($options) ? explode(',',$options) : FALSE); $arrAbout = array( 'company' => $this->aboutCompany, 'linkcompany' => $this->aboutLinkCompany, 'linkdownload' => $this->aboutLink.'/download/', 'linksupport' => $this->aboutLink.'/support/', 'linkfeedback' => $this->aboutLink.'/contact/', 'author' => $this->aboutAuthor, 'database' => $this->aboutDatabase, 'language' => $this->aboutLanguage, 'link' => $this->aboutLink, 'name' => $this->aboutName, 'purpose' => $this->aboutPurpose, 'source' => $this->aboutLink.$this->aboutSource, 'title' => $this->aboutTitle, 'date' => $this->aboutDate, 'version' => $this->aboutVersion ); if ($options) { foreach ($arrAbout as $aboutKey => $aboutVal) { if ($this->arrayKeyExists(strtolower($aboutVal),$options) === FALSE) { unset($arrAbout[$aboutKey]); } } } return $arrAbout; } public function arrayClean($array=array(),$preserve=FALSE) { $array = $this -> arrayTrim($array); $count = 0; foreach ($array as $index => $value) { if (empty($value)) { if ($preserve) { unset($array[$index]); } else { array_splice($array, $count, 1); } } else { $count++; } } return $array; } private function arrayKeyExists($key,$array) { if (array_key_exists($key,$array)) { return $key; } if (!(is_string($key) && is_array($array) && count($array))) { return false; } $key = strtolower($key); foreach ($array as $k => $v) { if (strtolower($k) == $key) { return $k; } } return false; } public function arrayPrint($array) { echo '<div style="border:1px #999 solid; margin-left:20px; padding 10px;">'; foreach ($array as $key => $val) { echo '<strong>'.htmlspecialchars("[$key]").'</strong>'; if (is_array($val)) { $this->arrayPrint($val); } else { echo htmlspecialchars($val).'<br />'; } } echo '</div>'; } public function arrayTrim($value) { if (!is_array($value)) { return trim($value); } $arrayTrim = $this->arrayTrim; return array_map($arrayTrim, $value); } private function bbcode($string='',$newlines=FALSE) { $string = preg_replace('/\[(\/*)(b|bold|strong)\]/i', '<$1strong>', $string); $string = preg_replace('/\[(\/*)(i|italic|em)\]/i', '<$1em>', $string); $string = preg_replace('/\[(\/*)(u|underline|ins)\]/i', '<$1ins>', $string); $string = preg_replace('/\[(\/*)(d|delete|del|s|strike|strikethrough)\]/i', '<$1del>', $string); $string = preg_replace('/\[gclass=(.+?)\](.*)\[\/gclass\]/si', '<span class="$1">$2</span>', $string); $string = preg_replace('/\[class=(.+?)\](.*?)\[\/class\]/si', '<span class="$1">$2</span>', $string); $string = preg_replace('/\[codeobject=(.+?)\](.*?)\[\/codeobject\]/si', '<a href="javascript:void(0)" onclick="getDocList(this)" class="attrib" id="$1">$2</a>', $string); $string = preg_replace('/\[url=(.+?)\](.*?)\[\/url\]/si', '<a href="$1">$2</a>', $string); $string = preg_replace('/\[url\](.*?)\[\/url\]/si', '<a href="$1">$1</a>', $string); $string = preg_replace('/\[img\](.*?)\[\/img\]/si', '<img src="$1" alt="" />', $string); $string = preg_replace('/\[(\/*)(hr|br|ol|ul|li|q|code|pre)\]/si', '<$1$2>', $string); if ($newlines) { $string = nl2br($string); } return $string; } private function dateAdd($interval, $number, $date) { $dateTimeArray = getdate($date); $hours = $dateTimeArray["hours"]; $minutes = $dateTimeArray["minutes"]; $seconds = $dateTimeArray["seconds"]; $month = $dateTimeArray["mday"]; $day = $dateTimeArray["day"]; $year = $dateTimeArray["year"]; switch ($interval) { case 'yyyy': $year += $number; break; case 'q': $year += ($number * 3); break; case 'm': $month += $number; break; case 'y': case 'd': case 'w': $day += $number; break; case 'ww': $day += ($number * 7); break; case 'h': $hours += $number; break; case 'n': $minutes += $number; break; case 's': $seconds += $number; break; } $timestamp = mktime($hours, $minutes, $seconds, $month, $day, $year); return $timestamp; } private function explodeCase($string) { return preg_split('/([A-Z][^A-Z]*)/', $string, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE); } private function fieldToLabel($fld,$tbl='') { $label = ''; $fld = preg_replace('/_+/',' ',$fld); if (strtoupper($fld) != $fld) { $arrWords = $this->explodeCase($fld); foreach ($arrWords as $key => $val) { $label .= $this->textTitleCaps(str_replace(strtolower($tbl),'',strtolower($val))).' '; } } else { $label = ucwords(strtolower($fld)); } return trim($label); } private function fieldToRandom($type,$limit=FALSE) { srand(); if (is_array($limit)) { $value = $limit[array_rand($limit)]; } else if (preg_match($this->matchDateTime,$type)) { $date = $this->dateAdd('d',rand(-30,30),strtotime("now")); $value = date('Y-m-d H:i:s',$date); } else if (preg_match($this->matchBoolean,$type)) { $value = (rand() % 2); } else if (preg_match($this->matchNumeric,$type,$matchType)) { switch ($matchType[1]) { case 'smallint': $i = 32767; break; case 'mediumint': $i = 8388607; break; case 'bigint': $i = 9223372036854775807; break; case 'int': $i = 2147483647; break; case 'tinyint': case 'float': case 'decimal': case 'double': case 'numeric': default: $i = 177; break; } $left = rand(1,$i); $right = rand(10,99); $value = (preg_match($this->matchDecimal,$type)) ? $left.'.'.$right : $left; } else if (preg_match($this->matchUidType,$type)) { switch ($type) { case 'unique': $value = uniqid(); break; case 'random': $value = uniqid(rand()); break; case 'md5': $value = $this->uuid(); break; } } else { $text = 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. '; $textLen = strlen($text); $limit = ($limit == FALSE) ? 255 : number_format($limit); $limit = ($limit > $textLen) ? $textLen : $limit; $value = ucfirst(preg_replace('/^[^a-zA-Z]\s*/i', '', substr($text,rand(0,$textLen),rand(($limit/2),$limit)))); } return $value; } private function fieldToValue($value,$type,$display='write',$trunc=FALSE) { if (is_null($value) && $display == 'read') { $value = '(<span class="sqlActs">NULL</span>)'; } else if (preg_match($this->matchDateTime,$type)) { if ($type != 'timestamp') { $value = strtotime($value); } if ($this->isDate($value)) { $value = ($display == 'write') ? date('Y-m-d H:i:s',$value) : date('m/d/Y',$value); } else { $value = ''; } } else if (preg_match($this->matchEnum,$type) && $display == 'read') { $value = str_replace(',',', ',$value); } else if (preg_match($this->matchBoolean,$type) && $this->ajb && $display == 'read') { $value = ($value == 1) ? 'Yes' : 'No'; } else { if ($display == 'read') { $value = strip_tags($value); } $value = preg_replace('/,([^\s]+?)/',', $1',$value); if ($trunc) { $title = $value; $value = $this->trunc($value,$trunc); $value = preg_replace('/(.+)\.\.\.$/','<span class="elipSmall" title="'.$title.'">$1...</span>',$value); } } if ($this->ssh && strlen($value) < 255) { $value = preg_replace($this->matchSqlOps,'$1<span class="sqlOps">$2</span>$3',$value); $value = preg_replace($this->matchSqlActs,'$1<span class="sqlActs">$2</span>$3',$value); $value = preg_replace($this->matchSqlCons,'$1<span class="sqlCons">$2</span>$3',$value); $value = preg_replace($this->matchSqlMods,'$1<span class="sqlMods">$2</span>$3',$value); } return $value; } public function getAccess() { return $this->admin; } public function getFieldUnique($tbl) { $db = $this->db; $fld = FALSE; $rowIndex = @mysql_fetch_assoc(@mysql_query("SELECT * FROM information_schema.KEY_COLUMN_USAGE where information_schema.KEY_COLUMN_USAGE.CONSTRAINT_NAME = 'PRIMARY' AND information_schema.KEY_COLUMN_USAGE.TABLE_SCHEMA = '".$db."' AND information_schema.KEY_COLUMN_USAGE.TABLE_NAME='".$tbl."'")); if ($rowIndex['COLUMN_NAME']) { $fld = $rowIndex['COLUMN_NAME']; } else { $rowIndex = @mysql_fetch_assoc(@mysql_query("SELECT * FROM information_schema.TABLE_CONSTRAINTS where information_schema.TABLE_CONSTRAINTS.CONSTRAINT_TYPE = 'unique' AND information_schema.TABLE_CONSTRAINTS.constraint_schema = '".$db."' AND information_schema.TABLE_CONSTRAINTS.TABLE_NAME='".$tbl."'")); $fld = ($rowIndex) ? $rowIndex['CONSTRAINT_NAME'] : $fld; } return $fld; } public function getFormField($options) { $fld = ''; $t = ''; $i = ''; $n = ''; $f = ''; $v = ''; $c = ''; $m = ''; $s = ''; $l = ''; $r = ''; $rws = ''; $cls = ''; $clk = ''; $fcs = ''; $blr = ''; $chg = ''; $tab = ''; $style = ''; $b = FALSE; $a = FALSE; $q = FALSE; $qry = FALSE; $cnt = FALSE; $tot = FALSE; $ajl = $this->ajl; $aje = $this->aje; $ajs = $this->ajs; $ajc = $this->ajc; $ajb = $this->ajb; $cops = 0; $sub = '0,1,2,5,6,7,8'; foreach($options as $optKey => $optVal) { $$optKey = $options[$optKey]; } if (!$i) { $i = $n; } if (!$f) { $f = $n; } if ($cnt !== FALSE) { $n = $n.'['.$cnt.']'; $i = $i.'_'.$cnt; } $tab = (isset($tab)) ? ' tabindex="'.$tab.'"' : ''; $style = ($style) ? ' style="'.$style.'"' : ''; $co = $c; $c .= ' '.preg_replace('/\(.+?\)/','',$t); $fld = '<input id="'.$i.'" name="'.$n.'" '.$tab.$style.' '; if ($t == 'hidden') { $fld .= 'type="hidden" value="'.$v.'" />'; } else if ($t == 'file') { $this->setFilesForbid($this->ffor); $this->setFilesAllow($this->fall); $allowed = $this->getFilesAllow(); $forbidden = $this->getFilesForbid(); $filesBtn = FALSE; if (count($allowed)) { $filesBtn = 'Only the following types of files are permitted:\n\n'.implode(', ',$allowed).''; } else if (count($forbidden)) { $filesBtn = 'The following types of files are not permitted:\n\n'.implode(', ',$forbidden).''; } $fld .= ' type="file" class="input '.$c.'" />'; $fld .= ($filesBtn) ? '&nbsp;<button type="button" class="btn btnExclaim" title="Some file types have been blocked" onclick="alert(\''.$filesBtn.'\')"></button>' : ''; } else if (isset($this->arrQueries) && is_array($this->arrQueries) && array_key_exists($f,$this->arrQueries)) { if (array_key_exists($f,$this->arrLutKeys) && $this->ajl) { $q = array('q'=>$this->arrQueries[$f],'k'=>0,'v'=>1); $v = (is_array($v)) ? $v : explode(',',$v); } else if (array_key_exists($f,$this->arrCsvKeys) && $this->ajc) { $q = array('q'=>$this->arrQueries[$f],'k'=>0,'v'=>1); $v = (is_array($v)) ? $v : explode(',',$v); $m = TRUE; $c .= ' multiple'; $s = ($s == '') ? 5 : $s; } else if ($ajl) { $q = array('q'=>$this->arrQueries[$f],'k'=>0,'v'=>1); } else { $fld .= 'type="text" class="input '.$c.'" value="'.$v.'" />'; } } else if (preg_match($this->matchSet,$t,$matchSet)) { if ($ajs) { $a = explode(',',str_replace('\'','',$matchSet[2])); $v = (is_array($v)) ? $v : explode(',',$v); $m = TRUE; $s = ($s == '') ? 5 : $s; } else { $fld .= 'type="text" class="input multiple '.$c.'" value="'.$v.'" />'; } } else if (preg_match($this->matchEnum,$t,$matchEnum)) { if ($aje) { $a = explode(',',str_replace('\'','',$matchEnum[3])); } else { $fld .= 'type="text" class="input '.$c.'" value="'.$v.'" />'; } } else if (preg_match($this->matchBoolean,$t)) { if ($ajb || $this->act == 'select') { $a = array('No','Yes'); $sub = '0,1'; } else { $fld .= 'type="text" class="input '.$c.'" value="'.$v.'" />'; } } else if (preg_match('/checkbox/i',$t)) { $fldchecked = ($v == 1 || $v === TRUE) ? 'checked="checked"' : ''; $fld .= 'type="checkbox" class="checkbox '.$c.'" value="'.$v.'" '.$fldchecked.' />'; } else if (preg_match($this->matchText,$t)) { $fld = ($co != 'wval') ? '<textarea id="'.$i.'" name="'.$n.'" class="textarea rte_'.$n.' '.$c.'" '.$tab.$style.'>'.$v.'</textarea>' : $fld .= 'type="text" class="input '.$c.'" value="'.$v.'" />'; } else if (preg_match($this->matchDateTime,$t)) { if (($v == '' || $v == '0000-00-00 00:00:00') && $b == FALSE) { $v = "now"; } $v = $this->fieldToValue($v,$t); $ddp = 'onclick="displayDatePicker(\''.$n.'\',this,\'ymdhms\',\'-\')"'; $fld .= 'type="text" class="input '.$c.'" value="'.$v.'" readonly="readonly" '.$ddp.' />'; $sub = '0,1,2,3,4,7,8'; } else if (preg_match($this->matchNumeric,$t) || preg_match($this->matchDecimal,$t)) { $fld .= 'type="text" class="input '.$c.'" value="'.$v.'" />'; $sub = '0,1,2,3,4,7,8'; } else if (is_array($v)) { $m = TRUE; $c .= ' multiple'; $s = ($s == '') ? 5 : $s; } else { if (preg_match($this->matchUidType,$t) && (is_null($v) || $v == '')) { switch ($t) { case 'unique': $v = uniqid(); break; case 'random': $v = uniqid(rand()); break; case 'md5': $v = $this->uuid(); break; } } $fld .= 'type="text" class="input '.$c.'" value="'.htmlentities($v, ENT_QUOTES).'" '.$r.' />'; } $this->ops = explode(',',$sub); if ($q || $a) { if ($q) { $qry = mysql_query($q['q']); } if ($qry) { $a = array(); $tot = mysql_num_rows($qry); if (is_numeric($q['k'])) { while ($row = mysql_fetch_row($qry)) { $a[$row[$q['k']]] = $row[$q['v']]; } } else { while ($row = mysql_fetch_assoc($qry)) { $a[$row[$q['k']]] = $row[$q['v']]; } } } if ($m) { $m = ' multiple="multiple"'; $n .= '[]'; } $optNull = (is_null($v)) ? 'selected="selected"' : ''; if ($s) { $s = ($tot && $tot < $s) ? $tot : $s; $s = ' size="'.$s.'"'; } if ($chg) { $chg = ' onchange="'.$chg.'"'; } if ($b) { $b = '<option value=""'.$optNull.'>&nbsp;</option>'; } if (is_array($a)) { $fld = '<select id="'.$i.'" name="'.$n.'" class="select '.$c.'" '.$m.$s.$chg.$tab.$style.'>'.$b; foreach ($a as $ak => $av) { $addOption = ($co == 'wop') ? ((array_search($cops,$sub) !== FALSE) ? TRUE : FALSE) : TRUE; if ($addOption) { $ok = (preg_match($this->matchEnum,$t)) ? $av : $ak; $ov = $av; if (is_array($v)) {$optSelected = (array_search($ok,$v) !== FALSE) ? 'selected="selected"' : ''; } else { $optSelected = ($ok == $v && !is_null($v)) ? 'selected="selected"' : ''; } $fld .= '<option value="'.$ok.'" '.$optSelected.'>'.$this->fieldToLabel($ov).'</option>'; } $cops++; } $fld .= '</select>'; } } return $fld; } public function getFormFieldOptions($name='db',$cnt=FALSE) { $db = $this->db; $tbl = $this->tbl; $fld = $this->fld; $value = $this->$name; $act = ($name == 'wfld') ? 'where' : 'change'; $id = $name; switch ($name) { case 'db': $k = $v = 'SCHEMA_NAME'; $q = " SELECT SCHEMA_NAME FROM information_schema.SCHEMATA WHERE information_schema.SCHEMATA.SCHEMA_NAME <> 'mysql' "; break; case 'tbl': $k = $v = 'TABLE_NAME'; $q = " SELECT TABLE_NAME FROM information_schema.TABLES WHERE information_schema.TABLES.TABLE_SCHEMA = '".$db."' AND information_schema.TABLES.TABLE_NAME <> 'scaffoldtemprecords' AND ( information_schema.TABLES.TABLE_TYPE = 'BASE TABLE' OR information_schema.TABLES.TABLE_TYPE = 'SYSTEM VIEW' ) "; break; case 'wfld': case 'flds': $value = (is_numeric($cnt)) ? $value[$cnt] : $value; $k = $v = 'COLUMN_NAME'; $q = " SELECT COLUMN_NAME, DATA_TYPE FROM information_schema.COLUMNS WHERE information_schema.COLUMNS.TABLE_SCHEMA = '".$db."' AND information_schema.COLUMNS.TABLE_NAME = '".$tbl."' AND information_schema.COLUMNS.COLUMN_NAME <> '".$fld."' "; break; } return ($name == 'flds') ? array('i'=>'select_'.$act.'_'.$id,'n'=>$name,'v'=>$value,'m'=>TRUE,'cnt'=>$cnt,'q'=>array('q'=>$q,'k'=>$k,'v'=>$v),'s'=>5) : array('i'=>'select_'.$act.'_'.$id,'n'=>$name,'v'=>$value,'b'=>TRUE,'cnt'=>$cnt,'q'=>array('q'=>$q,'k'=>$k,'v'=>$v),'chg'=>'setScaffold(this)'); } public function getFormFieldsWhere($options) { $arrWhereWops = array(); $arrWhereWvals = array(); $cnt = FALSE; foreach($options as $optKey => $optVal) { $$optKey = $options[$optKey]; } if ($q) { $value = ($cnt !== FALSE) ? $this->wval[$cnt] : $this->wval; $selCols = mysql_query($q['q']); while ($rowCol = mysql_fetch_assoc($selCols)) { if (!isset($arrWhereWops[$rowCol['COLUMN_NAME']])) { $arrWhereWops[$rowCol['COLUMN_NAME']] = array(); } if (!isset($arrWhereWvals[$rowCol['COLUMN_NAME']])) { $arrWhereWvals[$rowCol['COLUMN_NAME']] = array(); } $arrWhereWvals[$rowCol['COLUMN_NAME']] = $this->getFormField(array('i'=>'wval_'.$cnt,'n'=>'wval['.$cnt.']','c'=>'wval','b'=>TRUE,'v'=>$value,'f'=>$rowCol['COLUMN_NAME'],'t'=>$rowCol['DATA_TYPE'])); $arrWhereWops[$rowCol['COLUMN_NAME']] = $this->ops; } } $this->arrWhereWops = $arrWhereWops; $this->arrWhereWvals = $arrWhereWvals; } public function getHelpOutput($arrHelpDirect=array()) { global $arrHelp; $strOutput = ''; $arrHelp = (isset($arrHelp) && is_array($arrHelp)) ? $arrHelp : (($arrHelpDirect) ? $arrHelpDirect : FALSE); if ($arrHelp) { $arrAbout = $this->about(); $strOutput .= '<div id="help" class="help">'; $strOutput .= '<table id="tableAbout" class="tableOther"><tbody>'; $strOutput .= '<tr>'; $strOutput .= '<th>Author:</th>'; $strOutput .= '<td>'.$arrAbout['author'].' @ <a href="'.$arrAbout['link'].'" target="_new">'.$arrAbout['company'].'</a></td>'; $strOutput .= '</tr>'; $strOutput .= '<tr>'; $strOutput .= '<th>Updated:</th>'; $strOutput .= '<td>'.$arrAbout['date'].'</td>'; $strOutput .= '</tr>'; $strOutput .= '<tr>'; $strOutput .= '<th>Version:</th>'; $strOutput .= '<td>'.$arrAbout['version'].'</td>'; $strOutput .= '</tr>'; $strOutput .= '<tr>'; $strOutput .= '<th>Languages:</th>'; $strOutput .= '<td>'.$arrAbout['language'].'</td>'; $strOutput .= '</tr>'; $strOutput .= '<tr>'; $strOutput .= '<th>Databases:</th>'; $strOutput .= '<td>'.$arrAbout['database'].'</td>'; $strOutput .= '</tr>'; $strOutput .= '<tr>'; $strOutput .= '<th>Purpose:</th>'; $strOutput .= '<td><p>'.stripslashes($arrAbout['purpose']).'</p></td>'; $strOutput .= '</tr>'; $strOutput .= '</tbody></table>'; $arrToc = array(); $helpToc = ''; $helpContent = ''; $helpTop = '<a href="#" target="_top" class="linkTop" title="To the Top"></a>'; $helpLinkHist = '&nbsp;&nbsp;<a href="javascript:history.go(-1)" class="linkHome" title="Return to home"></a>'; $helpLinkFull = '&nbsp;&nbsp;<a href="'.$_SERVER['SCRIPT_NAME'].'" class="linkHome" title="Return to home"></a>'; $helpBack = (isset($_POST['act'])) ? $helpLinkHist : $helpLinkFull; $helpSecCnt = 1; foreach ($arrHelp as $helpSec => $arrSecs) { $helpToc .= '<li>'.$helpSecCnt.'. '.$helpSec.': <ul>'; $helpSubCnt = 1; foreach ($arrSecs as $helpSub => $arrSubs) { $helpDots = ($helpSubCnt > 9) ? '...................' : '....................'; $helpToc .= '<li>'.$helpSecCnt.'.'.$helpSubCnt.' '.$helpDots.' <a href="#'.$arrSubs['link'].'">'.stripslashes($helpSub).'</a></li>'; $helpContent .= '<a name="'.$arrSubs['link'].'"></a><h5>'.stripslashes($helpSub).':</h5>'; $helpContent .= '<p>'.stripslashes($arrSubs['desc']).'</p>'.$helpTop.$helpBack; $helpSubCnt++; } $helpToc .= '</ul></li>'; $helpSecCnt++; } $strOutput .= '<h5>Table of Contents:</h5>'; $strOutput .= '<ul>'.$helpToc.'</ul>'.$helpTop.$helpBack; $strOutput .= $helpContent; $strOutput .= '</div>'; } else { $strOutput .= '<h3>Help documentation is currently unavailable</h3>'; } return $strOutput; } public function getHost($srv=FALSE) { $matchHostIp = $this->matchHostIp; $ip = $name = FALSE; if (preg_match($matchHostIp, $srv)) { $results = gethostbyaddr($srv); $name = (!preg_match($matchHostIp, $results)); } else { $results = gethostbyname($srv); $ip = (preg_match($matchHostIp, $results)); } return ($srv && ($name || $ip)) ? TRUE : FALSE; } public function getQuery($act,$id) { $timeBeg = $this->getTime(); $aboutSlug = $this->aboutSlug; global $qsrow; global $qpg; global $qpp; global $qord; global $qsrt; $qsrow = (isset($_SESSION[$aboutSlug]['srow'])) ? $_SESSION[$aboutSlug]['srow'] : $qsrow; $qpg = (isset($_SESSION[$aboutSlug]['pg'])) ? $_SESSION[$aboutSlug]['pg'] : $qpg; $qpp = (isset($_SESSION[$aboutSlug]['pp'])) ? $_SESSION[$aboutSlug]['pp'] : $qpp; $qord = (isset($_SESSION[$aboutSlug]['ord'])) ? $_SESSION[$aboutSlug]['ord'] : $qord; $qsrt = (isset($_SESSION[$aboutSlug]['srt'])) ? $_SESSION[$aboutSlug]['srt'] : $qsrt; $act = ($act == 'export') ? 'select' : $act; $con = $this->con; $luf = ($this->luf != '') ? $this->luf : FALSE; $db = $this->db; $tbl = $this->tbl; $flds = $this->flds; $fld = ($this->fld) ? $this->fld : ''; $ajl = $this->ajl; $ajc = $this->ajc; $htm = $this->htm; $wfld = $this->wfld; $wop = $this->wop; $wval = $this->wval; $arrThmbs = $this->arrThmbs; $this->act = (isset($this->act) && $this->act) ? $this->act : FALSE; $this->id = $id; $selColDetailsQuery = "SELECT * FROM information_schema.COLUMNS WHERE information_schema.COLUMNS.TABLE_SCHEMA='".$db."' AND information_schema.COLUMNS.TABLE_NAME='".$tbl."'"; if (is_array($flds)) { $cntFldsQuery = $selColDetailsQuery." AND COLUMN_NAME REGEXP '^(".implode('|',$flds).")$'"; $cntFlds = @mysql_num_rows(@mysql_query($cntFldsQuery)); $this->flds = $flds = ($cntFlds == count($flds)) ? $flds : FALSE; } $loop = ($this->act == $act && $flds) ? TRUE : FALSE; $arrTables = (isset($this->arrTables) && $this->arrTables && $loop) ? $this->arrTables : array(); $arrLookups = (isset($this->arrLookups) && $this->arrLookups && $loop) ? $this->arrLookups : array(); $arrSubs = (isset($this->arrSubs) && $this->arrSubs && $loop) ? $this->arrSubs : array(); $arrLocals = (isset($this->arrLocals) && $this->arrLocals && $loop) ? $this->arrLocals : array(); $arrFields = (isset($this->arrFields) && $this->arrFields && $loop) ? $this->arrFields : array(); $arrCols = (isset($this->arrCols) && $this->arrCols && $loop) ? $this->arrCols : array(); $arrTypes = (isset($this->arrTypes) && $this->arrTypes && $loop) ? $this->arrTypes : array(); $arrDefaults = (isset($this->arrDefaults) && $this->arrDefaults && $loop) ? $this->arrDefaults : array(); $arrNulls = (isset($this->arrNulls) && $this->arrNulls && $loop) ? $this->arrNulls : array(); $arrLabels = (isset($this->arrLabels) && $this->arrLabels && $loop) ? $this->arrLabels : array(); $arrComments = (isset($this->arrComments) && $this->arrComments && $loop) ? $this->arrComments : array(); $arrLutKeys = (isset($this->arrLutKeys) && $this->arrLutKeys && $ajl && $loop) ? $this->arrLutKeys : array(); $arrCsvKeys = (isset($this->arrCsvKeys) && $this->arrCsvKeys && $ajc && $loop) ? $this->arrCsvKeys : array(); $arrFileFlds = (isset($this->arrFileFlds) && $this->arrFileFlds && $loop) ? $this->arrFileFlds : array(); $arrFilePaths = (isset($this->arrFilePaths) && $this->arrFilePaths && $loop) ? $this->arrFilePaths : array(); $arrBinFlds = (isset($this->arrBinFlds) && $this->arrBinFlds && $loop) ? $this->arrBinFlds : array(); $arrForeignKeys = (isset($this->arrForeignKeys) && $this->arrForeignKeys && $loop) ? $this->arrForeignKeys : array(); $arrQueries = (isset($this->arrQueries) && $this->arrQueries && $loop) ? $this->arrQueries : array(); $arrWarnings = (isset($this->arrWarnings) && $this->arrWarnings && $loop) ? $this->arrWarnings : array(); $qSelect = $qFrom = $qSet = $qInsert = $qUpdate = $qDelete = $qlookups = $qJoins = $qWhere = $qOrder = $qlimit = ''; if (!isset($this->arrFields) || !$loop) { $this->act = $act; $rowMaxPacket = mysql_fetch_assoc(mysql_query("SHOW VARIABLES LIKE 'max_allowed_packet'")); $this->maxPacket = $maxPacket = $rowMaxPacket['Value']; $fld = $this->getFieldUnique($tbl); $this->fld = $fld; $selColDetails = mysql_query($selColDetailsQuery); if ($selColDetails) { $fldCnt = 0; $fldIsFile = FALSE; $fldIsUnique = FALSE; $arrLutKeys = array(); $arrCsvKeys = array(); $arrCols = array(); $selColDetails = mysql_query($selColDetailsQuery); while ($rowCol = mysql_fetch_assoc($selColDetails)) { array_push($arrFields,$rowCol['COLUMN_NAME']); array_push($arrTypes,$rowCol['COLUMN_TYPE']); array_push($arrDefaults,$rowCol['COLUMN_DEFAULT']); array_push($arrNulls,$rowCol['IS_NULLABLE']); array_push($arrLabels,$rowCol['COLUMN_NAME']); array_push($arrComments,$rowCol['COLUMN_COMMENT']); if (preg_match($this->matchLut,$rowCol['COLUMN_COMMENT'],$matchLutKey) && $ajl) { $arrLutKeys[$rowCol['COLUMN_NAME']]['table'] = $matchLutKey[1]; $arrLutKeys[$rowCol['COLUMN_NAME']]['field'] = $this->getFieldUnique($matchLutKey[1]); $arrLutKeys[$rowCol['COLUMN_NAME']]['reftype'] = 'LUT'; } if (preg_match($this->matchCsv,$rowCol['COLUMN_COMMENT'],$matchCsvKey) && $ajc) { $arrCsvKeys[$rowCol['COLUMN_NAME']]['table'] = $matchCsvKey[1]; $arrCsvKeys[$rowCol['COLUMN_NAME']]['field'] = $this->getFieldUnique($matchCsvKey[1]); $arrCsvKeys[$rowCol['COLUMN_NAME']]['reftype'] = 'CSV'; } else if (preg_match($this->matchFile,$rowCol['COLUMN_COMMENT'],$matchFile)) { $fileField = $matchFile[2]; $fileFieldAttrib = strtolower(preg_replace('/image/i','file',$matchFile[1])); $arrFileFlds[$fileField][$rowCol['COLUMN_NAME']]['type'] = $rowCol['COLUMN_TYPE']; $arrFileFlds[$fileField][$rowCol['COLUMN_NAME']]['attrib'] = $fileFieldAttrib; if ($fileFieldAttrib == 'filepath') { $arrFilePaths[$fileField] = $rowCol['COLUMN_NAME']; } $fldIsFile = TRUE; } if ($rowCol['COLUMN_NAME'] != $fld && !$fldIsFile) { array_push($arrBinFlds,$rowCol['COLUMN_NAME']); } $fldPush = (is_array($flds) && $act == 'select') ? ((array_search($rowCol['COLUMN_NAME'],$flds) !== FALSE || $rowCol['COLUMN_NAME'] == $fld) ? TRUE : FALSE) : TRUE; if ($fldPush) { array_push($arrCols,$fldCnt); } $fldCnt++; } } else { echo 'The following query failed to return valid results:<br />'.$selColDetailsQuery.'<hr />'; } $this->arrFields = $arrFields; $this->arrCols = $arrCols; $this->arrTypes = $arrTypes; $this->arrDefaults = $arrDefaults; $this->arrNulls = $arrNulls; $this->arrLabels = $arrLabels; $this->arrComments = $arrComments; $this->arrLutKeys = $arrLutKeys; $this->arrCsvKeys = $arrCsvKeys; $this->arrFileFlds = $arrFileFlds; $this->arrFilePaths = $arrFilePaths; $this->arrBinFlds = $arrBinFlds; $this->arrWarnings = $arrWarnings; $rowForeignKeyQuery = @mysql_query("SHOW CREATE TABLE ".$db.".".$tbl); if ($rowForeignKeyQuery === FALSE) { $this->setError('scta',FALSE,array($db,$tbl)); return FALSE; } $rowForeignKey = mysql_fetch_array($rowForeignKeyQuery); preg_match_all($this->matchForeign,$rowForeignKey[1],$arrForeignKeys,PREG_SET_ORDER); $this->arrForeignKeys = $arrForeignKeys; } $arrSameTable = array(); $arrForeignKeysLen = count($arrForeignKeys); for($i=0; $i < $arrForeignKeysLen; $i++) { $v1 = $arrForeignKeys[$i][1]; $v2 = $arrForeignKeys[$i][2]; $v3 = $arrForeignKeys[$i][3]; if (!isset($arrSameTable[$v2])) { $arrSameTable[$v2] = array(); } array_push($arrSameTable[$v2],$v1); $v4 = $v2.count($arrSameTable[$v2]); $v5 = $v2.' AS '.$v4; $v6 = $db.'.'.$v4.'.'.$v3; $arrTables[$v1]['table'] = $v2; $arrTables[$v1]['field'] = $v3; $arrTables[$v1]['reftype'] = 'FKEY'; $arrLookups[$v1]['table'] = $v4; $arrTables[$v1]['join'] = "LEFT OUTER JOIN ".$db.".".$v5." ON ".$db.".".$tbl.".".$v1."=".$v6." "; } $this->arrLookups = $arrLookups; $arrTables = array_merge($arrTables,$arrLutKeys); $arrTables = array_merge($arrTables,$arrCsvKeys); $this->arrTables = $arrTables; $arrSameTable = array(); unset($arrSameTable); $qSelect = "SELECT "; $qFrom = "FROM ".$db.".".$tbl; $qInsert = "INSERT INTO ".$db.".".$tbl." SET "; $qInsertBulk = "INSERT INTO ".$db.".".$tbl." (".implode(',',$arrBinFlds).") VALUES "; $qUpdate = "UPDATE ".$db.".".$tbl." SET "; $qDelete = "DELETE FROM ".$db.".".$tbl; $qord = ($qord == '') ? (($fld == '') ? '' : $fld) : $qord; $qOrder = ($qord == '') ? '' : ((array_key_exists($qord,$arrTables) || array_key_exists($qord,$arrLookups)) ? $qord : $db.".".$tbl.".".$qord); $qOrder = ($qord == '') ? '' : "ORDER BY ".$qOrder." ".$qsrt; $qOrder = ($act == 'edit') ? '' : $qOrder; $arrForeignKeysTemp = array(); $arrHeaderLen = (is_array($flds) && $act == 'select') ? count($flds)+1 : count($arrFields); $cntCols = $cntFldCols = 0; if ($act == 'insertbulk') { $values = ''; for ($i=$this->binCount; $i < $_POST['insertbulkcount']; $i++) { $postVals = ''; $cntCols = 0; foreach ($arrFields as $fldKey => $fldVal) { $fldFile = (preg_match($this->matchFile,$arrComments[$cntCols],$matchFile)) ? TRUE : FALSE; $fldPush = ($fldVal != $fld && !$fldFile) ? TRUE : FALSE; $fldUid = (preg_match($this->matchUid,$arrComments[$cntCols],$matchUid)) ? TRUE : FALSE; if ($fldPush) { $fldLookup = (array_key_exists($fldVal,$arrTables)) ? TRUE : FALSE; if ($fldLookup) { if (!is_array($this->arrLimits[$fldVal])) { $arrLimits[$fldVal] = array(); $selLimitVals = mysql_query("SELECT ".$arrTables[$fldVal]['field']." FROM ".$db.".".$arrTables[$fldVal]['table']); while ($rowLimitVal = mysql_fetch_assoc($selLimitVals)) { array_push($arrLimits[$fldVal],$rowLimitVal[$arrTables[$fldVal]['field']]); } $this->arrLimits[$fldVal] = $arrLimits[$fldVal]; } $limit = $this->arrLimits[$fldVal]; } else { if (preg_match($this->matchEnum,$arrTypes[$cntCols],$matchLimit)) { $limit = explode(',', str_replace('\'', '', $matchLimit[3])); } else if (preg_match('/.+?\((.+?)\)/i',$arrTypes[$cntCols],$matchLimit)) { $limit = $matchLimit[1]; } else { $limit = 255; } } $fldType = ($fldUid) ? strtolower($matchUid[1]) : $this->arrTypes[$cntCols]; $validFld = $this->arrayKeyExists(preg_replace('/\[\]$/','',$fldVal),$_POST); $postVal = ($validFld) ? $_POST[$validFld] : $this->fieldToRandom($fldType,$limit); $postVal = (is_array($postVal)) ? implode(',',$postVal) : $postVal; if (preg_match($this->matchNumeric,$arrTypes[$cntCols])) { if (preg_match('/[^0-9]+/',$postVal) || trim($postVal) == '') { $postVal = (trim($postVal) == '') ? ((strtolower($arrNulls[$cntCols]) == 'no') ? 0 : 'NULL') : "'".addslashes($postVal)."'"; } } else if (preg_match($this->matchEnum,$arrTypes[$cntCols]) || array_key_exists($fldVal,$arrLutKeys) || array_key_exists($fldVal,$arrCsvKeys)) { $postVal = (trim($postVal) == '') ? 'NULL' : "'".addslashes($postVal)."'"; } else if (preg_match($this->matchDateTime,$arrTypes[$cntCols])) { $postVal = (trim($postVal) == '') ? 'NULL' : "'".addslashes($postVal)."'"; } else { $postVal = ($htm) ? $postVal : strip_tags($postVal); $postVal = "'".addslashes($postVal)."'"; } $postVals .= ($postVals == '') ? $postVal : ','.$postVal; } $cntCols++; } $values = ($values == '') ? '('.$postVals.')' : ',('.$postVals.')'; if (strlen($qInsertBulk.$values) <= $this->maxPacket) { $qInsertBulk .= $values; } else { break; } } } else { foreach ($arrFields as $fldKey => $fldVal) { $fldPush = (is_array($flds) && $act == 'select') ? ((array_search($fldVal,$flds) !== FALSE || $fldVal == $fld) ? TRUE : FALSE) : TRUE; $fldLookup = (array_key_exists($fldVal,$arrLookups) && $ajl) ? TRUE : FALSE; $fldLut = (array_key_exists($fldVal,$arrLutKeys) && $ajl) ? TRUE : FALSE; $fldCsv = (array_key_exists($fldVal,$arrCsvKeys) && $ajc) ? TRUE : FALSE; $fldFile = (preg_match($this->matchFile,$arrComments[$cntCols],$matchFile)) ? TRUE : FALSE; $fldUid = (preg_match($this->matchUid,$arrComments[$cntCols],$matchUid)) ? TRUE : FALSE; if ($fldLookup || $fldCsv || $fldLut) { $selLookups = @mysql_num_rows(@mysql_query("SELECT * FROM ".$db.".".$arrTables[$fldVal]['table'])); if ($selLookups == 0) { $this->setError('norec',FALSE,array(strtoupper($arrTables[$fldVal]['table']))); } $selFlagsQuery = "SELECT * FROM information_schema.COLUMNS WHERE information_schema.COLUMNS.TABLE_SCHEMA='".$db."' AND information_schema.COLUMNS.TABLE_NAME='".$arrTables[$fldVal]['table']."' AND information_schema.COLUMNS.COLUMN_COMMENT LIKE '%[LUF=".$luf."\]%'"; $selFlags = @mysql_query($selFlagsQuery); $cntFlags = @mysql_num_rows($selFlags); if ($cntFlags == 0 && $act != 'rulesedit') { $this->setError('ajl',FALSE,array(strtoupper($arrTables[$fldVal]['table']))); } $rowFlag = @mysql_fetch_assoc($selFlags); $arrQueries[$fldVal] = "SELECT ".$arrTables[$fldVal]['field'].",".$rowFlag['COLUMN_NAME']." FROM ".$db.".".$arrTables[$fldVal]['table']." ORDER BY ".$rowFlag['COLUMN_NAME']; if ($act == 'edit') { $qSelect .= $tbl.'.'.$fldVal.', '; } else if ($fldPush) { if (array_key_exists($fldVal,$arrLutKeys) || array_key_exists($fldVal,$arrCsvKeys)) { $qSelectField = "(SELECT GROUP_CONCAT(".$arrTables[$fldVal]['table'].".".$rowFlag['COLUMN_NAME']." ORDER BY ".$db.".".$arrTables[$fldVal]['table'].".".$arrTables[$fldVal]['field'].") FROM ".$db.".".$arrTables[$fldVal]['table']." WHERE FIND_IN_SET(".$db.".".$arrTables[$fldVal]['table'].".".$arrTables[$fldVal]['field'].",".$db.".".$tbl.".".$fldVal.")) AS ".$fldVal; } else { if ($qord == $fldVal) { $qOrder = "ORDER BY ".$db.".".$arrLookups[$fldVal]['table'].".".$rowFlag['COLUMN_NAME']." ".$qsrt; } $qSelectField = $arrLookups[$fldVal]['table'].'.'.$rowFlag['COLUMN_NAME']; $qJoins .= $arrTables[$fldVal]['join']; array_push($arrForeignKeysTemp,$arrTables[$fldVal]['field']); } $qSelect .= $tbl.'.'.$fldVal.', '; $qSelect .= $qSelectField.', '; } } else if ($fldPush) { $qSelect .= $tbl.'.'.$fldVal.', '; } $validFld = $this->arrayKeyExists(preg_replace('/\[\]$/','',$fldVal),$_POST); $postVal = ($validFld) ? $_POST[$validFld] : ''; $postVal = (is_array($postVal)) ? implode(',',$postVal) : $postVal; if (preg_match($this->matchFileName,$arrComments[$cntCols]) && preg_match($this->matchModify,$act)) { $_FILES = $this->arrayClean($_FILES); $fileRem = ($postVal); $fileAdd = ($_FILES[$fldVal]['error'] == 0); $filePathByPost = (isset($this->arrFilePaths[$fldVal])) ? 'filepath_'.$this->arrFilePaths[$fldVal] : FALSE; $fileDst = ($fileRem && isset($_POST[$filePathByPost])) ? $_POST[$filePathByPost] : $this->fdst; $filePath = $fileDst.$postVal; $fileExt = explode('.',$postVal); $fileExt = end($fileExt); $fileShort = $fileDst.preg_replace('/\.'.$fileExt.'$/i', '', $postVal); $fileError = 0; if ($fileRem) { if (!@unlink($filePath)) { array_push($this->arrWarnings,'File not found at \''.$filePath.'\''); } foreach ($arrThmbs as $thmbKey => $thmbVal) { @unlink($fileShort.'_'.$thmbKey.'.'.$fileExt); } } else if ($fileAdd) { if (is_numeric($this->flen)) { $this->setFileLength($this->flen); } $this->setFileSize($this->fsiz); $this->setFileSrc($fldVal); $this->setFileDst($this->fdst); $this->setFileUnique($this->funq); $this->setFilesForbid($this->ffor); $this->setFilesAllow($this->fall); $arrFiles = $this->getFiles(); $fileError = $arrFiles[$fldVal]['error']; $fileCnt = count($arrFiles[$fldVal]); $fileAdd = ($fileCnt) ? TRUE : FALSE; } $fileSet = ($fileAdd || $fileRem); if (is_array($arrFileFlds[$fldVal]) && $fileSet) { foreach ($arrFileFlds[$fldVal] as $ffKey => $ffVal) { $fileField = $ffKey; $fileType = $ffVal['type']; $fileAttrib = $ffVal['attrib']; $fileVal = ($fileRem) ? 'NULL' : $arrFiles[$fldVal][$fileAttrib]; $fileVal = ($fileRem || preg_match($this->matchNumeric,$fileType)) ? $fileVal : "'".$fileVal."'"; if ($fileError) { array_push($this->arrWarnings,$fileError); } else { $qSet .= $fileField.'='.$fileVal.', '; } } } } else if (preg_match($this->matchNumeric,$arrTypes[$cntCols])) { if (preg_match('/[^0-9]+/',$postVal) || trim($postVal) == '') { $postVal = (trim($postVal) == '') ? ((strtolower($arrNulls[$cntCols]) == 'no') ? 0 : 'NULL') : "'".addslashes($postVal)."'"; } } else if (preg_match($this->matchEnum,$arrTypes[$cntCols]) || array_key_exists($fldVal,$arrLutKeys) || array_key_exists($fldVal,$arrCsvKeys)) { $postVal = (trim($postVal) == '') ? 'NULL' : "'".addslashes($postVal)."'"; } else if (preg_match($this->matchDateTime,$arrTypes[$cntCols])) { $postVal = (trim($postVal) == '') ? 'NULL' : "'".addslashes($postVal)."'"; } else { $postVal = ($htm) ? $postVal : strip_tags($postVal); $postVal = "'".addslashes($postVal)."'"; } if ($fldVal != $fld && !$fldFile) { $qSet .= $fldVal.'='.$postVal.', '; } $cntCols++; } } if ($id != '' && $act != 'select') { $qWhere = " WHERE ".$db.".".$tbl.".".$fld."=".$id; } else if (is_array($wfld) && is_array($wop) && is_array($wval) && $act == 'select') { $qWhere = " WHERE 1=1 "; foreach ($wfld as $whereKey => $whereVal) { if (trim($wfld[$whereKey]) != '' && trim($wop[$whereKey]) != '') { $whereType = $this->arrTypes[array_search($wfld[$whereKey],$this->arrFields)]; $whereIsNum = (preg_match($this->matchNumeric,$whereType)) ? TRUE : FALSE; $wvalue = (is_array($wval[$whereKey])) ? implode(',',$wval[$whereKey]) : $wval[$whereKey]; if (preg_match('/NULL$/',$wop[$whereKey])) { $wvalue = ''; } else if (preg_match('/(LIKE|NOT LIKE)/',$wop[$whereKey])) { $wvalue = "'%".$wvalue."%'"; } else if ($whereIsNum && is_numeric($wval[$whereKey])) { $wvalue = $wvalue; } else { $wvalue = "'".$wvalue."'"; } $qWhere .= " AND ".$db.".".$tbl.".".$wfld[$whereKey]." ".$wop[$whereKey]." ".$wvalue; } } } else if ($act == 'purge') { $qWhere = " WHERE ".$db.".".$tbl.".".$fld." IN (SELECT tempRecordId FROM ".$db.".scaffoldTempRecords WHERE ".$db.".scaffoldTempRecords.tempRecordTable = '".$tbl."')"; } if (strcmp($qWhere,$this->where) != 0) { $qsrow = 1; $qpg = 1; } if ($act == 'select') { $this->where = $qWhere; } $qSelect = preg_replace('/,\s*$/','',$qSelect); $qSet = preg_replace('/,\s*$/','',$qSet); $qlimit = "LIMIT ".($qsrow-1).",".$qpp; switch ($act) { case 'select': case 'edit': $queryNoWhere = $qSelect.' '.$qFrom.' '.$qJoins; $queryNoOrder = $queryNoWhere.' '.$qWhere; $queryNoLimit = $queryNoOrder.' '.$qOrder; $query = $queryNoLimit.' '.$qlimit; $arrQueries[$tbl.'_nowhere'] = $queryNoWhere; $arrQueries[$tbl.'_noorder'] = $queryNoOrder; $arrQueries[$tbl.'_nolimit'] = $queryNoLimit; $arrQueries[$tbl] = $query; break; case 'insert': case 'insertplus': $arrQueries[$tbl] = $qInsert.$qSet; break; case 'insertbulk': $arrQueries[$tbl] = $qInsertBulk; break; case 'update': $arrQueries[$tbl] = $qUpdate.$qSet.$qWhere; break; case 'delete': case 'purge': $arrQueries[$tbl] = $qDelete.$qWhere; break; } $this->arrQueries = $arrQueries; $timeEnd = $this->getTime(); return $arrQueries; } private function getQueryHighlight($query) { $query = htmlspecialchars($query); $query = preg_replace('/\\\\\'/','&#39;',$query); $query = stripslashes($query); $query = preg_replace('/((\(SELECT.+?\))( AS .+?(\s|,)))/i','<div class="sqlIndent">$2</div>$3',$query); $query = preg_replace($this->matchSqlReserved,'$1<br /><span class="sqlActs">$2</span> $5',$query); $query = preg_replace('/\)<\/div><br(.*?)>/i','<br />)</div>',$query); $query = preg_replace($this->matchSqlOps,'$1<span class="sqlOps">$2</span>$3',$query); $query = preg_replace($this->matchSqlActs,'$1<span class="sqlActs">$2</span>$3',$query); $query = preg_replace($this->matchSqlCons,'$1<span class="sqlCons">$2</span>$3',$query); $query = preg_replace($this->matchSqlMods,'$1<span class="sqlMods">$2</span>$3',$query); $query = preg_replace('/(\'([^\']+?)\'|\'\')/i','<span class="sqlText">$1</span>',$query); $query = preg_replace('/^<br \/>/i','',$query); $query = preg_replace('/,([^\s]+?)/',', $1',$query); return $query; } public function getTemp() { $con = $this->con; $db = $this->db; $tbl = $this->tbl; $results = @mysql_fetch_assoc(@mysql_query("SELECT COUNT(*) AS CNT FROM ".$db.".scaffoldTempRecords WHERE tempRecordTable = '".$tbl."'")); return ($results) ? (($results['CNT'] > 0) ? TRUE : FALSE) : FALSE; } public function getThumbSizes() { return array( '75'=>'75.....squarebox', '100'=>'100....squarebox', '125'=>'125....squarebox', '150'=>'150....squarebox', '240'=>'240....rectangle', '360'=>'360....rectangle', '480'=>'480....rectangle', '640'=>'640....rectangle', '800'=>'800....rectangle', '1024'=>'1024...rectangle', '1152'=>'1152...rectangle', '1280'=>'1280...rectangle', '1600'=>'1600...rectangle' ); } public function getTime() { $a = explode(' ',microtime()); return(double) $a[0] + $a[1]; } public function getTimeDiff($beg,$end) { echo 'Execution Time: '.number_format(($end - $beg),2).' seconds<br />'; } public function getWarnings() { $results = ''; $selWarnings = mysql_query("SHOW WARNINGS"); while ($rowWarning = mysql_fetch_assoc($selWarnings)) { $results .= 'WARNING #'.$rowWarning['Code'].': '.$rowWarning['Message'].'<br />'; } $this->arrWarnings = array_unique($this->arrWarnings); foreach ($this->arrWarnings as $warnKey => $warnVal) { $results .= 'WARNING #919'.$warnKey.': '.$warnVal.'<br />'; } return ($results == '') ? FALSE : $results; } public function imageToBase64($fileToEncode) { $fp = @fopen($fileToEncode,"r"); $buffer = ""; if(!$fp){ echo "ERROR opening file on server."; } else { while(!feof($fp)) { $buffer .= fgets($fp,4096); } } @fclose($fp); echo base64_encode($buffer); } private function isDate($string) { $return = FALSE; if ($string) { $string = trim($string); if ($string != '0000-00-00 00:00:00' && $string != '' && (is_numeric($string) || preg_match('/^([0-9]{2,4})-([0-1][0-9])-([0-3][0-9]) (?:([0-2][0-9]):([0-5][0-9]):([0-5][0-9]))?$/',$string))) { $d = date('j',strtotime($string)); $m = date('n',strtotime($string)); $y = date('Y',strtotime($string)); $return = checkdate($m,$d,$y); } } return $return; } public function scaffold($act=FALSE,$id=FALSE,$post=FALSE) { $timeBeg = $this->getTime(); global $arrHelp; global $qsrow; global $qpg; global $qpp; global $qord; global $qsrt; $con = $this->con; $usr = $this->usr; $pwd = $this->pwd; $db = $this->db; $tbl = $this->tbl; $mdd = $this->mdd; $dq = $this->dq; $pas = $this->pas; $bin = $this->bin; $ajb = $this->ajb; if ($con && $db && $tbl && $act) { if ($act != 'insertbulk') { $arrQueries = $this->getQuery($act,$id); $arrQueriesLen = count($arrQueries); $queryNoLimit = (isset($arrQueries[$tbl.'_nolimit'])) ? $arrQueries[$tbl.'_nolimit'] : FALSE; $query = ($act == 'edit' && $queryNoLimit) ? $queryNoLimit : ((isset($arrQueries[$tbl])) ? $arrQueries[$tbl] : NULL); } $err = $this->err; $errLen = count($err); $arrFields = $this->arrFields; $arrCols = $this->arrCols; $arrTypes = $this->arrTypes; $arrDefaults = $this->arrDefaults; $arrNulls = $this->arrNulls; $arrLabels = $this->arrLabels; $arrComments = $this->arrComments; $arrLookups = $this->arrLookups; $arrLutKeys = $this->arrLutKeys; $arrCsvKeys = $this->arrCsvKeys; $arrFilePaths = $this->arrFilePaths; $arrUidFlds = (isset($this->arrUidFlds)) ? $this->arrUidFlds : array(); $arrFieldsLen = count($arrFields); $fld = $this->fld; $flds = $this->flds; $strDisplayQuery = $this->getQueryHighlight($query); if ($dq && !preg_match('/'.$act.'/i','(insertbulk|export)')) { echo '<div class="query">'.$strDisplayQuery.'</div>'; } if ($errLen > 0) { try { throw new Exception('<div class="results"><strong>ERROR:</strong> '.$this->linkHelp.$err[0].'">'.$err[1].'</a></div>'); } catch (Exception $e) { echo $e->getMessage(); } return FALSE; } switch ($act) { case 'rulesedit': $strRulesTable = ''; $strRulesHead = ''; $strRulesBody = ''; $strColsToSelect = 'COLUMN_NAME,COLUMN_TYPE,EXTRA,COLUMN_COMMENT'; $cntRulesRow = 0; $selRulesQuery = " SELECT ".$strColsToSelect." FROM information_schema.COLUMNS WHERE information_schema.COLUMNS.TABLE_SCHEMA='".$db."' AND information_schema.COLUMNS.TABLE_NAME='".$tbl."' "; $arrRuleHeaders = explode(',',$strColsToSelect); foreach ($arrRuleHeaders as $ruleHeader) { $ruleHeaderLabel = $this->fieldToLabel(preg_replace('/.+_/','',$ruleHeader)); $strRulesHead .= '<th>'.preg_replace(array('/type/i','/extra/i','/comment/i'),array('','References','Add or Modify Rules Below'),$ruleHeaderLabel).'</th>'; } $selRules = @mysql_query($selRulesQuery); while ($rowRule = @mysql_fetch_assoc($selRules)) { $trClass = (($cntRowRules % 2 == 0) ? 'rowEven' : 'rowOdd'); $strRulesBody .= '<tr class="'.$trClass.'">'; $ruleColumnName = ''; foreach ($arrRuleHeaders as $ruleHeader) { $ruleHeaderValue = $rowRule[$ruleHeader]; $ruleHeaderLabel = strtolower(preg_replace('/.+_/','',$ruleHeader)); $ruleHeaderInput = ''; $tClass = 'cellMin cellMax'.ucfirst($ruleHeaderLabel); $dClass = ''; $sClass = ''; $tdTitle = ''; switch ($ruleHeader) { case 'COLUMN_NAME': $ruleColumnName = $ruleHeaderValue; $tdTitle = $ruleHeaderValue; break; case 'COLUMN_TYPE': $ruleHeaderValue = ' '.$this->linkHelp.'dtype" class="imageWrite imageType" title="Type: '.$ruleHeaderValue.'"></a>'; break; case 'EXTRA': $ruleHeaderValue = (isset($this->arrTables[$ruleColumnName])) ? $this->arrTables[$ruleColumnName]['table'].'.'.$this->arrTables[$ruleColumnName]['field'] : ''; $tdTitle = $ruleHeaderValue.(($ruleHeaderValue) ? ' (Reference Type: '.$this->arrTables[$ruleColumnName]['reftype'].')' : ''); break; case 'COLUMN_COMMENT': $ruleHeaderInput = '<input name="'.$ruleHeader.'[]" type="text" class="input inputRule" value="'.$ruleHeaderValue.'" onblur="setRule(this)" />'; $tClass = 'cellMax cellMax'.ucfirst($ruleHeaderLabel); $dClass = 'divMax w250'; $sClass = 'textRule textRuleSelected'; $tdTitle = 'Click here to add or modify rules for this field'; break; } $strRulesBody .= '<td class="'.$tClass.'" title="'.$tdTitle.'"><div class="'.$dClass.'"><span class="'.$sClass.'" onclick="getRule(this)">'.$ruleHeaderValue.'</span>'.$ruleHeaderInput.'</div></td>'; } $strRulesBody .= '</tr>'; $cntRowRules++; } $strRulesTable .= '<div class="divRules">'; $strRulesTable .= '<div class="actionHeader">Edit Rules in '.$this->fieldToLabel($this->tbl).'</div>'; $strRulesTable .= '<table id="table_rules" class="tableRules">'; $strRulesTable .= '<thead><tr>'.$strRulesHead.'</tr></thead>'; $strRulesTable .= '<tbody>'.$strRulesBody.'</thead>'; $strRulesTable .= '</table>'; $strRulesTable .= '<div class="actionFooter">'; $strRulesTable .= '<button type="button" id="btn_rulesupdate" name="btn_rulesupdate" value="rulesupdate" class="btn" onclick="setRules(this); setScaffold(this)">Update&nbsp;</button> '; $strRulesTable .= '<button type="button" id="btn_cancel" name="btn_cancel" value="select" class="btn" onclick="setScaffold(this)">Cancel&nbsp;</button> '; $strRulesTable .= '<div class="xpand"></div>'; $strRulesTable .= '</div>'; $strRulesTable .= '</div>'; echo $strRulesTable; break; case 'rulesupdate': if ($db && $tbl && isset($_POST['COLUMN_COMMENT']) && is_array($_POST['COLUMN_COMMENT'])) { $arrColumnComments = $_POST['COLUMN_COMMENT']; $insRulesQuery = "ALTER TABLE ".$db.".".$tbl." "; $selRulesQuery = " SELECT * FROM information_schema.COLUMNS WHERE information_schema.COLUMNS.TABLE_SCHEMA='".$db."' AND information_schema.COLUMNS.TABLE_NAME='".$tbl."' "; $selRules = @mysql_query($selRulesQuery); $cntRules = 0; while ($rowRule = @mysql_fetch_assoc($selRules)) { $colName = $rowRule['COLUMN_NAME']; $colDefault = $rowRule['COLUMN_DEFAULT']; $colNull = (preg_match('/yes/i',$rowRule['IS_NULLABLE'])) ? 'NULL' : 'NOT NULL'; $colCharset = $rowRule['CHARACTER_SET_NAME']; $colCollation = $rowRule['COLLATION_NAME']; $colDatatype = $rowRule['DATA_TYPE']; $colType = $rowRule['COLUMN_TYPE']; $colExtra = $rowRule['EXTRA']; $colComment = $arrColumnComments[$cntRules]; $insRulesQuery .= "CHANGE ".$colName." ".$colName." ".$colType." "; if (preg_match($this->matchString,$colDatatype)) { $insRulesQuery .= "CHARACTER SET ".$colCharset." COLLATE ".$colCollation." "; } $insRulesQuery .= $colNull." ".$colExtra." COMMENT '".mysql_real_escape_string($colComment)."', "; $cntRules++; } $insRulesQuery = preg_replace('/,\s*$/','',$insRulesQuery); $this->setQuery($act,$insRulesQuery); return ($this->pas) ? $this->scaffold('select',$id) : $this->results; } break; case 'export': $exportData = '<table><tbody>'; $exportData .= '<tr>'; foreach ($arrLabels as $labelKey => $labelVal) { $fldPush = (is_array($flds)) ? ((array_search($labelVal,$flds) !== FALSE || $labelVal == $fld) ? TRUE : FALSE) : TRUE; if ($fldPush) { $exportData .= '<th>'.$this->fieldToLabel($labelVal,$tbl).'</th>'; } } $exportData .= '</tr>'; $currRecord = 1; $selRecordsNoLimit = mysql_query($queryNoLimit); while ($rowRecord = mysql_fetch_row($selRecordsNoLimit)) { $currField = 0; $exportData .= '<tr>'; foreach ($rowRecord as $rowKey => $rowVal) { $currFieldName = $arrFields[$arrCols[$currField]]; $linkIsAjl = (array_key_exists($currFieldName,$arrLookups) && $this->ajl); $linkIsAjc = (array_key_exists($currFieldName,$arrCsvKeys) && $this->ajc); if (($linkIsAjl || $linkIsAjc) && $linkPrep === FALSE) { $linkTbl = $this->arrTables[$currFieldName]['table']; $linkFld = $this->arrTables[$currFieldName]['field']; $arrLinkVals = preg_split('/,/',$rowVal); $currField--; $linkPrep = TRUE; } else { $rowVal = $this->fieldToValue($rowVal,$arrTypes[$arrCols[$currField]],'read'); $rowText = $this->bbcode($rowVal,TRUE); if (isset($arrLinkVals) && is_array($arrLinkVals)) { $arrRowTexts = preg_split('/,/',$rowText); $rowText = ''; foreach ($arrRowTexts as $rowTextKey => $rowTextVal) { $rowText .= (($rowText == '') ? '' : ', ').$rowTextVal; } } unset($arrLinkVals); unset($arrRowTexts); $linkPrep = FALSE; $exportData .= '<td>'.$this->bbcode($rowText,TRUE).'</td>'; } $currField++; } $exportData .= '</tr>'; $currRecord++; } $exportData .= '</tbody></table>'; $exportNow = strtotime("now"); $exportYear = date('Y',$exportNow); $exportMonth = date('m',$exportNow); $exportDay = date('d',$exportNow); $exportName = 'export_'.strtolower($tbl).'_'.$exportYear.$exportMonth.$exportDay.'.xls'; header("Content-type: application/x-msexcel"); header("Content-Disposition: attachment; filename=$exportName"); header("Content-length: ". strlen($exportData)); header("Content-Transfer-Encoding: BINARY"); echo $exportData; break; case 'delete': case 'purge': case 'update': $this->setQuery($act,$query); if ($act == 'purge') { @mysql_query("DELETE FROM ".$db.".scaffoldTempRecords WHERE ".$db.".scaffoldTempRecords.tempRecordTable = '".$tbl."'"); } return ($pas) ? $this->scaffold('select',$id) : $this->results; break; case 'copy': $this->scaffold('edit','0',$post); break; case 'edit': if ($this->results) { echo $this->results; } if ($id) { echo '<input type="hidden" id="id" name="id" value="'.$id.'" />'; } $actionText = ($id) ? 'Editing Record #'.$id : 'Add a Record'; echo '<div class="divWrite">'; echo '<div class="actionHeader">'.$actionText.' in '.ucwords(preg_replace('/_/',' ',$tbl)).' </div>'; echo '<table id="tableEdit" class="tableWrite">'; echo '<tbody>'; $rowRecord = @mysql_fetch_assoc(@mysql_query($query)); if (!$rowRecord) { foreach ($arrFields as $fieldKey => $fieldVal) { $rowRecord[$fieldVal] = ''; } } $rowRecordLen = ($id > 0) ? count($rowRecord)-1 : count($rowRecord); $currField = 0; $rowTab = 0; foreach ($rowRecord as $rowKey => $rowVal) { $rowAdd = TRUE; $rowIsFilePath = FALSE; $rowFileType = FALSE; $rowFileString = strtolower($rowVal); $rowFileLink = ''; $rowType = $arrTypes[$currField]; $rowLabel = ''; if (preg_match($this->matchFile,$arrComments[$currField],$matchFile)) { $rowAdd = (preg_match('/(file|image)+(name|path)+/i', $matchFile[1])) ? TRUE : FALSE; $rowType = (preg_match('/(file|image)+name/i', $matchFile[1])) ? 'file' : 'hidden'; $rowFileRem = ($rowVal != ''); if ($rowFileRem && $rowType == 'file') { $docRoot = strtolower(str_replace('\\', '/',$_SERVER['DOCUMENT_ROOT'])); $rowFilePath = (isset($arrFilePaths[$rowKey])) ? $rowRecord[$arrFilePaths[$rowKey]] : $this->fdst; $rowFilePathAbs = preg_replace('#\/$#','',$rowFilePath).'/'.$rowVal; $rowFilePathRel = preg_replace('#'.str_replace('\/', '\/',$docRoot).'#i','',$rowFilePathAbs); $rowIsFilePath = ($rowType == 'hidden'); if (is_readable($rowFilePathAbs)) { $rowFileType = (is_array(@getimagesize($rowFilePathAbs))) ? 'image' : 'file'; $rowFileLink = '<a class="'.(($rowFileType == 'image') ? '' : 'fileUploaded').'" href="'.$rowFilePathRel.'" target="_blank" title="View or download this file">'.(($rowFileType == 'image') ? '<img src="'.$rowFilePathRel.'" alt="" class="imageUploaded" />' : 'View or download this file').'</a>'; } $rowLabel = '<span class="filename" title="Select checkbox to remove">'.$rowFileString.'</span>'; } } else if (preg_match($this->matchUid,$arrComments[$currField],$matchUid)) { $rowType = strtolower($matchUid[1]); } if ($arrFields[$currField] != $fld && $rowAdd) { $rowTab++; $rowType = ($rowType == 'file') ? (($rowVal == '') ? 'file' : 'checkbox') : $rowType; $rowHidden = ($rowType == 'hidden'); $rowFile = ($rowType == 'file'); $rowLabelClass = ($rowType == 'checkbox') ? 'checkboxLabel' : ''; $rowVal = (!$id) ? (($arrDefaults[$currField] == '(NULL)') ? $rowVal : $arrDefaults[$currField]) : $rowVal; $rowVal = ($post[$rowKey]) ? $post[$rowKey] : $rowVal; $rowNulls = (strtolower($arrNulls[$currField]) == 'no') ? FALSE : TRUE; $rowBlank = ($rowNulls) ? TRUE : FALSE; $rowTypeNulls = ($rowNulls) ? '' : ' (no nulls)'; $rowReqAst = ($rowNulls) ? '' : '&nbsp;*&nbsp;&nbsp;'; $rowReqTitle = ($rowNulls) ? '' : 'title="Required field"'; $rowTypeData = ucfirst(preg_replace('/\(.+?\)/','',$arrTypes[$currField])); $rowTypeBtn = ' '.$this->linkHelp.'dtype" class="imageWrite imageType" title="Type: '.$rowTypeData.$rowTypeNulls.'"></a>'; echo ($rowHidden) ? '' : '<tr>'; echo ($rowHidden) ? '' : '<th>'.$rowTypeBtn.' '.$this->fieldToLabel($arrLabels[$currField],$tbl).'</th>'; echo ($rowHidden) ? '' : '<td '.$rowReqTitle.'>'; $classValidate = ($rowNulls) ? '' : 'notnull'; $rowOptions = array( 't'=>$rowType, 'n'=>(($rowIsFilePath) ? 'filepath_'.$rowKey : $rowKey), 'v'=>$rowVal, 'c'=>$classValidate.' binField', 'b'=>$rowBlank, 'tab'=>(($rowHidden) ? '' : $rowTab) ); echo ($rowType == 'checkbox') ? $rowFileLink.'<label for="'.$rowKey.'" class="'.$rowLabelClass.'">' : ''; echo $this->getFormField($rowOptions); echo ($rowType == 'checkbox') ? $rowLabel.'</label>' : ''; echo ($rowHidden || $rowFile) ? '' : (($this->bin) ? '<label for="bin_'.$rowKey.'"><input type="checkbox" id="bin_'.$rowKey.'" name="bin_'.$rowKey.'" value="1" onclick="getBinToggle(this)" title="Toggle this field for Bulk Inserts" class="binToggle" /></label>' : ''); echo ($rowHidden) ? '' : '</td>'; echo ($rowHidden) ? '' : '</tr>'; } $currField++; } echo '</tbody>'; echo '</table>'; echo '<div class="actionFooter">'; if ($id) { echo '<button type="button" id="btn_update_'.$id.'" name="btn_update_'.$id.'" value="'.$id.'" class="btn" onclick="setScaffold(this)">Update&nbsp;</button> '; echo '<button type="button" id="btn_copy_'.$id.'" name="btn_copy_'.$id.'" value="'.$id.'" class="btn" onclick="setScaffold(this)">Copy&nbsp;</button> '; echo '<button type="button" id="btn_delete_'.$id.'" name="btn_delete_'.$id.'" value="'.$id.'" class="btn" onclick="setScaffold(this)">Delete&nbsp;</button> '; } else { echo '<button type="button" id="btn_insert" name="btn_insert" value="insert" class="btn" onclick="setScaffold(this)">Insert&nbsp;</button> '; if ($this->bin) { echo '<button type="button" id="btn_insertplus" name="btn_insertplus" value="insertplus" class="btn" onclick="setScaffold(this)">Insert + 1&nbsp;</button> '; echo '<div class="insertBulk">'; $arrBins[''] = 'Disabled'; $arrBins['5'] = '5 Records'; $arrBins['10'] = '10 Records'; $arrBins['25'] = '25 Records'; $arrBins['50'] = '50 Records'; $arrBins['100'] = '100 Records'; $arrBins['250'] = '250 Records'; $arrBins['500'] = '500 Records'; $arrBins['1000'] = '1000 Records'; $arrBins['2500'] = '2500 Records'; $arrBins['5000'] = '5000 Records'; $arrBins['10000'] = '10000 Records'; $binOptions = array('n'=>'insertbulkcount','v'=>'','c'=>'selectSmall','chg'=>'getBinCheck(this)','a'=>$arrBins); echo $this->getFormField($binOptions); echo '<button type="button" id="btn_insertbulk" name="btn_insertbulk" value="insertbulk" class="btn" onclick="setScaffold(this)">Bulk Insert&nbsp;</button> '; echo '</div>'; } } echo '<button type="button" id="btn_cancel" name="btn_cancel" value="select" class="btn" onclick="setScaffold(this)">Cancel&nbsp;</button> '; echo '<div class="xpand"></div>'; echo '</div>'; echo '</div>'; break; case 'insertbulk': for ($i=0; $i < $_POST['insertbulkcount']; $i++) { $arrQueries = $this->getQuery($act,'0'); $query = $arrQueries[$tbl]; mysql_query("LOCK TABLES ".$tbl." WRITE"); $qresults = $this->setQuery($act,$query); mysql_query("UNLOCK TABLES"); if (is_array($qresults)) { $i = $i + count($qresults); $this->binCount = $i; $this->setBinValues($qresults); } else { array_push($this->arrWarnings,$qresults); } } echo '<div class="results">'; $act = preg_replace($this->matchAction,'$1',$act); if ($this->binCount > 0) { echo '['.number_format($this->binCount).'] items were '.$act.'ed successfully at '.date('g:i a',strtotime("now")).'<br />'; } else { echo $qresults; } echo '</div>'; return ($this->pas) ? $this->scaffold('select',$id) : FALSE; break; case 'insert': case 'insertplus': $this->setQuery($act,$query); if ($act == 'insertplus') { $this->scaffold('edit','0',$post); } else { return ($this->pas) ? $this->scaffold('select',$id) : $this->results; } break; case 'select': $srt = (strtolower($qsrt) == 'desc') ? '' : '__desc'; $cntLabels = count($arrLabels); $colWidth = round(97/$cntLabels).'%'; $iCols = $cntLabels+3; $classMinDataTable = ($mdd) ? 'tableMin' : ''; if ($this->results) { echo $this->results; } echo '<div id="divRead" class="divRead">'; echo '<input type="hidden" id="fld" name="fld" value="'.$fld.'" />'; echo '<input type="hidden" id="id" name="id" value="" />'; echo '<table id="tableRead" class="table tableRead resizable '.$classMinDataTable.'">'; echo '<tbody>'; echo '<tr>'; if ($this->fld != '') { echo '<th class="cellStatic"><button type="button" id="btn_edit_0" name="btn_edit_0" value="0" class="btn btnAdd" onclick="setScaffold(this)" title="Add a new record" tabindex="10"></button></th>'; echo '<th class="cellStatic">Modify</th>'; echo '<th class="cellStatic">Delete</th>'; echo '<th class="cellStatic">Toggle</th>'; } else { echo '<th>&nbsp;</th>'; } foreach ($arrLabels as $labelKey => $labelVal) { $fldPush = (is_array($flds)) ? ((array_search($labelVal,$flds) !== FALSE || $labelVal == $fld) ? TRUE : FALSE) : TRUE; if ($fldPush) { echo '<th><a href="javascript:void(0)" id="link_sort_'.$labelVal.$srt.'" onclick="setScaffold(this)" title="Order by this column">'.$this->fieldToLabel($labelVal,$tbl).'</a></th>'; } } echo '</tr>'; $currRecord = 1; $selRecords = @mysql_query($query); $selRecordsNoLimit = @mysql_query($queryNoLimit); $cntRecords = ($selRecordsNoLimit) ? @mysql_num_rows($selRecordsNoLimit) : FALSE; if ($cntRecords > 0) { while ($rowRecord = mysql_fetch_row($selRecords)) { $classRecord = (($currRecord-1) % 2 == 0) ? 'rowEven' : 'rowOdd'; $classRecordSelected = ''; $rowRecordLen = count($rowRecord); $currField = 0; $tdRow = $tdMod = $tdDel = $tdRecord = ''; echo '<tr id="record_row_'.$currRecord.'" class="row '.$classRecord.'">'; $tdRow = '<td class="cellStatic [[[__RECORD__SELECTED__]]]">'.((($qpg-1) * $qpp) + $currRecord).'</td>'; foreach ($rowRecord as $rowKey => $rowVal) { $currFieldName = $arrFields[$arrCols[$currField]]; if ($currFieldName == $fld) { if ($rowVal == $id && $id) { $classRecordSelected = 'rowSelected'; } $tdMod = '<td class="cellStatic [[[__RECORD__SELECTED__]]]"><div class="cell"><button type="button" id="btn_edit_'.$rowVal.'" name="btn_edit_'.$rowVal.'" value="'.$rowVal.'" class="btn btnEdit" onclick="setScaffold(this)" title="Edit this record" tabindex="'.($currField + 20).'"></button></div></td>'; $tdDel = '<td class="cellStatic [[[__RECORD__SELECTED__]]]"><div class="cell"><button type="button" id="btn_delete_'.$rowVal.'" name="btn_delete_'.$rowVal.'" value="'.$rowVal.'" class="btn btnDelete" onclick="setScaffold(this)" title="Delete this record" tabindex="'.($currField + 21).'"></button></div></td>'; $tdTog = '<td class="cellStatic [[[__RECORD__SELECTED__]]]"><div class="cell"><button type="button" id="btn_toggle_'.$currRecord.'" name="btn_toggle_'.$currRecord.'" value="'.$currRecord.'" class="btn btnToggle" onclick="setScaffold(this)" title="Toggle view for this record" tabindex="'.($currField + 22).'"></button></div></td>'; } $linkIsAjl = (array_key_exists($currFieldName,$arrLookups) && $this->ajl); $linkIsAjc = (array_key_exists($currFieldName,$arrCsvKeys) && $this->ajc); if (($linkIsAjl || $linkIsAjc) && $linkPrep === FALSE) { $linkTbl = $this->arrTables[$currFieldName]['table']; $linkFld = $this->arrTables[$currFieldName]['field']; $arrLinkVals = array(); $arrRowVals = preg_split('/,/',$rowVal); foreach ($arrRowVals as $rowValId) { array_push($arrLinkVals,'<a href="javascript:void" id="edit_link_'.strtolower(preg_replace('/_+/','+',$linkTbl)).'_'.preg_replace('/_+/','+',$linkFld).'_'.preg_replace('/_+/','+',$rowValId).'" class="linkEdit" onclick="setScaffold(this)" title="Edit this item">'); } $currField--; $linkPrep = TRUE; } else { $rowVal = $this->fieldToValue($rowVal,$arrTypes[$arrCols[$currField]],'read'); $classMinDataCell = ($mdd) ? 'cellMin' : ''; $classAlignCell = (is_numeric($rowVal) || preg_match('/^(true|false|yes|no)$/i',$rowVal)) ? 'aCenter' : 'aLeft'; $rowText = $this->bbcode($rowVal,TRUE); if (isset($arrLinkVals) && is_array($arrLinkVals)) { $arrRowTexts = preg_split('/,/',$rowText); $rowText = ''; foreach ($arrRowTexts as $rowTextKey => $rowTextVal) { $rowText .= ($rowText == '') ? '' : ', '; $rowText .= (preg_match('/>NULL</i',$rowTextVal)) ? $rowTextVal : ((isset($arrLinkVals[$rowTextKey]))?$arrLinkVals[$rowTextKey]:'').$rowTextVal.'</a>'; } } $tdRecord .= '<td class="'.$classMinDataCell.' [[[__RECORD__SELECTED__]]]" width="'.$colWidth.'"><div class="cell '.$classAlignCell.'">'.$rowText.'</div></td>'; unset($arrLinkVals); unset($arrRowVals); $linkPrep = FALSE; } $currField++; } echo preg_replace('/\[\[\[__RECORD__SELECTED__\]\]\]/', $classRecordSelected, $tdRow.$tdMod.$tdDel.$tdTog.$tdRecord); echo '</tr>'; $currRecord++; } } else { echo '<tr class="row"><td colspan="'.$iCols.'"><h4>No Records Found</h4></td></tr>'; } echo '</tbody>'; echo '</table>'; echo '</div>'; $timeEnd = $this->getTime(); $this->getTimeDiff($timeBeg,$timeEnd); return $cntRecords; break; } } else { return FALSE; } } public function setBinValues($qresults) { $tableScaffoldTemp = $this->db.'.scaffoldTempRecords'; $createScaffoldTempQuery = "CREATE TABLE IF NOT EXISTS ".$tableScaffoldTemp." (tempRecordTable VARCHAR(255),tempRecordId INT(10)) ENGINE=INNODB CHECKSUM=1 COMMENT='' DELAY_KEY_WRITE=1 ROW_FORMAT=DYNAMIC"; $createScaffoldTempResults = mysql_query($createScaffoldTempQuery); $grantPermsScaffoldTempQuery = "GRANT ALL PRIVILEGES ON scaffoldTempRecords.* TO ".$usr."@".$srv." IDENTIFIED BY '".$pwd."'"; $grantPermsScaffoldTemp = mysql_query($grantPermsScaffoldTempQuery); if ($createScaffoldTempResults) { $values = ''; foreach ($qresults as $resultKey => $resultVal) { $values .= ($values == '') ? "('".$this->tbl."',".$resultVal.")" : ",('".$this->tbl."',".$resultVal.")"; } $insScaffoldTempQuery = "INSERT INTO ".$tableScaffoldTemp." (tempRecordTable,tempRecordId) VALUES ".$values; mysql_query($insScaffoldTempQuery); } } public function setConn($options) { $aboutSlug = $this->aboutSlug; $fdst = $where = ''; $luf = $aboutSlug; $pas = $ajl = $aje = $ajs = $ajc = $ajb = $htm = $funq = $ffor = TRUE; $srv = $usr = $pwd = $db = $tbl = $flds = $dq = $mdd = $bin = $ssh = $wfld = $wop = $wval = $thmbs = $fall = $flen = $fsiz = FALSE; foreach($options as $k => $v) { $$k = $options[$k]; } if ($srv && $usr && $pwd) {  if ($this->getHost($srv)) { $con = (@mysql_connect($srv,$usr,$pwd)) ? TRUE : 'ERROR #'.mysql_errno().': '.mysql_error(); if ($con === TRUE) { $rowServerAccess = @mysql_fetch_assoc(@mysql_query("SELECT COUNT(*) AS CNT FROM information_schema.USER_PRIVILEGES WHERE information_schema.USER_PRIVILEGES.PRIVILEGE_TYPE REGEXP '".$this->matchAdmin."' AND information_schema.USER_PRIVILEGES.GRANTEE LIKE '\'".$usr."\'@\'%\''")); $rowSchemaAccess = @mysql_fetch_assoc(@mysql_query("SELECT (SELECT COUNT(GRANTEE) AS CNT FROM information_schema.SCHEMA_PRIVILEGES WHERE information_schema.SCHEMA_PRIVILEGES.GRANTEE LIKE '\'".$usr."\'@\'%\'' AND information_schema.SCHEMA_PRIVILEGES.TABLE_SCHEMA = 'information_schema' AND information_schema.SCHEMA_PRIVILEGES.PRIVILEGE_TYPE = 'SELECT') + (SELECT COUNT(GRANTEE) AS CNT FROM information_schema.USER_PRIVILEGES WHERE information_schema.USER_PRIVILEGES.GRANTEE LIKE '\'".$usr."\'@\'%\'' AND (information_schema.USER_PRIVILEGES.PRIVILEGE_TYPE = 'SELECT' OR information_schema.USER_PRIVILEGES.PRIVILEGE_TYPE = 'USAGE')) AS CNT")); $rowDatabaseAccess = @mysql_fetch_assoc(@mysql_query("SELECT COUNT(GRANTEE) AS CNT FROM information_schema.USER_PRIVILEGES WHERE information_schema.USER_PRIVILEGES.GRANTEE LIKE '\'".$usr."\'@\'%\'' AND information_schema.USER_PRIVILEGES.PRIVILEGE_TYPE REGEXP '(CREATE|DROP|SELECT|INSERT|UPDATE|DELETE)'")); $rowDatabaseUsage = @mysql_fetch_assoc(@mysql_query("SELECT COUNT(GRANTEE) AS CNT FROM information_schema.USER_PRIVILEGES WHERE information_schema.USER_PRIVILEGES.GRANTEE LIKE '\'".$usr."\'@\'%\'' AND information_schema.USER_PRIVILEGES.PRIVILEGE_TYPE = 'USAGE'")); $rowDatabaseName = @mysql_fetch_assoc(@mysql_query("SELECT COUNT(SCHEMA_NAME) AS CNT FROM information_schema.SCHEMATA WHERE information_schema.SCHEMATA.SCHEMA_NAME = '".$db."'")); $rowDatabaseTable = @mysql_fetch_assoc(@mysql_query("SELECT COUNT(TABLE_NAME) AS CNT FROM information_schema.TABLES WHERE information_schema.TABLES.TABLE_SCHEMA = '".$db."' AND information_schema.TABLES.TABLE_NAME = '".$tbl."'")); $db = ($rowDatabaseName) ? (($rowDatabaseName['CNT'] > 0) ? $db : FALSE) : FALSE; $tbl = ($rowDatabaseTable) ? (($rowDatabaseTable['CNT'] > 0) ? $tbl : FALSE) : FALSE; $sa = ($rowSchemaAccess) ? (($rowSchemaAccess['CNT'] > 0) ? TRUE : FALSE) : FALSE; $da = ($rowDatabaseAccess && $rowDatabaseAccess['CNT'] >= 6) ? TRUE : (($rowDatabaseUsage && $rowDatabaseUsage['CNT'] > 0) ? TRUE : FALSE); $arrReq = array(); $arrReq['sa'] = $sa; if ($db) { $arrReq['db'] = $db; $arrReq['da'] = $da; } if ($tbl) { $arrReq['tbl'] = $tbl; } foreach ($arrReq as $reqKey => $reqVal) { if ($reqVal === FALSE) { $this->setError($reqKey,TRUE); return FALSE; } } $arrOptions = explode(',','where,sa,da,luf,db,srv,usr,pwd,tbl,flds,mdd,dq,pas,bin,htm,ssh,ajl,aje,ajs,ajc,ajb,wfld,wop,wval,thmbs,fdst,funq,flen,fsiz,fall,ffor,con'); foreach ($arrOptions as $optionKey => $optionVal) { $val = $optionVal; $this->$optionVal = $$val; } $this->fdst = (preg_match('/^(\/|[a-zA-Z]:)/',$this->fdst)) ? $this->fdst : getcwd().'/'.$this->fdst; $this->fdst = preg_replace('/\/$/','',str_replace('\\','/',$this->fdst)).'/'; $this->admin = ($rowServerAccess) ? (($rowServerAccess['CNT'] > 0) ? TRUE : FALSE) : FALSE; $this->arrThmbs = $this->getThumbSizes(); return TRUE; } else {  $this->setError('con',TRUE,array($usr,$srv,$pwd)); return FALSE; } } else {  $this->setError('srv',TRUE,array($srv)); } } return FALSE; } public function setError($errType,$errThrow=FALSE,$errVars=array()) { global $qpid; if ($qpid == '') { switch ($errType) { case 'ext': $errString = $errVars[0]; break; case 'srv': $errString = 'The database host server \''.$errVars[0].'\' cannot be reached'; break; case 'usr': $errString = 'Database user name is either blank or invalid!'; break; case 'pwd': $errString = 'Database password is either blank or invalid!'; break; case 'db': $errString = 'Database name is either blank or invalid!'; break; case 'tbl': $errString = 'Database table name is either blank or invalid!'; break; case 'fld': $errString = 'No unique or primary index field found for this table!'; break; case 'sa': $errString = 'User does not have access to information schema table!'; break; case 'da': $errString = 'User does not have required access to specified database!'; break; case 'scta': $errString = 'User does not have required access to run "SHOW CREATE TABLE '.$errVars[0].'.'.$errVars[1].'"!'; break; case 'dtype': $errString = 'The field \''.$errVars[0].'\' requires a numeric value'; break; case 'norec': $errString = 'No records found for lookup table \''.$errVars[0].'\''; break; case 'ajl': $errString = 'Lookup flag for referential lookup table \''.$errVars[0].'\' is blank or invalid'; break; case 'con': $errString = 'Access denied for user \''.$errVars[0].'\'@\''.$errVars[1].'\' using password \''.preg_replace('/./','*',$errVars[2]).'\''; break; case 'config': $errString = 'Configuration override file was not found. Default settings will apply.'; break; default: $errString = 'A general error has occurred!'; break; } array_push($this->err,$errType); array_push($this->err,$errString); if ($errThrow) { try { throw new Exception('<div class="results">ERROR: '.$this->linkHelp.$errType.'">'.$errString.'</a></div>'); } catch (Exception $e) { echo $e->getMessage(); } } return FALSE; } } public function setQuery($act,$query) { $warnings = ''; $arrTablesReadOnly = explode(',',$this->listTablesReadOnly); if (array_search($this->tbl,$arrTablesReadOnly) !== FALSE && preg_match('/(create|drop|insert|update|delete)/i',$act)) { $results = 'ERROR #1142: '.strtoupper($act).' command denied to user \''.$this->usr.'\'@\'%\' for table \''.$this->tbl.'\''; } else { $results = (mysql_query($query)) ? TRUE : 'ERROR #'.mysql_errno().': '.mysql_error(); } if ($results === TRUE) { $insertId = mysql_insert_id(); $insertedRows = (mysql_affected_rows() + $insertId -1); $warnings = $this->getWarnings(); } if ($act == 'insertbulk') { return ($results === TRUE) ? range($insertId,$insertedRows) : $results; } else { $id = ($act == 'insert' || $act == 'insertplus') ? $insertId : $this->id; $resultsOutput = '<div class="results">'; if ($results === TRUE) { $action = preg_replace($this->matchAction,'$1',$act); $resultsOutput .= $warnings; $resultsOutput .= ($act == 'rulesupdate') ? 'Rules for table \''.strtoupper($this->tbl).'\' updated ' : (($act == 'purge') ? 'All items purged ' : 'Record #'.$id.' '.$action.'ed '); $resultsOutput .= 'successfully at '.date('g:i a',strtotime("now")); } else { $resultsOutput .= '<div class="error">'.$results.'</div>'; } $resultsOutput .= '</div>'; $this->results = $resultsOutput; } } public function strToBoolean($string='') { $string = strtolower(trim($string)); return (preg_match('/(true|yes|[1-9]+)/i', $string)) ? TRUE : FALSE; } public function strToInt($string='') { $string = strtolower(trim($string)); return (preg_match('/(true|yes)/i', $string)) ? 1 : 0; } public function textTitleCaps($title) { $title = preg_replace("/&#8220;/", '&#8220; ', $title); $title = preg_replace("/&#8216;/", '&#8216; ', $title); $title = preg_replace_callback("/(?<=(?<!:|;)\W)(A|An|And|At|But|By|Else|For|From|If|In|Into|Nor|Of|On|Or|The|To|With)(?=\W)/",array(__CLASS__,'textTitleCapsCallback'), ucwords($title)); $specialwords = array("iPod","iMovie","iTunes","iPhone"," HTML",".html"," PHP", ".php"); $title = preg_replace("/&#8220; /", '&#8220;', $title); $title = preg_replace("/&#8216; /", '&#8216;', $title); return $title; } public function textTitleCapsCallback($matches) { if (isset($matches[1])) { return strtolower($matches[1]); } } public function trunc($string='',$maxlen,$elip=TRUE) { if (strlen($string) > $maxlen) { $string = substr($string,0,$maxlen); $string = explode(' ',$string); if (count($string) > 1) { array_pop($string); } $string = implode(' ',$string); $string = preg_replace('/([^a-zA-Z0-9]+)$/','',$string); $string .= ($elip) ? '...' : ''; } return $string; } public function uuid($prefix='') { $chars = uniqid(md5(rand())); $uuid = substr($chars,0,8); $uuid .= substr($chars,8,4); $uuid .= substr($chars,12,4); $uuid .= substr($chars,16,4); $uuid .= substr($chars,20,12); return $prefix.$uuid; } } $os = new Amplescaffolder(); $arrAbout = $os->about(); $arrThmbs = $os->getThumbSizes(); if ($postMaxed) { $postErrNo = 14; $postErr = $os->getError($postErrNo); $os->results = '<div class="results">WARNING #90'.$postErrNo.': '.$os->linkHelp.'postmax" target="_new">'.$postErr.'</a></div>'; } if (!$qconfig) { $os->results = '<div class="results">NOTICE: '.$os->linkHelp.'config" target="_new">Configuration override file was not found. Default settings will apply.</a></div>'; } if ($qact == 'export') { $conn = $os->setConn($o); if ($conn) { $os->scaffold($qact); } } else { echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'; echo '<html xmlns="http://www.w3.org/1999/xhtml">'; echo '<head>'; echo '<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />'; echo '<title>::: '.$arrAbout['title'].' :::</title>'; echo '<style type="text/css" /> .cellStatic { text-align: center !important; white-space: nowrap !important; width: 1%; } .cellStatic .cell { text-align:center; } .aCenter { text-align: center !important; } .aLeft { text-align: left !important; } .aRight { text-align: right !important; } .actionFooter { -webkit-border-bottom-left-radius: 9px; -webkit-border-bottom-right-radius: 9px; border-bottom-left-radius: 9px; border-bottom-right-radius: 9px; border-radius-bottomleft-width: 9px; border-radius-bottomleft-width: 9px; border-radius-bottomright-width: 9px; border-radius-bottomright-width: 9px; border-style: solid; border-width: 1px; margin: -1px auto 10px auto; padding: 5px 15px; width: 704px; } .divWrite .actionFooter { margin: -1px auto 0 !important; } .actionFooter .btn { float: right !important; height: 20px; } .actionFooter .insertBulk { clear: none !important; float: left !important; height: 20px; margin-right: 1px; } .actionFooter .insertBulk .btn { clear: none !important; float: left !important; height: 20px; margin-right: 1px; } .actionFooter .insertBulk .select { clear: none !important; float: left !important; height: 20px; margin-right: 1px; } .actionFooter .select { width: 125px !important; } .actionFooter td { padding: 3px 5px 2px 5px !important; } .actionHeader { border-style: solid; border-width: 1px; padding: 5px 15px; width: 704px; } .actionHeader { -webkit-border-top-left-radius: 9px; -webkit-border-top-right-radius: 9px; border-radius-topleft-width: 9px; border-radius-topleft-width: 9px; border-radius-topright-width: 9px; border-radius-topright-width: 9px; border-top-left-radius: 9px; border-top-right-radius: 9px; font-weight: bold; margin: 0 auto 10px auto; } .actionRow .btn { float: right !important; height: 20px; } .binToggle { display: none; float: right; } .binToggleOn { display: block; } .btn { -khtml-opacity: 0.5; -moz-opacity: 0.5; background-color: transparent; border:none; filter: alpha(opacity="50"); font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; margin: 1px; opacity: 0.5; padding: 1px; } .btn:hover { -khtml-opacity: 1; -moz-opacity: 1; background-color: transparent; border:none; cursor: pointer; filter: alpha(opacity="100"); opacity: 1; } .btnAdd { background-image: url(data:image/gif;base64,R0lGODlhEAAQAJEAADMzM////////wAAACH5BAEHAAIALAAAAAAQABAAAAImlI+pywYP2gEhRCmoxbleBT1eiGjVeX4dyqqh9jIwN2O1RHI6VwAAOw==); background-repeat: no-repeat; font-size: 100%; height: 16px; padding: 0; text-transform: uppercase; width: 16px; } .btnDelete { background-image: url(data:image/gif;base64,R0lGODlhEAAQAJEAADMzM////////wAAACH5BAEHAAIALAAAAAAQABAAAAIplI+pywL/mgGhAgZzTrR6fyHaqFBmYC7nqqJuWr5vu6LtZ6ljJPW+UQAAOw==); background-repeat: no-repeat; font-size: 100%; height: 16px; padding: 0; text-transform: uppercase; width: 16px; } .btnToggle { background-image: url(data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAK8AAACvABQqw0mAAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNAay06AAAABvSURBVDiNrVNBDsAgCINlP4L/v4A/dZfFsDCQBJuYiNoGW2UANME1YhPRnW2o6mrNzDhVABCGiMDjrX/Pbsk7kRa5EgkeqOqam9mnbnvgu6nuD+BwjD66bD1EOjXxbIyZSGUkI/lM3aecCnQxjvEBhy50XooO3B0AAAAASUVORK5CYII=); background-repeat: no-repeat; font-size: 100%; height: 16px; padding: 0; text-transform: uppercase; width: 16px; } .btnEdit { background-image: url(data:image/gif;base64,R0lGODlhEAAQAJEAADMzM////7i4uP///yH5BAEHAAMALAAAAAAQABAAAAIjnI+pywudQHhwyDCh3DqI3EgfxYhg6Z1OSq5jdbUlIFf2bRQAOw==); background-repeat: no-repeat; font-size: 100%; height: 16px; padding: 0; text-transform: uppercase; width: 16px; } .btnExclaim { background-image: url(data:image/gif;base64,R0lGODlhEAAQAKIAADMzM93d3ZmZmUFBQe7u7lVVVaqqqv///yH5BAEHAAcALAAAAAAQABAAAANJeLrc/jCYAcAw4YlRSAhEMQhNMGRHpZioYhSLqhQGMxAxsBADA7SyQ0AXAxKFx8MNwmO8cgsag6WQURmbzic0ekgoFgxkTB4nAAA7); border-style: solid; border-width: 1px; float: left; height: 16px; margin: 2px 0 0 4px; padding: 0; width: 16px; } .btnQueryAdvancedAdd { border-style: solid; border-width: 1px; height: 22px; padding: -2px 0 0 0; width: 24px; } .cellMin div { cursor: default !important; height: 20px; min-height: 20px; min-width: 50px; overflow: hidden; width: auto; } .checkbox { left: 0; position: absolute; top: 0; } .checkboxLabel { cursor: pointer; float: left; margin: 5px 0 1px -4px !important; padding: 0 0 0 21px; position: relative; } .divRead { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -khtml-border-radius: 9px; -moz-border-radius: 9px; -moz-box-shadow: 5px 1px 10px -6px #022421; -webkit-box-shadow: 5px 1px 10px -6px #022421; box-shadow: 5px 1px 10px -6px #022421; -webkit-border-radius: 9px; border-radius: 9px; margin: 15px 0; overflow-x: scroll; overflow-y: visible; padding: 0 0 1px 0; text-align: center; width: 100%; } .divWrite { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -khtml-border-radius: 9px; -moz-border-radius: 9px; -moz-box-shadow: 5px 6px 10px -6px #022421; -webkit-box-shadow: 5px 6px 10px -6px #022421; box-shadow: 5px 6px 10px -6px #022421; -webkit-border-radius: 9px; border-radius: 9px; margin: 0 auto; overflow: hidden; padding: 0; text-align: center; width: 736px; } .dpButton { border-style: solid; border-width: 1px; cursor: pointer; font-family: Verdana; font-size: 10px; } .dpButton { width: 20px; } .dpDayHighlight { border: none !important; } .dpDayHighlightTD { border-style: solid; border-width: 1px; height: 18px; width: 23px; } .dpDayTD { border-style: solid; border-width: 1px; } .dpTD { border-style: solid; border-width: 1px; height: 20px; width: 25px; } .dpTDHover { border-style: solid; border-width: 1px; cursor: pointer; } .dpTable { border-style: solid; border-width: 1px; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px; text-align: center; } .dpTitleText { font-size: 11px; } .dpTodayButton { border-style: solid; border-width: 1px; cursor: pointer; font-family: Verdana; font-size: 10px; width: 65px; } .file { width: auto !important; } .flowHide { height: 20px; min-height: 20px; min-width: 50px; overflow-x: hidden; overflow-y: hidden; width: auto; } .flowShow { overflow: visible !important; } .help { margin: 30px auto; padding-bottom: 1500px; text-align: left; width: 736px; } .help .linkHome { -khtml-opacity: .3; -moz-opacity: .3; background-position: 0 0; background-repeat: no-repeat; display: block; filter: alpha(opacity="30"); float: right; height: 16px; margin: 0; opacity: .3; padding: 0; width: 16px; } .help .linkHome:hover { -khtml-opacity: 1 !important; -moz-opacity: 1 !important; filter: alpha(opacity="100") !important; opacity: 1 !important; } .help .linkTop { -khtml-opacity: .3; -moz-opacity: .3; background-position: 0 0; background-repeat: no-repeat; display: block; filter: alpha(opacity="30"); float: right; height: 16px; margin: 0; opacity: .3; padding: 0; width: 16px; } .help .linkTop:hover { -khtml-opacity: 1 !important; -moz-opacity: 1 !important; filter: alpha(opacity="100") !important; opacity: 1 !important; } .help .links { clear: left; float: right; height: 16px; margin: 0; padding: 0; width: 32px; } .help h5 { border-bottom-style: dashed; border-bottom-width: 1px; margin: 10px 0; } .help p { padding: 5px 0 20px 0; } .hidden { clear: both; float: left; font-size: 90%; width: 350px; } .imageCalendar { background-image: url(data:image/gif;base64,R0lGODlhEAAPAKIAAKVNSkpNpUpNSqWmpdbT1v///wAAAAAAACH5BAAAAAAALAAAAAAQAA8AAAM/OLrcMiHK0NSbso5XCumfB3acaIbhQ6zsCrzAWqIdUJPDaNoFr7YsWIww09EKxZPuB2wSc8po8pgSWK/YrCABADs=); } .imageRte { background-image: url(data:image/gif;base64,R0lGODlhEAAPAKIAAEpNSv///8zMzJmZmWZ3iAAAAAAAAAAAACH5BAAHAP8ALAAAAAAQAA8AAAM6OLrcMEFAGed8goy8Nc9PIy6YYJ7oiY2NsAZwLG+vbNMbZM9uvvO1XwBHEQ57EtYCmWqaANCodApNAAA7); } .imageType { background-image: url(data:image/gif;base64,R0lGODlhEAAQAJEAAJmZmTMzM////wAAACH5BAEHAAIALAAAAAAQABAAAAIilI+py+0PT5gi1BoAlgbka1mcIU4aRY7iNbIrGsXyTNdGAQA7); } .imageUid { background-image: url(data:image/gif;base64,R0lGODlhEAAPAMQAAAAAAN7e3szMzJmZmUpNSvDw8Ds7OzMzMykpKfj4+NfX11lZWeXl5f///6KiomZmZv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHABAALAAAAAAQAA8AAAVh4CCOZEkMgqCsAeMWcJKc6aq0bzyjKusysIKM1rv9gkMewGEIHA4MA8KRTAEGB8EzYHBkd1as9sBlCsCCh2Ex5k7PREVKwFgVVnCeDQfUxX05Qmh7R356gH2CBIuMjY6LIQA7); } .imageWrite { cursor: pointer; float: right; height: 15px; width: 16px; } .imageUploaded { background-color: #B3CCDF; border: 1px #76A5C7 dashed !important; -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; float: left; height: 100%; max-height: 338px !important; max-width: 338px !important; padding: 7px; width: 100%; } .fileUploaded { background-color: #b3ccdf; border: 1px #76a5c7 dashed; -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; display: block; float: left; padding: 5px; text-align: center; width: 342px; } .input { -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; border-style: solid; border-width: 1px; clear: none; float: left; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: 100% !important; padding: 2px; width: 350px; } .inputLarge { -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; border-style: solid; border-width: 1px; clear: none; float: left; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: 100% !important; width: 250px !important; } .inputMedium { -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; border-style: solid; border-width: 1px; clear: none; float: left; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: 100% !important; width: 200px !important; } .inputSmall { -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; border-style: solid; border-width: 1px; clear: none; float: left; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: 100% !important; } .inputSmall { width: 150px; } .linkEdit { text-decoration: underline; } .linkEdit:hover { opacity: 1 !important; } .linkHome { background-image: url(data:image/gif;base64,R0lGODlhEAAQAJEAADMzM////////wAAACH5BAEHAAIALAAAAAAQABAAAAIjlI+pywedgIRGWmgzy1xN/0RLKAqXOVYfiYQn66juyJ3UTRUAOw==); } .linkTop { background-image: url(data:image/gif;base64,R0lGODlhEAAQAJEAADMzM////////wAAACH5BAEHAAIALAAAAAAQABAAAAIflI+pywedgIRGWmgzyxxPKjwPeJFhw32LeI5rCsZyAQA7); } .linkPaging { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; box-shadow: 3px 3px 7px -2px #022421; } .linkPagingOff { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; box-shadow: 3px 3px 7px -2px #022421; } .linkPagingOn { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; box-shadow: 3px 3px 7px -2px #022421; } .norecords { font-size: 150%; font-weight: bold; height: 40px; margin: 0 auto; min-height: 20px; min-width: 736px; padding: 15px 0 0 0; } .pRel { position: relative; } .query { -khtml-border-radius: 9px; -moz-border-radius: 9px; -webkit-border-radius: 9px; border-radius: 9px; border-style: solid; border-width: 1px; margin: 10px auto; padding: 15px; width: auto; } .query { font-size: 90%; text-align: left; } .queryAdvancedCustom textarea { height: 75px; width: 530px; } .queryAdvancedRow .btnAdd { background-position: 5px 1px !important; width: 25px !important; } .queryAdvancedRow .btnDelete { background-position: 5px 1px !important; width: 25px !important; } .queryAdvancedRow td { font-weight: bold; white-space: nowrap; width: 1%; } .queryAdvancedSelect select { width: 536px; } .queryAdvancedWhere input { width: 162px !important; } .queryAdvancedWhere select { height: 22px; width: 170px !important; } .queryAdvancedWhere select.multiple { height: auto !important; } .recordset { display: block; margin: 0; padding: 6px 0; text-align: center; text-decoration: none !important; white-space: nowrap; width: 100%; } .recordset .linkPaging { -khtml-border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; border-style: solid; border-width: 1px; font-weight: bold; margin: 5px 0 0 0; padding: 4px 6px !important; text-decoration: none !important; } .recordset .linkPaging:hover { border-style: solid; border-width: 1px; margin: 0; padding: 4px 6px; } .recordset .linkPagingOff { -khtml-border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; border-style: solid; border-style: solid; border-width: 1px; border-width: 1px; font-weight: bold; margin: 5px 0 0 0; padding: 4px 6px !important; text-decoration: none !important; } .recordset .linkPagingOn { -khtml-border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; border-style: solid; border-style: solid; border-width: 1px; border-width: 1px; font-weight: bold; margin: 0; margin: 5px 0 0 0; padding: 4px 6px; padding: 4px 6px !important; text-decoration: none !important; } .recordset .linkPagingTinyText { font-size: 70%; vertical-align: top; } .recordset .paging { margin: 10px; } .recordset .viewing { font-size: 90%; margin-top: 10px; } .results { -khtml-border-radius: 9px; -moz-border-radius: 9px; -webkit-border-radius: 9px; border-radius: 9px; border-style: solid; border-width: 1px; box-shadow: 3px 3px 7px -2px #022421; font-size: 150%; font-weight: bold; margin: 10px auto; padding: 15px; text-align: center; width: auto; } .select { -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; border-style: solid; border-width: 1px; clear: none; float: left; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: 100% !important; } .selectLarge { width: 355px; } .selectMedium { width: 200px; } .selectSmall { width: 100px; } .selectTiny { width: 50px; } .sqlActs { text-transform: uppercase; } .sqlCons { text-transform: uppercase; } .sqlIndent { margin: 0 0 0 40px; } .sqlMods { text-transform: uppercase; } .sqlTable { font-weight: bold; } .tab { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; box-shadow: 3px 3px 7px -2px #022421; } .table { -khtml-border-radius: 9px; -moz-border-radius: 9px; -webkit-border-radius: 9px; border-radius: 9px; } .table th { white-space: nowrap; } .table tr:first-child td:first-child { -webkit-border-top-left-radius: 9px; border-radius-topleft-width: 9px; border-radius-topleft-width: 9px; border-top-left-radius: 9px; } .table tr:first-child td:last-child { -webkit-border-top-right-radius: 9px; border-radius-topright-width: 9px; border-radius-topright-width: 9px; border-top-right-radius: 9px; } .table tr:first-child th:first-child { -webkit-border-top-left-radius: 9px; border-radius-topleft-width: 9px; border-radius-topleft-width: 9px; border-top-left-radius: 9px; } .table tr:first-child th:last-child { -webkit-border-top-right-radius: 9px; border-radius-topright-width: 9px; border-radius-topright-width: 9px; border-top-right-radius: 9px; } .table tr:last-child td:first-child { -webkit-border-bottom-left-radius: 9px; border-bottom-left-radius: 9px; border-radius-bottomleft-width: 9px; border-radius-bottomleft-width: 9px; } .table tr:last-child td:last-child { -webkit-border-bottom-right-radius: 9px; border-bottom-right-radius: 9px; border-radius-bottomright-width: 9px; border-radius-bottomright-width: 9px; } .table tr:last-child th:first-child { -webkit-border-bottom-left-radius: 9px; border-bottom-left-radius: 9px; border-radius-bottomleft-width: 9px; border-radius-bottomleft-width: 9px; } .table tr:last-child th:last-child { -webkit-border-bottom-right-radius: 9px; border-bottom-right-radius: 9px; border-radius-bottomright-width: 9px; border-radius-bottomright-width: 9px; } .tableDangers td { border-bottom-style: dashed !important; border-bottom-width: 1px !important; border: none !important; padding: 4px 8px; text-align: justify; vertical-align: top !important; } .tableDangers th { border-bottom-style: dashed; border-bottom-width: 1px; padding: 4px 8px; white-space: nowrap !important; width: 50px; } .tableFeatures td { border-bottom-style: dashed !important; border-bottom-width: 1px !important; border: none !important; padding: 4px 8px; text-align: justify; vertical-align: top !important; } .tableFeatures th { border-bottom-style: dashed; border-bottom-width: 1px; padding: 4px 8px; white-space: nowrap !important; } .tableFeatures th { width: 300px; } .tableFiles td { border-bottom-style: dashed !important; border-bottom-width: 1px !important; border: none !important; padding: 4px 8px; text-align: justify; vertical-align: top !important; } .tableInput { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; box-shadow: 3px 3px 7px -2px #022421; } .tableInput { border-collapse: separate; border-spacing: 1px; margin: 0 auto 20px auto !important; margin: 10px auto; width: 540px; } .tableInput .imageWrite { display: none !important; } .tableInput td { padding: 2px 4px; text-align: left; } .tableInput td { min-width: 270px; padding: 1px; text-align: left; vertical-align: top !important; white-space: nowrap !important; } .tableInput th { font-weight: bold; min-width: 270px; padding: 1px 8px; padding: 2px 4px; text-align: left; text-align: left; vertical-align: top !important; white-space: nowrap; white-space: nowrap !important; width: 1%; } .tableOther { margin-bottom: 20px; width: 736px; } .tableOther td { padding-left: 10px; text-align: left; vertical-align: top; } .tableOther td p { margin: 0 !important; padding: 0 !important; } .tableOther th { text-align: left; vertical-align: top; } .tableOther th { white-space: nowrap; width: 1%; } .tableRead { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; border-collapse: separate; border-spacing: 1px; box-shadow: 3px 3px 7px -2px #022421; margin: 10px auto; } .tableRead { -khtml-border-radius: 9px; -moz-border-radius: 9px; -moz-user-select:none; -webkit-border-radius: 9px; border-radius: 9px; margin: 0 0 5px 0 !important; padding: 0 !important; width: 100%; } .tableRead td { padding: 2px 4px; text-align: left; } .tableRead td { padding: 1px 8px; vertical-align: middle; vertical-align: top !important; } .tableRead th { padding: 2px 4px; text-align: left; } .tableRead th { font-weight: bold; overflow: hidden !important; padding: 1px 8px; text-align: center; text-align: center !important; } .tableRead th a { font-weight: bold; text-decoration: none; } .tableWrite { border-collapse: separate; border-spacing: 1px; margin: 10px auto; } .tableWrite { margin: -11px auto 0 auto !important; width: 736px; } .tableWrite .select { width: 355px; } .tableWrite td { padding: 1px; padding: 2px 4px; text-align: left; text-align: left; } .tableWrite th { padding: 1px 8px; padding: 2px 4px; text-align: left; text-align: left; } .tableWrite th { font-weight: bold; min-width: 40%; white-space: nowrap; width: auto; } .tables { margin: 0 auto 20px auto; padding: 0; position: relative; text-align: center; width: 540px; } .tables li { margin: 0; padding: 0; } .tables li { display: none; margin: 0; padding: 0; } .tables li.selected { display: block !important; } .tables table { margin: 0; padding: 0; } .tabs { margin: 20px auto 0 auto; padding: 0 0 0 75px; position: relative; text-align: left; width: 540px; } .tabs li { -webkit-border-top-left-radius: 9px; -webkit-border-top-right-radius: 9px; border-radius-topleft-width: 9px; border-radius-topleft-width: 9px; border-radius-topright-width: 9px; border-radius-topright-width: 9px; border-style: solid; border-top-left-radius: 9px; border-top-right-radius: 9px; border-width: 1px; cursor: pointer; display: inline !important; margin: 0 1px; padding: 2px 10px 3px 10px; } .tabs li.selected { border-style: solid; border-width: 1px; font-weight: bold; } .tabs li:hover { border-style: solid; border-width: 1px; } .textarea { -khtml-border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; border-radius: 3px; border-style: solid; border-width: 1px; clear: none; float: left; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: 100% !important; } .textarea { height: 100px; padding: 2px; width: 350px; } .title { letter-spacing: .1em; margin-bottom: 20px !important; } .whereclause input { clear: both !important; } .whereclause select { clear: both !important; } .whereclause textarea { clear: both !important; } .xpand { clear: both; display: block; margin: 0; padding: 0; } a { opacity: 1; text-decoration: none; } a img { border: none !important; } a:hover { opacity: .5 !important; } blockquote { margin: 0 40px; padding: 0; } blockquote p { font-style: italic; padding: 0; } body { background-position: 0 0; background-repeat: repeat; font-family: "Courier New", Courier, mono, Verdana, Arial, Helvetica, sans-serif; font-size: .8em; height: 101%; line-height: 1.5em; margin: 0; padding: 0 10px; text-align: center; } h1 { font-weight: bold; } h1 { font-size: 260%; margin: 20px auto; } h2 { font-weight: bold; } h2 { font-size: 210%; margin: 15px auto; } h3 { font-weight: bold; } h3 { font-size: 160%; margin: 10px auto; } h4 { font-weight: bold; } h4 { font-size: 110%; margin: 5px auto; } h5 { font-weight: bold; } h5 { font-size: 100%; margin: 5px auto; } h6 { font-size: 90%; font-weight: bold; margin: 2px auto; } input[TYPE=FILE] { width: auto !important; } li { list-style: none; } p { margin: 0; padding: 0; text-align: justify; } textarea { resize: none !important; } html { height: 101%; } .actionFooter { background-color: #CFDFEB; border-color: #76A5C7; } .actionHeader { background-color: #CFDFEB; border-color: #76A5C7; } .btn { background-color: #CFDFEB; border-color: #CFDFEB; } .btnExclaim { background-color: #CFDFEB; border-color: #CFDFEB; } .btnQueryAdvancedAdd { background-color: #CFDFEB; border-color: #76A5C7; } .dpButton { background-color: #ffffff; border-color: #ffffff; color: #000000; } .dpButton:hover { color: #000000; } .dpDayHighlight { background-color: none !important; } .dpDayHighlightTD { background-color: #B3CCDF; border-color: #76A5C7; } .dpDayTD { background-color: #B3CCDF; border-color: #76A5C7; } .dpTD { background-color: #ffffff; border-color: #76A5C7; } .dpTDHover { background-color: #B3CCDF; border-color: #76A5C7; color: #000000; } .dpTable { background-color: #ffffff; border-color: #76A5C7; color: #000000; } .dpTodayButton { background-color: #ffffff; border-color: #ffffff; color: #000000; } .dpTodayButton:hover { color: #000000; } .help h5 { border-bottom-color: #9ab; } .input { border-color: #76A5C7; } .inputLarge { border-color: #76A5C7; } .inputMedium { border-color: #76A5C7; } .inputSmall { border-color: #76A5C7; } .linkEdit { color: #03f; } .query { background-color: #CFDFEB; border-color: #76A5C7; box-shadow: 3px 3px 7px -2px #022421; } .queryAdvancedRow td { background-color: #B3CCDF; } .recordset .linkPaging { background-color: #ffffff; border-color: #76A5C7; color: #000000; } .recordset .linkPaging:hover { background-color: #B3CCDF !important; border-color: #76A5C7; } .recordset .linkPagingOff { background-color: #CFDFEB; background-color: #ffffff; border-color: #76A5C7; border-color: #76A5C7; color: #000000; color: #76A5C7; } .recordset .linkPagingOn { background-color: #B3CCDF !important; background-color: #ffffff; border-color: #76A5C7; border-color: #76A5C7; color: #000000; } .results { background-color: #CFDFEB; border-color: #76A5C7; color: #000000 !important; } .rowEven .btn { background-color: #ffffff; border-color: #ffffff; } .rowEven td { background-color: #ffffff !important; } .rowOdd .btn { background-color: #CFDFEB; border-color: #CFDFEB; } .rowOdd td { background-color: #CFDFEB; } .rowSelected .btn { background-color: #ffd !important; border-color: #ffd !important; } .rowEven .rowSelected { background-color: #ffd !important; } .select { border-color: #76A5C7; } .sqlActs { color:#5E5EFF; } .sqlCons { color:#5E5EFF; } .sqlMods { color:#EF3DDD; } .sqlOps { color:#800000; } .sqlReserved { color:#5E5EFF; } .sqlText { color: #f00; } .tableDangers td { background-color: #ffffff !important; border-bottom-color: #CFDFEB !important; } .tableDangers th { border-bottom-color: #CFDFEB; } .tableFeatures td { background-color: #ffffff !important; border-bottom-color: #CFDFEB !important; } .tableFeatures th { border-bottom-color: #CFDFEB; } .tableFiles td { background-color: #ffffff !important; border-bottom-color: #CFDFEB !important; } .tableInput { background-color: #76A5C7; } .tableInput td { background-color: #CFDFEB; } .tableInput th { background-color: #B3CCDF; background-color: #B3CCDF; } .tableRead { background-color: #76A5C7; } .tableRead { background-color: none !important; } .tableRead td { background-color: #CFDFEB; } .tableRead td.rowSelected { background-color: #ffd; } .tableRead th { background-color: #B3CCDF; } .tableRead th a { color: #000000; } .tableRead tr:hover .btn { background-color: transparent !important; } .tableRead tr:hover td { background-color: #B3CCDF !important; } .tableWrite { background-color: #76A5C7; } .tableWrite td { background-color: #CFDFEB; } .tableWrite th { background-color: #B3CCDF; } .tableRules { background-color: #76A5C7; } .tableRules { background-color: none !important; } .tableRules td { background-color: #CFDFEB; } .tableRules td.rowSelected { background-color: #ffd; } .tableRules th { background-color: #B3CCDF; } .tableRules th a { color: #000000; } .tableRules tr:hover .btn { background-color: transparent !important; } .tableRules tr:hover td { background-color: #B3CCDF; } .tabs li { background-color: #CFDFEB; border-color: #76A5C7; } .tabs li.selected { background-color: #B3CCDF; border-color: #76A5C7; } .tabs li:hover { background-color: #B3CCDF; border-color: #76A5C7; } .textarea { border-color: #76A5C7; } a { color: #000000; } body { background-color: #ffffff; color: #000000; } input.required { background-color: #ff0; } input:focus { background-color: #ffd; } select.required { background-color: #ff0; } select:focus { background-color: #ffd; } textarea.required { background-color: #ff0; } textarea:focus { background-color: #ffd; } th .btn { background-color: transparent !important; } .tableRead, .tableInput, .tab, .linkPaging, .linkPagingOn, .linkPagingOff { -moz-box-shadow: 3px 3px 7px -2px #022421; -webkit-box-shadow: 3px 3px 7px -2px #022421; box-shadow: 3px 3px 7px -2px #022421; /* For IE 8 */ -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; /* For IE 5.5 - 7 */ filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); } .divRead { -moz-box-shadow: 5px 1px 10px -6px #022421; -webkit-box-shadow: 5px 1px 10px -6px #022421; box-shadow: 5px 1px 10px -6px #022421; /* For IE 8 */ -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; /* For IE 5.5 - 7 */ filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); } .divWrite { -moz-box-shadow: 5px 6px 10px -6px #022421; -webkit-box-shadow: 5px 6px 10px -6px #022421; box-shadow: 5px 6px 10px -6px #022421; /* For IE 8 */ -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; /* For IE 5.5 - 7 */ filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); } p.linkVisitUs { margin: 10px auto; text-align: center; } #table_about .tableInput th { min-width: 190px !important; } .divRules { -ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421)"; filter: progid:DXImageTransform.Microsoft.Shadow(Strength=4, Direction=135, Color=#022421); -khtml-border-radius: 9px; -moz-border-radius: 9px; -moz-box-shadow: 5px 5px 10px -6px #022421; -webkit-box-shadow: 5px 5px 10px -6px #022421; box-shadow: 5px 5px 10px -6px #022421; -webkit-border-radius: 9px; border-radius: 9px; margin: 15px auto; overflow: visible; padding: 0 0 1px 0; text-align: center; width: 769px; } .divRules .actionHeader { margin: -1px auto; width: 738px !important; } .divRules .actionFooter { background-color: #B3CCDF; margin: -1px auto; width: 738px !important; } .divRules .actionFooter .btn { background-color: #B3CCDF; } .pRules p { margin: 20px auto; padding: 0; width: 738px; } .tableRules { border-collapse: separate; border-spacing: 1px; margin: 0 auto; padding: 0 !important; } .tableRules td { padding: 2px 4px; text-align: left; } .tableRules td { padding: 1px 8px; vertical-align: middle; vertical-align: top !important; } .tableRules th { padding: 2px 4px; text-align: left; } .tableRules th { font-weight: bold; overflow: hidden !important; padding: 0; text-align: center; text-align: center !important; } .tableRules th a { font-weight: bold; text-decoration: none; } .tableRules td.cellMin div { min-width: 0 !important; } .tableRules td.cellMax { cursor: pointer; overflow: visible !important; padding: 0 !important; position: relative; } .tableRules td.cellMax .divMax { overflow: visible !important; padding: 0 !important; position: relative; } .tableRules tr:hover td { background-color: #b3ccdf !important; } .textRule { -khtml-border-radius: 0 !important; -moz-border-radius: 0 !important; -webkit-border-radius: 0 !important; border-radius: 0 !important; height: 21px; margin: -1px 0 0 -1px; overflow: hidden; padding: 2px; position: absolute; width: 248px !important; } .inputRule { -khtml-border-radius: 0 !important; -moz-border-radius: 0 !important; -webkit-border-radius: 0 !important; border-radius: 0 !important; background-color: #ffa; display: none; height: 18px; margin: -1px 0 0 -1px; position: absolute; width: 246px !important; } .textRule.textRuleSelected, .inputRule.inputRuleSelected { display: block; } .posAbs { position: absolute !important; } .w250 { width: 250px !important; } .cellMaxName div { width: 248px; } .cellMaxType div { width: 19px; } .cellMaxExtra div { width: 200px; } </style> '; echo '</head>'; echo '<body id="body">'; echo '<div id="content">'; echo '<h3 class="title"><a href="'.$arrAbout['link'].'">::: '.$arrAbout['title'].' :::</a></h3>'; $conn = $os->setConn($o); switch ($qpid) { case 'help': echo $os->getHelpOutput(); break; default: echo '<form id="formScaffold" name="formScaffold" method="post" action="" enctype="multipart/form-data" accept-charset="utf-8">'; echo '<input type="hidden" id="act" name="act" value="" />'; if ($conn) { $status = ($qupd) ? $os->_status() : FALSE; $admin = $os->getAccess(); echo ($status) ? '<div class="results"><div class="resultsContent">'.$status.'</div></div>' : ''; $cntRecords = $os->scaffold($qact,$qid,$post); $qwhere = $os->where; } if (!preg_match('/(copy|edit|insertplus)/i',$qact)) { if ($cntRecords > 0) { $tpg = ceil($cntRecords/$qpp); $srow = $qsrow; $erow = ($qpp * $qpg); $setInc = 5; if ($tpg > 1) { echo '<div id="loadRecordSetScaffold" class="recordset">'; echo '<div class="paging">'; if ($tpg <= $setInc) { $eor = $cntRecords; $bor = 1; } else { $eor = ceil($qpg/$setInc)*$setInc; $bor = $eor-($setInc-1); } if ($eor > $tpg) { $eor = $tpg; } if ($bor > 1) { echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_first" class="linkPaging pageFirst" onClick="getScaffoldRS(1,this)" title="First page"><span class="linkPagingTinyText">|</span>&lsaquo;</a> '; echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_prev_inc" class="linkPaging" onClick="getScaffoldRS('.($bor-1).',this)" title="Prev '.$setInc.' pages">&laquo;</a> '; } else { echo '<span class="linkPagingOff pageFirstOff"><span class="linkPagingTinyText">|</span>&lsaquo;</span> '; echo '<span class="linkPagingOff">&laquo;</span> '; } if ($qpg > 1) { echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_prev" class="linkPaging" onClick="getScaffoldRS('.($qpg-1).',this)" title="Prev page">&lsaquo;</a> '; } else { echo '<span class="linkPagingOff">&lsaquo;</span> '; } for ($cntRows=$bor; $cntRows <= $eor; $cntRows++) { if ($cntRows != $qpg) { echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_'.$cntRows.'" class="linkPaging" onClick="getScaffoldRS('.$cntRows.',this)">'.$cntRows.'</a> '; } else { echo '<span class="linkPagingOn">'.$cntRows.'</span> '; } } if ($qpg < $tpg) { echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_next" class="linkPaging" onClick="getScaffoldRS('.($qpg+1).',this)" title="Next page">&rsaquo;</a> '; } else { echo '<span class="linkPagingOff">&rsaquo;</span> '; } if ($eor < $tpg) { echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_next_inc" class="linkPaging" onClick="getScaffoldRS('.($eor+1).',this)" title="Next '.$setInc.' pages">&raquo;</a> '; echo '<a href="javascript:void(0)" id="'.$qpid.'_paging_last" class="linkPaging pageLast" onClick="getScaffoldRS('.($tpg).',this)" title="Last page">&rsaquo;<span class="linkPagingTinyText">|</span></a> '; } else { echo '<span class="linkPagingOff">&raquo;</span> '; echo '<span class="linkPagingOff pageLastOff">&rsaquo;<span class="linkPagingTinyText">|</span></span> '; } echo '</div>'; echo '<div id="loadPagingScaffold" class="viewing">'; if ($erow > $cntRecords) { $erow = $cntRecords; } echo 'Viewing '.$srow.'-'.$erow.' of '.number_format($cntRecords).' '; if (isset($qfiltered) && $qfiltered == true) { echo 'Explored '; } echo 'Results'; echo '</div>'; echo '</div>'; } } echo '<input type="hidden" id="srowScaffold" name="srow" class="srow hidden" value="'.$qsrow.'" />'; echo '<input type="hidden" id="erowScaffold" name="erow" class="erow hidden" value="'.$qerow.'" />'; echo '<input type="hidden" id="pgScaffold" name="pg" class="pg hidden" value="'.$qpg.'" />'; echo '<input type="hidden" id="ordScaffold" name="ord" class="ord hidden" value="'.$qord.'" />'; echo '<input type="hidden" id="srtScaffold" name="srt" class="srt hidden" value="'.$qsrt.'" />'; echo '<input type="hidden" id="tabScaffold" name="tab" class="hidden" value="'.$qtab.'" />'; echo '<input type="hidden" id="whereScaffold" name="where" class="hidden" value="'.$qwhere.'" />'; $connected = ($conn && $qdb && $qtbl); $files = (isset($os->arrFileFlds) && count($os->arrFileFlds)); $strNoTbl = '<tr><th><h4 align="center">No Database Table Selected</h4></th></tr>'; $strNoDb = '<tr><th><h4 align="center">No Database Selected</h4></th></tr>'; $strNoConn = '<tr><th><h4 align="center">No Database Connection Found</h4></th></tr>'; $strNoConnection = ($conn) ? (($qdb) ? $strNoTbl : $strNoDb) : $strNoConn; $strActions = '<tr class="actionRow"><td colspan="[[[__COLSPAN__]]]"><div>'; $strReqAst = '&nbsp;*&nbsp;&nbsp;'; $strReqTitle = ' title="Required field"'; $btnLabelAct = ($conn) ? 'Update' : 'Connect'; $btnType = ($conn) ? 'button' : 'submit'; $strActions .= '<button type="'.$btnType.'" id="btn_scaffold" name="btn_scaffold" value="scaffold" class="btn" onClick="setScaffold(this)">'.$btnLabelAct.'&nbsp;</button>'; if ($os->getTemp()) { $strActions .= '<button type="button" id="btn_purge" name="btn_purge" value="purge" class="btn" onClick="setScaffold(this)">Purge&nbsp;</button>'; } $strActions .= ($connected && $cntRecords) ? '<button type="button" id="btn_export" name="btn_export" value="export" class="btn" onClick="setScaffold(this)">Export&nbsp;</button>' : ''; $strActions .= '<button type="button" id="btn_rulesedit" name="btn_rulesedit" value="rulesedit" class="btn" onClick="setScaffold(this)">Rules&nbsp;</button>'; $strActions .= '<button type="button" id="btn_reset" name="btn_reset" value="reset" class="btn" onClick="setScaffold(this)">Reset&nbsp;</button>'; $strActions .= '<button type="button" id="btn_help" name="btn_help" value="help" class="btn" onClick="setScaffold(this)">Help&nbsp;</button>'; $strActions .= '</div></td></tr>'; echo '<ul id="tabs" class="tabs">'; $strTabs = 'connect,advanced,options'; $strTabs .= ($files) ? ',files' : ''; $strTabs .= ',about'; $arrTabs = explode(',',$strTabs); foreach ($arrTabs as $tabKey => $tabVal) { $classTableSelected = 'classTableSelected'.ucfirst($tabVal); $$classTableSelected = ($tabVal == $qtab) ? 'selected' : ''; $classTabSelected = ($tabVal == $qtab) ? 'selected' : ''; echo '<li id="tab_'.$tabVal.'" class="tab '.$classTabSelected.'" onClick="getTab(this)">'.ucfirst($tabVal).'</li>'; } echo '</ul>'; echo '<ul id="tables" class="tables">'; echo '<li id="table_connect" class="tabTable '.$classTableSelectedConnect.'">'; $strColSpan = 2; echo '<table class="table tableInput"><tbody>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'srv">Database Server:</a></th>'; echo '<td'.$strReqTitle.'>'; if (isset($qsrv_constant)) { echo '&nbsp;'.$qsrv_constant; } else { echo '<input type="text" name="srv" value="'.$qsrv.'" class="inputSmall" tabindex="100" />'.$strReqAst.' '; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'usr">Database Username:</a></th>'; echo '<td'.$strReqTitle.'>'; if (isset($qusr_constant)) { echo '&nbsp;'.$qusr_constant; } else { echo '<input type="text" name="usr" value="'.$qusr.'" class="inputSmall" tabindex="101" />'.$strReqAst.' '; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'pwd">Database Password:</a></th>'; echo '<td'.$strReqTitle.'>'; if (isset($qpwd_constant)) { echo '&nbsp;***************'; } else { echo '<input type="password" name="pwd" value="'.$qpwd.'" class="inputSmall" tabindex="102" />'.$strReqAst.' '; } echo '</td>'; echo '</tr>'; if ($conn) { echo '<tr>'; echo '<th>'.$os->linkHelp.'ajl">Database Lookup Flag:</a></th>'; echo '<td'.$strReqTitle.'>'; if (isset($qluf_constant)) { echo '&nbsp;'.$qluf_constant; } else { echo '<input type="text" name="luf" value="'.$qluf.'" class="inputSmall" tabindex="103" />'.$strReqAst.' '; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'db">Database Name:</a></th>'; echo '<td'.$strReqTitle.'>'; if (isset($qdb_constant)) { echo '&nbsp;'.$qdb_constant; } else { $dbOptions = $os->getFormFieldOptions('db'); echo $os->getFormField($dbOptions).$strReqAst; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'tbl">Database Table:</a></th>'; echo '<td'.$strReqTitle.'>'; if (isset($qtbl_constant)) { echo '&nbsp;'.$qtbl_constant; } else { $tblOptions = $os->getFormFieldOptions('tbl'); echo $os->getFormField($tblOptions).$strReqAst; } echo '</td>'; echo '</tr>'; } echo preg_replace('/\[\[\[__COLSPAN__\]\]\]/', $strColSpan, $strActions); echo '</tbody></table>'; echo '</li>'; echo '<li id="table_advanced" class="tabTable '.$classTableSelectedAdvanced.'">'; $strColSpan = 1; echo '<table class="table tableInput"><tbody>'; if ($connected) { echo '<tr>'; echo '<th>'.$os->linkHelp.'flds">SQL Field Select:</a></th>'; echo '</tr>'; echo '<tr>'; echo '<td>'; echo '<span id="query_flds" class="queryAdvanced queryAdvancedSelect">'; $fldsOptions = $os->getFormFieldOptions('flds'); echo $os->getFormField($fldsOptions); $fldsOptionsJS = $os->getFormFieldOptions('flds',0); $os->getFormFieldsWhere($fldsOptionsJS); echo '</span>'; echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'where">SQL Where Clause:</a></th>'; echo '</tr>'; function setWhereVal($matches) { return $matches[0].' selected="selected"'; } function getQueryAdvanced($k,$os) { global $qwfld; global $qwop; global $qwval; echo '<tr id="query_row_'.$k.'" class="queryAdvancedRow">'; echo '<td>'; echo '<span id="query_wfld_'.$k.'" class="queryAdvanced queryAdvancedWhere">'; $wfldOptions = $os->getFormFieldOptions('wfld',$k); echo $os->getFormField($wfldOptions); echo '</span>'; echo '<span id="query_wop_'.$k.'" class="queryAdvanced queryAdvancedWhere">'; $arrWops['='] = ' Is Equal To '; $arrWops['<>'] = ' Is Not Equal To '; $arrWops['>'] = ' Is Greater Than '; $arrWops['<'] = ' Is Less Than '; $arrWops['LIKE'] = ' Contains '; $arrWops['NOT LIKE'] = ' Does Not Contain '; $arrWops['IS NULL'] = ' Is Null '; $arrWops['IS NOT NULL'] = ' Is Not Null '; $wopOptions = array('i'=>'wop_wop_wop_'.$k,'n'=>'wop['.$k.']','v'=>(($qwfld[$k] == '') ? '' : $qwop[$k]),'b'=>TRUE,'chg'=>'setScaffold(this)','a'=>$arrWops); echo $os->getFormField($wopOptions); echo '</span>'; echo '<span id="query_wval_'.$k.'" class="queryAdvanced queryAdvancedWhere">'; $nulled = (preg_match('/NULL$/',$qwop[$k])) ? ' read-only="read-only" onfocus="this.blur()" style="visibility:hidden" ' : ''; $value = ($nulled) ? '' : $qwval[$k]; if (isset($os->arrWhereWvals[$qwfld[$k]]) && $os->arrWhereWvals[$qwfld[$k]]) { $strWhereWvals = $os->arrWhereWvals[$qwfld[$k]]; $strWhereWvals = preg_replace('/_0/','_'.$k,$strWhereWvals); $strWhereWvals = preg_replace('/wval\[0\]/i','wval['.$k.']',$strWhereWvals); if (preg_match('/multiple="multiple"/i',$strWhereWvals) && is_array($qwval[$k])) { $strWhereWvals = preg_replace('/selected="selected"/i','',$strWhereWvals); foreach ($qwval[$k] as $wvalKey => $wvalVal) { $strWhereWvals = preg_replace_callback('/value="'.$wvalVal.'"/i','setWhereVal',$strWhereWvals); } } else if (preg_match('/<select/',$strWhereWvals)) { $strWhereWvals = preg_replace('/selected="selected"/i','',$strWhereWvals); $strWhereWvals = preg_replace_callback('/value="'.$qwval[$k].'"/i','setWhereVal',$strWhereWvals); } else { $strWhereWvals = preg_replace('/value=\".*?\"/i','value="'.$qwval[$k].'"',$strWhereWvals); } $strWhereWvals = preg_replace('/<select /i','<select '.$nulled,$strWhereWvals); echo $strWhereWvals; } else { echo '<input type="text" id="wval_'.$k.'" name="wval['.$k.']" class="input wval" value="'.$value.'" '.$nulled.' />'; } echo '</span>'; $btnAction = ($k) ? 'del' : 'add'; $btnTitle = ($k) ? 'Delete' : 'Add'; $btnName = 'btn_'.$btnAction.'query_'.$k; echo '<button type="button" id="'.$btnName.'" name="'.$btnName.'" value="" class="btn btn'.$btnTitle.'" onClick="setScaffold(this)" title="'.$btnTitle.' query condition"></button>'; echo '</td>'; echo '</tr>'; } if (isset($qwfld)) { $qwfldCnt = 0; foreach ($qwfld as $qKey => $qVal) { if ($qfldCnt == 0 || ($qfldCnt > 0 && trim($qVal) != '')) { getQueryAdvanced($qKey,$os); $qfldCnt++; } } } echo preg_replace('/\[\[\[__COLSPAN__\]\]\]/', $strColSpan, $strActions); } else { echo $strNoConnection; } echo '</tbody></table>'; echo '</li>'; echo '<li id="table_options" class="tabTable '.$classTableSelectedOptions.'">'; $strColSpan = 2; echo '<table class="table tableInput"><tbody>'; if ($connected) { echo '<tr>'; echo '<th>'.$os->linkHelp.'pp">Display Per Page:</a></th>'; echo '<td>'; if (isset($qpp_constant)) { echo '&nbsp;'.$qpp; } else { $ppCountInc = 10; $ppCountMin = 10; $ppCountMax = 100; for ($ppCount = $ppCountMin; $ppCount <= $ppCountMax; $ppCount+=$ppCountInc) { $arrPps[$ppCount] = $ppCount; } $ppOptions = array('i'=>'select_option_pp','n'=>'pp','v'=>$qpp,'chg'=>'setScaffold(this)','a'=>$arrPps); echo $os->getFormField($ppOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'upd">Display Update Status:</a></th>'; echo '<td>'; if (isset($qupd_constant)) { echo '&nbsp;'.(($qupd) ? 'Yes' : 'No'); } else { $updOptions = array('t'=>'bool','n'=>'upd','v'=>$qupd); echo $os->getFormField($updOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'dq">Display SQL Queries:</a></th>'; echo '<td>'; if (isset($qdq_constant)) { echo '&nbsp;'.(($qdq) ? 'Yes' : 'No'); } else { $dqOptions = array('t'=>'bool','n'=>'dq','v'=>$qdq); echo $os->getFormField($dqOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'mdd">Display Minimized Data:</a></th>'; echo '<td>'; if (isset($qmdd_constant)) { echo '&nbsp;'.(($qmdd) ? 'Yes' : 'No'); } else { $mddOptions = array('t'=>'bool','n'=>'mdd','v'=>$qmdd); echo $os->getFormField($mddOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'pas">Display Records After POST:</a></th>'; echo '<td>'; if (isset($qpas_constant)) { echo '&nbsp;'.(($qpas) ? 'Yes' : 'No'); } else { $pasOptions = array('t'=>'bool','n'=>'pas','v'=>$qpas); echo $os->getFormField($pasOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'bin">Enable Bulk Insert:</a></th>'; echo '<td>'; if (isset($qbin_constant)) { echo '&nbsp;'.(($qbin) ? 'Yes' : 'No'); } else { $binOptions = array('t'=>'bool','n'=>'bin','v'=>$qbin); echo $os->getFormField($binOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'htm">Enable HTML Tag Support:</a></th>'; echo '<td>'; if (isset($qhtm_constant)) { echo '&nbsp;'.(($qhtm) ? 'Yes' : 'No'); } else { $htmOptions = array('t'=>'bool','n'=>'htm','v'=>$qhtm); echo $os->getFormField($htmOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'ssh">Enable Syntax Highlighting:</a></th>'; echo '<td>'; if (isset($qssh_constant)) { echo '&nbsp;'.(($qssh) ? 'Yes' : 'No'); } else { $sshOptions = array('t'=>'bool','n'=>'ssh','v'=>$qssh); echo $os->getFormField($sshOptions); } echo '</td>'; echo '</tr>'; $arrAjs = array('ajl'=>'Lookup','aje'=>'Enum','ajs'=>'Set','ajc'=>'CSV','ajb'=>'Boolean'); foreach ($arrAjs as $ajKey => $ajVal) { $ajv = 'q'.$ajKey; echo '<tr>'; echo '<th>'.$os->linkHelp.$ajKey.'">Auto-Join '.$ajVal.' Fields:</a></th>'; echo '<td>'; if (isset($qajl_constant)) { echo '&nbsp;'.(($qajl) ? 'Yes' : 'No'); } else { $ajOptions = array('t'=>'bool','n'=>$ajKey,'v'=>$$ajv); echo $os->getFormField($ajOptions); } echo '</td>'; echo '</tr>'; } echo preg_replace('/\[\[\[__COLSPAN__\]\]\]/', $strColSpan, $strActions); } else { echo $strNoConnection; } echo '</tbody></table>'; echo '</li>'; if ($files) { echo '<li id="table_files" class="tabTable '.$classTableSelectedFiles.'">'; $strColSpan = 2; echo '<table class="table tableInput"><tbody>'; if ($connected) { echo '<tr>'; echo '<th>'.$os->linkHelp.'fdst">File Upload Directory:</a></th>'; echo '<td>'; if (isset($qfdst_constant)) { echo '&nbsp;'.$qfdst_constant; } else { echo '<input type="text" name="fdst" value="'.$qfdst.'" class="inputSmall" tabindex="103" />'; } echo '</td>'; echo '</tr>'; echo '<th>'.$os->linkHelp.'fall">File Types Allowed:</a></th>'; echo '<td>'; if (isset($qfall_constant)) { echo '&nbsp;'.$qfall_constant; } else { echo '<input type="text" name="fall" value="'.$qfall.'" class="inputSmall" tabindex="103" />'; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'fsiz">File Limit Size:</a></th>'; echo '<td>'; if (isset($qfsiz_constant)) { echo '&nbsp;'.$qfsiz_constant; } else { echo '<input type="text" name="fsiz" value="'.$qfsiz.'" class="inputSmall" tabindex="103" />'; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'flen">File Limit Length:</a></th>'; echo '<td>'; if (isset($qflen_constant)) { echo '&nbsp;'.$qflen_constant; } else { echo '<input type="text" name="flen" value="'.$qflen.'" class="inputSmall" tabindex="103" />'; } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'funq">File Names Unique:</a></th>'; echo '<td>'; if (isset($qfunq_constant)) { echo '&nbsp;'.(($qfunq) ? 'Yes' : 'No'); } else { $funqOptions = array('t'=>'bool','n'=>'funq','v'=>$qfunq); echo $os->getFormField($funqOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'ffor">File Block Dangerous Types:</a></th>'; echo '<td>'; if (isset($qffor_constant)) { echo '&nbsp;'.(($qffor) ? 'Yes' : 'No'); } else { $fforOptions = array('t'=>'bool','n'=>'ffor','v'=>$qffor); echo $os->getFormField($fforOptions); } echo '</td>'; echo '</tr>'; echo '<tr>'; echo '<th>'.$os->linkHelp.'thmbs">File Thumbnail Images:</a></th>'; echo '<td>'; if (isset($qthmbs_constant)) { $arrThmbs = array_filter(explode(',',$qthmbs_constant)); } $thmbsOptions = array('n'=>'thmbs','v'=>$qthmbs,'s'=>4,'b'=>TRUE,'m'=>TRUE,'a'=>$arrThmbs); echo $os->getFormField($thmbsOptions); echo '</td>'; echo '</tr>'; echo preg_replace('/\[\[\[__COLSPAN__\]\]\]/', $strColSpan, $strActions); } else { echo $strNoConnection; } echo '</tbody></table>'; echo '</li>'; } echo '<li id="table_about" class="tabTable '.$classTableSelectedAbout.'">'; $strColSpan = 2; echo '<table class="table tableInput"><tbody>'; if (isset($arrAbout)) { echo '<tr><th>Software Title:</th><td>&nbsp;'.$arrAbout['title'].'&nbsp;</td></tr>'; echo '<tr><th>Software Version:</th><td>&nbsp;'.$arrAbout['version'].'&nbsp;</td></tr>'; echo '<tr><th>Software Released:</th><td>&nbsp;'.$arrAbout['date'].'&nbsp;</td></tr>'; echo '<tr><th>Software Author:</th><td>&nbsp;'.$arrAbout['author'].'&nbsp;</td></tr>'; echo '<tr><th>Software Company:</th><td>&nbsp;<a href="'.$arrAbout['linkcompany'].'" target="_blank">'.$arrAbout['linkcompany'].'</a>&nbsp;</td></tr>'; echo '<tr><th>Software Download:</th><td>&nbsp;<a href="'.$arrAbout['linkdownload'].'" target="_blank">'.$arrAbout['linkdownload'].'</a>&nbsp;</td></tr>'; echo '<tr><th>Software Support:</th><td>&nbsp;<a href="'.$arrAbout['linksupport'].'" target="_blank">'.$arrAbout['linksupport'].'</a>&nbsp;</td></tr>'; echo '<tr><th>Software Feedback:</th><td>&nbsp;<a href="'.$arrAbout['linkfeedback'].'" target="_blank">'.$arrAbout['linkfeedback'].'</a>&nbsp;</td></tr>'; } else { echo $strNoConnection; } echo '</tbody></table>'; echo '</li>'; echo '</ul>'; } echo '</form>'; echo '<p class="linkVisitUs">Visit us @ <a href="'.$arrAbout['link'].'">'.$arrAbout['link'].'</a></p>'; break; } echo '</div>'; if ($os && isset($os->arrWhereWops) && is_array($os->arrWhereWops)) { echo '<script type="text/javascript"> '; $cr = "\n"; $ptnReplace = '/(^\/|\/i$)/'; echo 'var matchNumeric = "'.preg_replace($ptnReplace,'',$os->matchNumeric).'"; '.$cr; echo 'var matchDecimal = "'.preg_replace($ptnReplace,'',$os->matchDecimal).'"; '.$cr; echo 'var matchDateTime = "'.preg_replace($ptnReplace,'',$os->matchDateTime).'"; '.$cr; echo 'var matchBoolean = "'.preg_replace($ptnReplace,'',$os->matchBoolean).'"; '.$cr; echo 'var matchString = "'.preg_replace($ptnReplace,'',$os->matchString).'"; '.$cr; echo 'var matchText = "'.preg_replace($ptnReplace,'',$os->matchText).'"; '.$cr; echo 'var matchEnum = "'.preg_replace($ptnReplace,'',$os->matchEnum).'"; '.$cr; echo 'var arrWhereWops = [];'.$cr; echo 'var arrWhereWvals = [];'.$cr; $strWhereOps = $strWhereVals = ''; foreach($os->arrWhereWops as $k => $v) { $strWhereOps .= 'arrWhereWops["'.$k.'"] = ['.implode(',',$v).']; '.$cr; $strWhereVals .= 'arrWhereWvals["'.$k.'"] = "'.addslashes($os->arrWhereWvals[$k]).'"; '.$cr; } echo $strWhereOps.$cr; echo $strWhereVals.$cr; echo '</script>'.$cr; } echo '<script type="text/javascript"> var arrTimeouts = []; var arrIntervals = []; var aj = { ver: "1.0.9", $: function(v) { return (typeof(v) == "string") ? (document.getElementById(v)) ? document.getElementById(v) : false : v; }, $C: function() { var arrElms = []; var v = arguments[0]; var a = document.getElementsByTagName("*"); var aLen = a.length; for (var i=0; i < aLen; i++) { if (a[i].className.indexOf(" ") >= 0) { var b = a[i].className.split(" "); var bLen = b.length; for (var j=0; j < bLen; j++) { if (b[j] == v) { arrElms.push(a[i]); } } } else if (a[i].className == v) { arrElms.push(a[i]); } } return arrElms; }, act: function(opt,cnt) { if (opt.getmsg && cnt == 1 && (aj.$(opt.setmsg) || aj.$(opt.seturl))) { var setmsg = (aj.$(opt.setmsg)) ? aj.$(opt.setmsg) : aj.$(opt.seturl); if (opt.resize === false) { aj.set(opt.getmsg,setmsg,1); } else { aj.set(opt.getmsg,setmsg); } } }, ca: function(o,c) { o = aj.$(o); if (o && typeof(c) == "string" && o.className) { if (o.className.match(c) === null) { o.className += " " + c; } } }, clear: function() { aj = null; }, cr: function(o,c) { o = aj.$(o); if (o && typeof(c) == "string" && o.className) { o.className = o.className.replace(c,""); } }, create: function() { var httprequest = false; if (window.XMLHttpRequest) { httprequest = new XMLHttpRequest(); if (httprequest.overrideMimeType) { httprequest.overrideMimeType("text/xml"); } } else if (window.ActiveXObject) { try { httprequest = new ActiveXObject("Msxml2.XMLHTTP"); } catch(e) { try { httprequest = new ActiveXObject("Microsoft.XMLHTTP"); } catch(e) {} } } return httprequest; }, fail: function(geturl,opt,req) { var err = req.status + ": " + req.statusText; var o = aj.$(opt.seturl); if (o) { switch (req.status) { case 12029: case 12030: case 12031: case 12152: case 12159: req.abort(); aj.fetch(geturl,aj.serial(opt)); break; default: var s = "<br /><br /><h5 align=\"center\">The following error occurred:</h5><h4 align=\"center\">" + err + "</h4>"; req.abort(); if (aj.isfunc(opt.onabort)) { opt.onabort(); } break; } } else { } }, fetch: function(geturl,options) { var self = this; var timeout,sent; self.options = { async: true, blind: null, bclass: "", getmsg: null, dump: false, method: "p", onabort: null, onactive: this.act, oncomplete: null, onempty: null, onfailure: this.fail, onload: null, onopen: null, onsend: null, onsuccess: null, onsuccessargs: null, params: "", queue: true, resize: true, setmsg: null, seturl: null, unique: true }; var optionslist = ""; for (var arg in options) { self.options[arg] = options[arg]; optionslist += arg + " : " + self.options[arg] + "\n\n"; } var opt = self.options; var queued = (opt.queue) ? aj.inArray(aj.queue, geturl) : false; if (queued === false || opt.unique === false || opt.async === false) { if (opt.async && opt.queue) { aj.queue[aj.queue.length] = geturl; } var req = aj.create(); if (aj.queue.length === 0 && aj.isfunc(opt.onempty)) { opt.onempty(); } else if (aj.queue.length > 0 && aj.isfunc(opt.onactive)) { opt.onactive(opt); } if (req && geturl) { var statecount = 0; var o = aj.$(opt.seturl); req.onreadystatechange = function() { if (req.readyState == 4) { if (req.status == 200 || window.location.href.indexOf("http") == -1) { timeout = setTimeout(function() { if (o && opt.dump) { aj.set(req.responseText,o,opt); sent = true; } if (aj.isfunc(opt.onsuccess)) { opt.onsuccess(req.responseText,o,opt); sent = true; } }, 300); } else { if (aj.isfunc(opt.onfailure)) { opt.onfailure(geturl,opt,req); } } if (aj.isfunc(opt.oncomplete)) { opt.oncomplete(opt); } var queuepos = aj.inArray(aj.queue, geturl); if (queuepos !== false) { aj.queue.splice(queuepos,1); } } else { statecount++; if (aj.isfunc(opt.onactive)) { opt.onactive(opt,statecount); } } }; if (opt.method == "g") { req.open("GET", geturl + "?cachebuster=" + new Date().getTime() + "&" + opt.params.toString(), opt.async); if (aj.isfunc(opt.onopen)) { opt.onopen(); } req.send(null); if (aj.isfunc(opt.onsend)) { opt.onsend(); } } else { req.open("POST", geturl, opt.async); if (aj.isfunc(opt.onopen)) { opt.onopen(); } opt.params = opt.params.toString().replace(/^[^a-z0-9]/i,""); req.setRequestHeader("Content-type", "application/x-www-form-urlencoded"); req.setRequestHeader("Content-length", opt.params.length); req.setRequestHeader("Connection", "close"); req.send(opt.params); if (aj.isfunc(opt.onsend)) { opt.onsend(); } if (opt.async === false) { return req.responseText; } } } } }, inArray: function(array,value,casei) { var i; for (i=0; i < array.length; i++) { if (casei) { if (array[i].toLowerCase() == value.toLowerCase()) { return i; } } else { if (array[i] == value) { return i; } } } return false; }, isfunc: function(f) { return typeof(f) == "function" ? true : false; }, load: function(geturl,options) { options = options || {}; options.dump = true; aj.fetch(geturl,options); }, queue: typeof(this.queue) == "undefined" ? [] : aj.queue, serial: function(opt) { var args = ""; if (opt) { for (var arg in opt) { args += arg + " : " + opt[arg] + ","; } } args = args.replace(/,$/,""); return args; }, set: function(s,o,opt) { if (s) { return s; } }, visHide: function (o) { if (o) { o.style.visibility = "hidden"; } }, visShow: function (o) { if (o) { o.style.visibility = "visible"; } } }; addDOMLoadEvent = (function(){ var load_events = [], load_timer, script, done, exec, old_onload, init = function () { done = true; clearInterval(load_timer); while (exec = load_events.shift()) exec(); if (script) script.onreadystatechange = ""; }; return function (func) { if (done) return func(); if (!load_events[0]) { if (document.addEventListener) document.addEventListener("DOMContentLoaded", init, false); /*@cc_on @*/ /*@if (@_win32) document.write("<script id=__ie_onload defer src=//0><\/scr"+"ipt>"); script = document.getElementById("__ie_onload"); script.onreadystatechange = function() { if (this.readyState == "complete") init(); }; /*@end @*/ if (/WebKit/i.test(navigator.userAgent)) { load_timer = setInterval(function() { if (/loaded|complete/.test(document.readyState)) init(); }, 10); } old_onload = window.onload; window.onload = function() { init(); if (old_onload) old_onload(); }; } load_events.push(func); } })(); function tableRowResize() { var cells, row, newheight; var tbl = document.getElementById("tableRead"); if (tbl) { var top = tbl.offsetTop; var tds = tbl.getElementsByTagName("td"); var tdsLen = tds.length; var resize = false; for (var t=0; t < tdsLen; t++) { tds[t].onmousemove = function(e) { if (!e) { var e = window.event; } var x = (e.clientY - top) + document.documentElement.scrollTop; if (resize) { var height = x - row.offsetTop; row.style.height = height + "px"; cells = row.parentNode.childNodes; cellsLen = cells.length; for (var c=0; c < cellsLen; c++) { if (cells[c].firstChild.style) { cells[c].firstChild.style.height = height + "px"; } } newheight = height; } else { var cursor = ((x - this.offsetTop > this.offsetHeight - 20) && this.nodeName == "TD") ? "row-resize" : ""; tbl.style.cursor = cursor; } }; tds[t].onmousedown = function(e) { if (tbl.style.cursor == "row-resize") { var targ; if (!e) { var e = window.event; } if (e.target) { targ = e.target; } else if (e.srcElement) { targ = e.srcElement; } if (targ.nodeType == 3) { targ = targ.parentNode; } row = targ; resize = (row.nodeName == "TD"); document.onselectstart = new Function ("return false"); } return false; }; } tbl.onmouseup = function(e) { document.onselectstart = new Function ("return true"); row = null; resize = false; tbl.style.cursor = ""; }; } } function ie_getElementsByTagName(str) { if (str == "*") { return document.all; } else { return document.all.tags(str); } } if (document.all) { document.getElementsByTagName = ie_getElementsByTagName; } document.getElementsByClassName = function(theClass) { var arrElms = []; var elms = document.getElementsByTagName("*"); for (var i=0; i < elms.length; i++) { if (elms[i].className.indexOf(" ") >= 0) { var theClasses = elms[i].className.split(" "); for (var j=0; j < theClasses.length; j++) { if (theClasses[j] == theClass) { arrElms.push(elms[i]); } } } else if (elms[i].className == theClass) { arrElms.push(elms[i]); } } return arrElms; }; if(!Array.indexOf){ Array.prototype.indexOf = function(obj){ for(var i=0; i<this.length; i++){ if(this[i]==obj){ return i; } } return -1; } } function $C() { var arrElms = []; var v = arguments[0]; var a = document.getElementsByTagName("*"); for (var i=0; i < a.length; i++) { if (a[i].className.indexOf(" ") >= 0) { var b = a[i].className.split(" "); for (var j=0; j < b.length; j++) { if (b[j] == v) { arrElms.push(a[i]); } } } else if (a[i].className == v) { arrElms.push(a[i]); } } return arrElms; } function getBinCheck(o) { var o = $$(o); if (o) { var arrElms = []; var arrElmsLen = 0; var bin = (o.options[o.selectedIndex].value == "") ? false : true; arrElms = document.getElementsByClassName("file"); arrElmsLen = arrElms.length; for (var i=0; i < arrElmsLen; i++) { getBinToggle(arrElms[i],true); } var title = " this field for Bulk Inserts"; arrElms = document.getElementsByClassName("binToggle"); arrElmsLen = arrElms.length; for (var i=0; i < arrElmsLen; i++) { arrElms[i].className = arrElms[i].className.replace(/\s*binToggleOn/,""); if (bin) { arrElms[i].className += " binToggleOn"; arrElms[i].title = (arrElms[i].checked) ? "Disable" + title : "Enable" + title; } getBinToggle(arrElms[i]); } } } function getBinToggle(o,isfile) { var o = $$(o); if (o) { var ibc = $$("insertbulkcount"); var bin = (ibc.options[ibc.selectedIndex].value == "") ? false : true; var fld = (isfile) ? o : o.parentNode.parentNode.firstChild; var title = " this field for Bulk Inserts"; o.title = (o.checked) ? "Disable" + title : "Enable" + title; if (o.checked || !bin) { fld.removeAttribute("readonly"); fld.removeAttribute("disabled"); } else { fld.setAttribute("readonly","readonly"); fld.setAttribute("disabled","disabled"); } } } function getScaffoldRS(v,o) { var srow = document.formScaffold.srow; var erow = document.formScaffold.erow; var pg = document.formScaffold.pg; var pp = document.formScaffold.pp; var ord = document.formScaffold.ord; var srt = document.formScaffold.srt; if (v == "") { pg.value = 1; var bSubmit = false; } else { pg.value = v; var bSubmit = true; } if (pg.value == 1) { srow.value = 1; erow.value = parseInt(pp.value); } else { srow.value = ((parseInt(pg.value)-1) * parseInt(pp.value)) + 1; erow.value = parseInt(srow.value) + parseInt(pp.value) - 1; } if (bSubmit == true) { setScaffold(o); } } function $$(v) { var d = document; return (typeof(v) == "string") ? (d.getElementById(v)) ? d.getElementById(v) : false : v; } String.prototype.ucfirst = function() { return this.substr(0,1).toUpperCase() + this.substr(1,this.length); }; function getBBCode() { var strHelp = ""; var arrHelp = []; arrHelp["Bold Text"] = "\t\t\t[B] This text will be bold [/B]"; arrHelp["Italic Text"] = "\t\t[I] This text will be italic [/I]"; arrHelp["Underlined Text"] = "\t[U] This text will be underlined [/U]"; arrHelp["Stricken Text"] = "\t\t[S] This text will be stricken [/S]"; arrHelp["Inline Image"] = "\t\t[IMG] http://sourceurlofmyimage/ [/IMG]"; arrHelp["Link"] = "\t\t\t\t[URL] http://urlofmysite/ [/URL]"; arrHelp["Link with Label"] = "\t[URL=http://urlofmysite/] Label for my site [/URL]"; arrHelp["Separator"] = "\t\t[HR]"; arrHelp["Text Break"] = "\t\t[BR]"; arrHelp["Ordered List"] = "\n\t\t\t\t\t[OL]\n\t\t\t\t\t\t[LI] List Item One [/LI]\n\t\t\t\t\t\t[LI] List Item Two [/LI]\n\t\t\t\t\t[/OL]"; arrHelp["Unordered List"] = "\n\t\t\t\t\t[UL]\n\t\t\t\t\t\t[LI] List Item One [/LI]\n\t\t\t\t\t\t[LI] List Item Two [/LI]\n\t\t\t\t\t\t[LI] List Item Three [/LI]\n\t\t\t\t\t[/UL]"; arrHelp["Blockquote"] = "\t\t[Q] This is text quoted from another resource [/Q]"; arrHelp["Pre"] = "\t\t\t\t[PRE] This text will be wrapped in code tags [/PRE]"; arrHelp["Code"] = "\t\t\t\t[CODE] This text will be wrapped in code tags [/CODE]"; arrHelp["Code Object"] = "\n\t\t\t\t\t[CODEOBJECT=idOfMyObject]\n\t\t\t\t\t\tMy Object To Be Linked\n\t\t\t\t\t[/CODEOBJECT]"; arrHelp["Class"] = "\n\t\t\t\t\t[CLASS=myFirstClass mySecondClass]\n\t\t\t\t\t\tThis text will inherit one or more classes\n\t\t\t\t\t[/CLASS]"; arrHelp["Class (greedy)"] = "\n\t\t\t\t\t[GCLASS=myGreedyClassName]\n\t\t\t\t\t\tSame as a class but uses a greedy replacement\n\t\t\t\t\t[/GCLASS]"; for (var arg in arrHelp) { strHelp += "\n" + arg.toUpperCase() + " : " + arrHelp[arg] + ""; } alert(strHelp); } function getDateNow() { function addZero(n) { if (n < 10) { n = "0" + n; } return n; } var d = new Date(); var mm = addZero(d.getMonth() + 1); var dd = addZero(d.getDate()); var yyyy = addZero(d.getFullYear()); return mm + "/" + dd + "/" + yyyy; } function getTab(o) { var o = $$(o); if (o) { var arrIds = o.id.split("_"); var arrTables = $C("tabTable"); var arrTabs = $C("tab"); var arrTabsLen = arrTabs.length; for (var i=0; i<arrTabsLen; i++) { arrTabs[i].className = "tab"; arrTables[i].className = "tabTable"; } o.className = "tab selected"; $$("table_" + arrIds[1]).className = "tabTable selected"; $$("tabScaffold").value = arrIds[1]; } } function getRule(o) { var o = $$(o); if (o) { var p = o.parentNode; var i = p.lastChild; var w = 350; var arrInputRules = aj.$C("inputRule"); for (var ir in arrInputRules) { aj.cr(arrInputRules[ir],"inputRuleSelected"); } var arrTextRules = aj.$C("textRule"); for (var tr in arrTextRules) { aj.ca(arrTextRules[tr],"textRuleSelected"); } aj.cr(o,"textRuleSelected"); aj.ca(i,"inputRuleSelected"); i.focus(); } } function setRule(o) { var o = $$(o); if (o) { var t = o.parentNode.firstChild; t.innerHTML = o.value; var arrInputRules = aj.$C("inputRule"); for (var ir in arrInputRules) { aj.cr(arrInputRules[ir],"inputRuleSelected"); } var arrTextRules = aj.$C("textRule"); for (var tr in arrTextRules) { aj.ca(arrTextRules[tr],"textRuleSelected"); } aj.cr(o,"inputRuleSelected"); aj.ca(t,"textRuleSelected"); } } function setRules(o) { var o = $$(o); if (o) { var ir,tr,i,t; var arrInputRules = aj.$C("inputRule"); for (ir in arrInputRules) { i = arrInputRules[ir]; if (i.parentNode) { t = i.parentNode.firstChild; aj.cr(i,"inputRuleSelected"); t.innerHTML = arrInputRules[ir].value; } } var arrTextRules = aj.$C("textRule"); for (tr in arrTextRules) { aj.ca(arrTextRules[tr],"textRuleSelected"); } } } function getUid(o) { var o = $$(o); if (o) { var uid = (S4()+S4()+S4()+S4()+S4()+S4()+S4()+S4()); o.parentNode.childNodes[0].value = uid; } } function setScaffold(o,frm) { var obj = $$(o); var frm = frm || document.formScaffold; if (obj && frm) { var arrIds = o.id.split("_"); var arrIdsLen = arrIds.length; var a = $$("act"); var i = $$("id"); var t = $$("select_change_tbl"); var recordRow = (arrIds.length >= 3) ? $$("record_row_" + arrIds[2]) : false; var srow = frm.srow; var erow = frm.erow; var pp = frm.pp; var pg = frm.pg; var ord = frm.ord; var srt = frm.srt; var tab = frm.tab; var row = arrIds[3]; var nrow = $C("queryAdvancedRow").length; var orow = (nrow-1); var prow = $$("query_row_" + orow); var wfld = $$("select_where_wfld_" + row); var wop = $$("wop_wop_wop_" + row); var wval = $$("wval_" + row); var act = arrIds[1].toLowerCase(); switch (act) { case "help": location.href = "?pid=help"; break; case "addquery": var tr = document.createElement("tr"); tr.id = "query_row_" + nrow; tr.className = "queryAdvancedRow"; var td = document.createElement("td"); var sf = document.createElement("span"); sf.id = "query_wfld_" + nrow; var so = document.createElement("span"); so.id = "query_wop_" + nrow; var sv = document.createElement("span"); sv.id = "query_wval_" + nrow; sf.className = so.className = sv.className = "queryAdvanced queryAdvancedWhere"; var ff = $$("select_where_wfld_" + orow).cloneNode(true); ff.id = "select_where_wfld_" + nrow; ff.name = "wfld["+nrow+"]"; ff.selectedIndex = $$("select_where_wfld_" + orow).selectedIndex; var fo = $$("wop_wop_wop_" + orow).cloneNode(true); fo.id = "wop_wop_wop_" + nrow; fo.name = "wop["+nrow+"]"; fo.selectedIndex = $$("wop_wop_wop_" + orow).selectedIndex; var fv = $$("wval_" + orow).cloneNode(true); fv.id = "wval_" + nrow; fv.name = "wval["+nrow+"]"; if (fv.selectedIndex != null) { fv.selectedIndex = $$("wval_" + orow).selectedIndex; } if (fv.className.match(/datetime/) !== null) { fv.onclick = function() { displayDatePicker("wval["+nrow+"]",this,"ymdhms","-"); }; } var brow = document.createElement("button"); brow.id = brow.name = "btn_delquery_" + nrow; brow.className = "btn btnDelete"; brow.onclick = function() { setScaffold(this); }; brow.title = "Delete this query condition"; brow.value = ""; sf.appendChild(ff); so.appendChild(fo); sv.appendChild(fv); td.appendChild(sf); td.appendChild(so); td.appendChild(sv); td.appendChild(brow); tr.appendChild(td); prow.parentNode.insertBefore(tr, prow.nextSibling); break; case "delquery": var drow = $$("query_row_" + arrIds[2]); drow.parentNode.removeChild(drow); break; case "add": case "edit": if (arrIds.length > 2) { if (a) { a.value = "edit"; } if (i) { i.value = (arrIds.length > 1) ? arrIds[2] : ""; } } frm.submit(); break; case "link": if (arrIds.length > 4) { if (a) { a.value = "edit"; } if (t) { t.value = arrIds[2].replace(/\++/g,"_"); } if (ord) { ord.value = arrIds[3].replace(/\++/g,"_"); } if (i) { i.value = arrIds[4].replace(/\++/g,"_"); } } frm.submit(); break; case "wop": if (wop.options[wop.selectedIndex].value.match(/^IS\s(NOT\s)*NULL$/gi)) { wval.setAttribute("read-only","read-only"); wval.onfocus = function() { this.blur(); }; wval.style.visibility = "hidden"; wval.value = ""; } else { wval.removeAttribute("read-only"); wval.onfocus = function() { this.focus(); }; wval.style.visibility = "visible"; } break; case "where": var co = $$("wval_" + row).className; var vo = $$("wval_" + row).value; var fld = o.value; if (fld != "") { $$("query_wval_" + row).innerHTML = arrWhereWvals[fld].replace(/wval\[0\]/g,"wval["+row+"]").replace(/_0/,"_"+row); } $$("wval_" + row).value = vo; if ($$("wval_" + row).className != co || fld == "" || wop.innerHTML == "") { var opt; var cops = 0; var nops = []; var ops = []; ops[" "] = "&nbsp;"; ops["="] = " Is Equal To "; ops["<>"] = " Is Not Equal To "; ops[">"] = " Is Greater Than "; ops["<"] = " Is Less Than "; ops["LIKE"] = " Contains "; ops["NOT LIKE"] = " Does Not Contain "; ops["IS NULL"] = " Is Null "; ops["IS NOT NULL"] = " Is Not Null "; wop.innerHTML = ""; for (var j in ops) { if (arrWhereWops[fld] && aj.inArray(arrWhereWops[fld],cops) !== false) { opt = document.createElement("option"); opt.value = j; opt.innerHTML = ops[j]; wop.appendChild(opt); } cops++; } $$("wval_" + row).value = ""; } break; case "option": if (srow) { srow.value = 1; } if (pg) { pg.value = 1; } if (erow && pp && pg) { erow.value = pp.value * pg.value; } break; case "change": var arrAdvFields = $C("queryAdvanced"); var arrAdvFieldsLen = arrAdvFields.length; for (var j=0; j < arrAdvFieldsLen; j++) { arrAdvFields[j].childNodes[0].value = ""; } if (a) { a.value = "select"; } if (i) { i.value = ""; } if (srow) { srow.value = 1; } if (pg) { pg.value = 1; } if (erow && pp && pg) { erow.value = pp.value * pg.value; } if (ord) { ord.value = ""; } if (srt) { srt.value = ""; } frm.submit(); break; case "sort": var oBeg = parseInt(arrIds[0].length+arrIds[1].length+2); var oEnd = parseInt(o.id.replace("__desc","").length-oBeg); var ordVal = o.id.substr(oBeg,oEnd); var srtVal = (o.id.match("__desc") === null) ? "" : "desc"; if (a) { a.value = "select"; } if (i) { i.value = ""; } if (ord) { ord.value = ordVal; } if (srt) { srt.value = srtVal; } frm.submit(); break; case "insert": case "insertplus": if (getValidation()) { if (a) { a.value = o.value; } if (i) { i.value = ""; } frm.submit(); } break; case "insertbulk": if (o.parentNode.firstChild.options[o.parentNode.firstChild.selectedIndex].value != "") { if (a) { a.value = o.value; } if (i) { i.value = ""; } frm.submit(); } break; case "purge": if (confirm("This will delete all bulk inserted records for the current table.\nAre you sure you want to proceed?")) { if (a) { a.value = "purge"; } frm.submit(); } break; case "copy": if (getValidation()) { if (a) { a.value = "copy"; } frm.submit(); } break; case "update": if (getValidation()) { if (a) { a.value = "update"; } frm.submit(); } break; case "reset": var elms = frm.elements; var elmsLen = elms.length; for (var i=0; i<elmsLen; i++) { elms[i].value = ""; } if (a) { a.value = "reset"; } if (tab) { tab.value = "connect"; } frm.submit(); break; case "delete": if (confirm("Are your sure you want to delete this item?")) { if (a) { a.value = "delete"; } if (i) { i.value = o.value; } frm.submit(); } break; case "paging": if (a) { a.value = "select"; } if (i) { i.value = ""; } frm.submit(); break; case "export": if (a) { a.value = "export"; } if (i) { i.value = ""; } if (ord) { ord.value = ""; } frm.submit(); break; case "rulesedit": if (a) { a.value = "rulesedit"; } if (i) { i.value = ""; } if (ord) { ord.value = ""; } frm.submit(); break; case "rulesupdate": if (a) { a.value = "rulesupdate"; } if (i) { i.value = ""; } if (ord) { ord.value = ""; } frm.submit(); break; case "toggle": if (recordRow) { var oCell; var recordCells = recordRow.children; for (var cell in recordCells) { oCell = recordCells[cell]; if (oCell.className && !oCell.className.match(/cellStatic/)) { if (oCell.className.match(/cellMin/)) { aj.cr(oCell,"cellMin"); } else { aj.ca(oCell,"cellMin"); } } } } break; case "select": case "scaffold": default: if (a) { a.value = "select"; } if (i) { i.value = ""; } if (ord) { ord.value = ""; } frm.submit(); break; } } } function getValidation() { var msg = ""; var elms = document.formScaffold.elements; var elmsLen = elms.length; for (var i=0; i < elmsLen; i++) { var e = elms[i]; e.className = e.className.replace(/required/g, ""); var c = e.className; var l = e.parentNode.parentNode.childNodes[0].innerHTML.replace(/<a(.*?)<\/a>/,""); if (c.match(/notnull/ig) !== null && e.value == "") { e.className = e.className + " required"; msg += "\n\t- " + l; } } if (msg == "") { return true; } else { alert("The following required fields were left blank:\n" + msg); return false; } } var datePickerDivID = "datepicker"; var iFrameDivID = "datepickeriframe"; var dayArrayShort = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"]; var dayArrayMed = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"]; var dayArrayLong = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; var monthArrayShort = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; var monthArrayMed = ["Jan", "Feb", "Mar", "Apr", "May", "June", "July", "Aug", "Sept", "Oct", "Nov", "Dec"]; var monthArrayLong = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]; var defaultDateSeparator = "/"; var defaultDateFormat = "mdy"; var dateSeparator = defaultDateSeparator; var dateFormat = defaultDateFormat; var hourArray = []; var minArray = []; for (var i=0; i < 24; i++) { hourArray.push(i); } for (var i=0; i < 60; i++) { minArray.push(i); } function zeroAdd(str) { str = (str < 10) ? "0" + str : str; return str; } function displayDatePicker(dateFieldName, displayBelowThisObject, dtFormat, dtSep) { var targetDateField = document.getElementsByName (dateFieldName).item(0); if (!displayBelowThisObject) { displayBelowThisObject = targetDateField; } if (dtSep) { dateSeparator = dtSep; } else { dateSeparator = defaultDateSeparator; } if (dtFormat) { dateFormat = dtFormat; } else { dateFormat = defaultDateFormat; } var x = displayBelowThisObject.offsetLeft + displayBelowThisObject.offsetWidth + 1; var y = displayBelowThisObject.offsetTop + displayBelowThisObject.offsetHeight - 21; var parent = displayBelowThisObject; while (parent.offsetParent) { parent = parent.offsetParent; x += parent.offsetLeft; y += parent.offsetTop ; } drawDatePicker(targetDateField, x, y); } function drawDatePicker(targetDateField, x, y) { if (!document.getElementById(datePickerDivID)) { var newNode = document.createElement("div"); newNode.setAttribute("id", datePickerDivID); newNode.setAttribute("class", "dpDiv"); newNode.setAttribute("style", "visibility: hidden;"); document.body.appendChild(newNode); } var pickerDiv = document.getElementById(datePickerDivID); pickerDiv.style.position = "absolute"; pickerDiv.style.left = x + "px"; pickerDiv.style.top = y + "px"; pickerDiv.style.visibility = "visible"; pickerDiv.style.display = "block"; pickerDiv.style.zIndex = 10000; var datetime = getDateTime(targetDateField.value); var year = datetime.getFullYear(); var month = datetime.getMonth(); var day = datetime.getDate(); var hour = datetime.getHours(); var minute = datetime.getMinutes(); refreshDatePicker(targetDateField.name, year, month, day, hour, minute); } function refreshDatePicker(dateFieldName, year, month, day, hour, minute) { var thisDay = new Date(); if ((month >= 0) && (year > 0)) { thisDay = new Date(year, month, 1, hour, minute); } else { day = thisDay.getDate(); thisDay.setDate(1); } thisHour = thisDay.getHours(); thisMin = thisDay.getMinutes(); var crlf = "\r\n"; var TABLE = "<table cols=\"7\" class=\"dpTable\">" + crlf; var xTABLE = "</table>" + crlf; var TR = "<tr class=\"dpTR\">"; var TR_title = "<tr class=\"dpTitleTR\">"; var TR_time = "<tr class=\"dpTimeTR\">"; var TR_days = "<tr class=\"dpDayTR\">"; var TR_todaybutton = "<tr class=\"dpTodayButtonTR\">"; var xTR = "</tr>" + crlf; var TD = "<td class=\"dpTD\" onMouseOut=\"this.className=\'dpTD\';\" onMouseOver=\"this.className=\'dpTDHover\';\" "; var TD_title = "<td colspan=5 class=\"dpTitleTD\">"; var TD_time = "<td colspan=7 align=\"center\" class=\"dpTimeTD\">"; var SEL_hour = "<select id=\"dpHourSEL\" class=\"dpHourSEL\" onchange=\"updateDateTimeField(\'" + dateFieldName + "\', \'" + getDateString(thisDay) + "\', " + true + ");\">"; var SEL_min = "<select id=\"dpMinSEL\" class=\"dpMinSEL\" onchange=\"updateDateTimeField(\'" + dateFieldName + "\', \'" + getDateString(thisDay) + "\', " + true + ");\">"; var xSEL = "</select>"; var TD_buttons = "<td class=\"dpButtonTD\">"; var TD_todaybutton = "<td colspan=7 class=\"dpTodayButtonTD\">"; var TD_days = "<td class=\"dpDayTD\">"; var TD_selected = "<td class=\"dpDayHighlightTD\" onMouseOut=\"this.className=\'dpDayHighlightTD\';\" onMouseOver=\"this.className=\'dpTDHover\';\" "; var xTD = "</td>" + crlf; var DIV_title = "<div class=\"dpTitleText\">"; var DIV_selected = "<div class=\"dpDayHighlight\">"; var xDIV = "</div>"; var html = TABLE; html += TR_title; html += TD_buttons + getButtonCode(dateFieldName, thisDay, -1, "&lt;") + xTD; html += TD_title + DIV_title + monthArrayLong[ thisDay.getMonth()] + " " + thisDay.getFullYear() + xDIV + xTD; html += TD_buttons + getButtonCode(dateFieldName, thisDay, 1, "&gt;") + xTD; html += xTR; html += TR_time; html += TD_time; html += "Hour " + SEL_hour + getSelectCode(dateFieldName, hourArray, thisHour) + xSEL + ":"; html += SEL_min + getSelectCode(dateFieldName, minArray, thisMin) + xSEL + " Min"; html += xTD; html += xTR; html += TR_days; for(i = 0; i < dayArrayShort.length; i++) { html += TD_days + dayArrayShort[i] + xTD; } html += xTR; html += TR; for (i = 0; i < thisDay.getDay(); i++) { html += TD + ">&nbsp;" + xTD; } do { dayNum = thisDay.getDate(); TD_onclick = " onclick=\"updateDateTimeField(\'" + dateFieldName + "\', \'" + getDateString(thisDay) + "\');\">"; if (dayNum == day) { html += TD_selected + TD_onclick + DIV_selected + dayNum + xDIV + xTD; } else { html += TD + TD_onclick + dayNum + xTD; } if (thisDay.getDay() == 6) { html += xTR + TR; } thisDay.setDate(thisDay.getDate() + 1); } while (thisDay.getDate() > 1) if (thisDay.getDay() > 0) { for (i = 6; i > thisDay.getDay(); i--) { html += TD + "&nbsp;" + xTD; } } html += xTR; var today = new Date(); var todayString = "Today is " + dayArrayMed[today.getDay()] + ", " + monthArrayMed[ today.getMonth()] + " " + today.getDate(); html += TR_todaybutton + TD_todaybutton; html += "<button class=\"dpTodayButton\" onClick=\"updateDateTimeField(\'" + dateFieldName + "\'," + false + "); refreshDatePicker(\'" + dateFieldName + "\');\">clear</button> &nbsp;"; html += "<button class=\"dpTodayButton\" onClick=\"updateDateTimeField(\'" + dateFieldName + "\', \'" + getDateString(today) + "\'); refreshDatePicker(\'" + dateFieldName + "\');\">today</button> &nbsp;"; html += "<button class=\"dpTodayButton\" onClick=\"updateDateTimeField(\'" + dateFieldName + "\');\">close</button>"; html += xTD + xTR; html += xTABLE; document.getElementById(datePickerDivID).innerHTML = html; adjustiFrame(); } function getButtonCode(dateFieldName, dateVal, adjust, label) { var newMonth = (dateVal.getMonth() + adjust) % 12; var newYear = dateVal.getFullYear() + parseInt((dateVal.getMonth() + adjust) / 12); if (newMonth < 0) { newMonth += 12; newYear += -1; } var newDay = dateVal.getDate(); var newHour = dateVal.getHours(); var newMinute = dateVal.getMinutes(); return "<button class=\"dpButton\" onClick=\"refreshDatePicker(\'" + dateFieldName + "\', " + newYear + ", " + newMonth + ", " + newDay + ", " + newHour + ", " + newMinute + ");\">" + label + "</button>"; } function getSelectCode(dateFieldName, arrVals, currVal) { var sOptions = ""; var sNums = ""; var arrLen = arrVals.length; for (var i=0; i < arrLen; i++) { var v = zeroAdd(arrVals[i]); var c = zeroAdd(currVal); var s = (v == c) ? "selected=\"selected\"" : ""; sOptions += "<option value=\'" + v + "\'" + s + ">" + v + "</option>"; } return sOptions; } function getDateString(dateVal) { var dayString = "00" + dateVal.getDate(); var monthString = "00" + (dateVal.getMonth()+1); dayString = dayString.substring(dayString.length - 2); monthString = monthString.substring(monthString.length - 2); switch (dateFormat) { case "dmy" : return dayString + dateSeparator + monthString + dateSeparator + dateVal.getFullYear(); case "ymdhms" : case "ymd" : return dateVal.getFullYear() + dateSeparator + monthString + dateSeparator + dayString; case "mdy" : default : return monthString + dateSeparator + dayString + dateSeparator + dateVal.getFullYear(); } } function getDateTime(datetime) { var dateVal; var dArray; var year, month, day; var hour = minute = 0; var dt = datetime.split(" "); var dateString = dt[0]; if (dt.length > 1) { var timeString = dt[1]; hour = parseInt(timeString.split(":")[0], 10); minute = parseInt(timeString.split(":")[1], 10); } try { dArray = splitDateString(dateString); if (dArray) { switch (dateFormat) { case "dmy" : day = parseInt(dArray[0], 10); month = parseInt(dArray[1], 10) - 1; year = parseInt(dArray[2], 10); break; case "ymd" : day = parseInt(dArray[2], 10); month = parseInt(dArray[1], 10) - 1; year = parseInt(dArray[0], 10); break; case "ymdhms": day = parseInt(dArray[2], 10); month = parseInt(dArray[1], 10) - 1; year = parseInt(dArray[0], 10); break; case "mdy" : default : day = parseInt(dArray[1], 10); month = parseInt(dArray[0], 10) - 1; year = parseInt(dArray[2], 10); break; } dateVal = new Date(year, month, day, hour, minute); } else if (dateString) { dateVal = new Date(dateString); } else { dateVal = new Date(); } } catch(e) { dateVal = new Date(); } return dateVal; } function splitDateString(dateString) { var dArray; if (dateString.indexOf("/") >= 0) { dArray = dateString.split("/"); } else if (dateString.indexOf(".") >= 0) { dArray = dateString.split("."); } else if (dateString.indexOf("-") >= 0) { dArray = dateString.split("-"); } else { dArray = false; } return dArray; } function updateDateTimeField(dateFieldName, dateString, timeOnly) { timeOnly = timeOnly || false; var targetDateField = document.getElementsByName (dateFieldName).item(0); if (dateString) { var oHour = document.getElementById("dpHourSEL"); var oMin = document.getElementById("dpMinSEL"); if (oHour && oMin) { var hourString = oHour.options[oHour.selectedIndex].value; var minuteString = oMin.options[oMin.selectedIndex].value; var secondString = "00"; } var timeString = " " + hourString + ":" + minuteString + ":" + secondString; dateString = (timeOnly) ? targetDateField.value.split(" ")[0] : dateString; targetDateField.value = (dateFormat == "ymdhms") ? dateString + timeString : dateString; targetDateField.value = (dateFormat == "ymdhms") ? dateString + timeString : dateString; } else { targetDateField.value = ""; } if (timeOnly === false) { var pickerDiv = document.getElementById(datePickerDivID); pickerDiv.style.visibility = "hidden"; pickerDiv.style.display = "none"; } adjustiFrame(); targetDateField.focus(); if ((dateString) && (typeof(datePickerClosed) == "function") && timeOnly === false) { datePickerClosed(targetDateField); } } function adjustiFrame(pickerDiv, iFrameDiv) { var is_opera = (navigator.userAgent.toLowerCase().indexOf("opera") != -1); if (is_opera) return; try { if (!document.getElementById(iFrameDivID)) { var newNode = document.createElement("iFrame"); newNode.setAttribute("id", iFrameDivID); newNode.setAttribute("src", "javascript:false;"); newNode.setAttribute("scrolling", "no"); newNode.setAttribute ("frameborder", "0"); document.body.appendChild(newNode); } if (!pickerDiv) { pickerDiv = document.getElementById(datePickerDivID); } if (!iFrameDiv) { iFrameDiv = document.getElementById(iFrameDivID); } try { iFrameDiv.style.position = "absolute"; iFrameDiv.style.width = pickerDiv.offsetWidth; iFrameDiv.style.height = pickerDiv.offsetHeight ; iFrameDiv.style.top = pickerDiv.style.top; iFrameDiv.style.left = pickerDiv.style.left; iFrameDiv.style.zIndex = pickerDiv.style.zIndex - 1; iFrameDiv.style.visibility = pickerDiv.style.visibility ; iFrameDiv.style.display = pickerDiv.style.display; } catch(e) { } } catch (ee) { } } function getOffsetTop(elm) { var mOffsetTop = elm.offsetTop; var mOffsetParent = elm.offsetParent; while(mOffsetParent){ mOffsetTop += mOffsetParent.offsetTop; mOffsetParent = mOffsetParent.offsetParent; } return mOffsetTop; } function getOffsetLeft(elm) { var mOffsetLeft = elm.offsetLeft; var mOffsetParent = elm.offsetParent; while(mOffsetParent) { mOffsetLeft += mOffsetParent.offsetLeft; mOffsetParent = mOffsetParent.offsetParent; } return mOffsetLeft; } function S4() { return (((1+Math.random())*0x10000)|0).toString(16).substr(1) } addDOMLoadEvent(function() { }); </script> '; echo '</body>'; echo '</html>'; }  ?>